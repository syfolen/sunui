var __extends=this&&this.__extends||function(){var o=function(e,t){o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return o(e,t)};return function(e,t){o(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();var puremvc;(function(e){var a=function(){function e(){this.$commands={};if(e.inst!==null){throw Error(e.SINGLETON_MSG)}e.inst=this}e.prototype.executeCommand=function(e,t){var r=this.$commands[e];var o=new r;if(t===void 0){o.execute.call(o)}else if(t instanceof Array){o.execute.apply(o,t)}else{o.execute.call(o,t)}};e.prototype.registerCommand=function(e,t){if(this.hasCommand(e)===true){throw Error("Register Duplicate Command "+e)}this.$commands[e]=t;s.inst.registerObserver(e,this.executeCommand,this)};e.prototype.removeCommand=function(e){if(this.hasCommand(e)===false){throw Error("Remove Non-Existent Command "+e)}delete this.$commands[e];s.inst.removeObserver(e,this.executeCommand,this)};e.prototype.retrieveCommand=function(e){return this.$commands[e]||null};e.prototype.hasCommand=function(e){return this.retrieveCommand(e)!=null};e.SINGLETON_MSG="Controller singleton already constructed!";e.inst=null;return e}();e.Controller=a;var t=function(){function e(){this.$view=new s;this.$model=new r;this.$controller=new a;if(e.inst!==null){throw Error(e.SINGLETON_MSG)}e.inst=this;this.$initializeFacade()}e.getInstance=function(){if(e.inst===null){e.inst=new e}return e.inst};e.prototype.$initializeFacade=function(){this.$initMsgQ();this.$initializeModel();this.$initializeView();this.$initializeController()};e.prototype.$initMsgQ=function(){};e.prototype.$initializeModel=function(){};e.prototype.$initializeView=function(){};e.prototype.$initializeController=function(){};e.prototype.$regMMICmd=function(e,t){suncore.Mutex.checkPrefix=true;suncore.Mutex.mmiMsgQMap[t]=e;suncore.Mutex.mmiMsgQCmd[e]=t};e.prototype.registerObserver=function(e,t,r,o,i){suncore.Mutex.deactive();this.$view.registerObserver(e,t,r,o,i)};e.prototype.removeObserver=function(e,t,r){suncore.Mutex.deactive();this.$view.removeObserver(e,t,r)};e.prototype.registerCommand=function(e,t){suncore.Mutex.deactive();this.$controller.registerCommand(e,t)};e.prototype.removeCommand=function(e){suncore.Mutex.deactive();this.$controller.removeCommand(e)};e.prototype.hasCommand=function(e){suncore.Mutex.deactive();return this.$controller.hasCommand(e)};e.prototype.registerProxy=function(e){suncore.Mutex.deactive();this.$model.registerProxy(e)};e.prototype.removeProxy=function(e){suncore.Mutex.deactive();this.$model.removeProxy(e)};e.prototype.retrieveProxy=function(e){suncore.Mutex.deactive();return this.$model.retrieveProxy(e)};e.prototype.hasProxy=function(e){suncore.Mutex.deactive();return this.$model.hasProxy(e)};e.prototype.registerMediator=function(e){suncore.Mutex.deactive();this.$view.registerMediator(e)};e.prototype.removeMediator=function(e){suncore.Mutex.deactive();this.$view.removeMediator(e)};e.prototype.retrieveMediator=function(e){suncore.Mutex.deactive();return this.$view.retrieveMediator(e)};e.prototype.hasMediator=function(e){suncore.Mutex.deactive();return this.$view.hasMediator(e)};e.prototype.sendNotification=function(e,t,r){suncore.Mutex.active(9527);this.$view.notifyObservers(e,t,r);suncore.Mutex.deactive()};e.prototype.notifyCancel=function(){suncore.Mutex.deactive();this.$view.notifyCancel()};e.SINGLETON_MSG="Facade singleton already constructed!";e.inst=null;return e}();e.Facade=t;var r=function(){function e(){this.$proxies={};if(e.inst!==null){throw Error(e.SINGLETON_MSG)}e.inst=this}e.prototype.registerProxy=function(e){var t=e.getProxyName();if(t===null){throw Error("Register Invalid Proxy")}if(this.hasProxy(t)===true){throw Error("Register Duplicate Proxy "+t)}if(suncore.Mutex.enableMMIAction()===false){throw Error("非MMI模块禁用接口")}this.$proxies[t]=e;e.onRegister()};e.prototype.removeProxy=function(e){if(e===void 0){throw Error("Remove Invalid Proxy")}var t=this.retrieveProxy(e);if(t===null){throw Error("Remove Non-Existent Proxy "+e)}if(suncore.Mutex.enableMMIAction()===false){throw Error("非MMI模块禁用接口")}delete this.$proxies[e];t.onRemove()};e.prototype.retrieveProxy=function(e){if(suncore.Mutex.enableMMIAction()===false){throw Error("非MMI模块禁用接口")}return this.$proxies[e]||null};e.prototype.hasProxy=function(e){if(suncore.Mutex.enableMMIAction()===false){throw Error("非MMI模块禁用接口")}return this.retrieveProxy(e)!=null};e.SINGLETON_MSG="Model singleton already constructed!";e.inst=null;return e}();e.Model=r;var o=function(){function e(e){this.$msgQMod=9527;this.$facade=t.getInstance();if(e!==void 0){this.$msgQMod=e}}Object.defineProperty(e.prototype,"facade",{get:function(){suncore.Mutex.active(this.$msgQMod);return this.$facade},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"msgQMod",{get:function(){return this.$msgQMod},enumerable:true,configurable:true});return e}();e.Notifier=o;var l=function(){function e(){}return e}();e.Observer=l;var i=function(o){__extends(e,o);function e(e,t){var r=o.call(this)||this;if(e===void 0){throw Error("Invalid Proxy Name")}r.$proxyName=e;if(t!==void 0){r.data=t}return r}e.prototype.getProxyName=function(){return this.$proxyName||null};e.prototype.onRegister=function(){};e.prototype.onRemove=function(){};e.prototype.setData=function(e){this.data=e};e.prototype.getData=function(){return this.data};return e}(o);e.Proxy=i;var n=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(o);e.SimpleCommand=n;var s=function(){function e(){this.$mediators={};this.$observers={};this.$isCanceled=false;this.$onceObservers=[];if(e.inst!==null){throw Error(e.SINGLETON_MSG)}e.inst=this}e.prototype.registerObserver=function(e,t,r,o,i){if(o===void 0){o=false}if(i===void 0){i=1}if(e===void 0){throw Error("Register Invalid Observer")}if(t===void 0){throw Error("Register Invalid Observer Method")}suncore.Mutex.create(e,r);var n=this.$observers[e];if(n===void 0){n=this.$observers[e]=[false]}else if(n[0]===true){n=this.$observers[e]=n.concat();n[0]=false}var s=-1;for(var a=1;a<n.length;a++){var c=n[a];if(c.method===t&&c.caller===r){return null}if(s===-1&&c.priority<i){s=a}}var u=new l;u.name=e;u.caller=r;u.method=t;u.priority=i;u.receiveOnce=o;if(s<0){n.push(u)}else{n.splice(s,0,u)}return u};e.prototype.removeObserver=function(e,t,r){if(e===void 0){throw Error("Remove Invalid Observer")}if(t===void 0){throw Error("Remove Invalid Observer Method")}suncore.Mutex.release(e,r);var o=this.$observers[e];if(o===void 0){return}if(o[0]===true){o=this.$observers[e]=o.concat();o[0]=false}for(var i=1;i<o.length;i++){var n=o[i];if(n.method===t&&n.caller===r){o.splice(i,1);break}}if(o.length===1){delete this.$observers[e]}};e.prototype.notifyCancel=function(){this.$isCanceled=true};e.prototype.notifyObservers=function(e,t,r){if(r===void 0){r=false}if(e===void 0){throw Error("Notify Invalid Command")}var o=this.$observers[e];if(o===void 0){return}o[0]=true;suncore.Mutex.lock(e);var i=this.$isCanceled;this.$isCanceled=false;for(var n=1;n<o.length;n++){var s=o[n];if(s.receiveOnce===true){this.$onceObservers.push(s)}if(s.caller===a.inst){s.method.call(s.caller,e,t)}else if(t===void 0){s.method.call(s.caller)}else if(t instanceof Array){s.method.apply(s.caller,t)}else{s.method.call(s.caller,t)}if(r===true&&this.$isCanceled){break}}this.$isCanceled=i;o[0]=false;suncore.Mutex.unlock(e);while(this.$onceObservers.length>0){var s=this.$onceObservers.pop();this.removeObserver(s.name,s.method,s.caller)}};e.prototype.registerMediator=function(e){var t=e.getMediatorName();if(t===null){throw Error("Register Invalid Mediator")}if(this.hasMediator(t)===true){throw Error("Register Duplicate Mediator "+t)}if(suncore.Mutex.enableMMIAction()===false){throw Error("非MMI模块禁用接口")}this.$mediators[t]=e;e.listNotificationInterests();e.onRegister()};e.prototype.removeMediator=function(e){if(e===void 0){throw Error("Remove Invalid Mediator")}var t=this.retrieveMediator(e);if(t===null){throw Error("Remove Non-Existent Mediator "+e)}if(suncore.Mutex.enableMMIAction()===false){throw Error("非MMI模块禁用接口")}delete this.$mediators[e];t.removeNotificationInterests();t.onRemove()};e.prototype.retrieveMediator=function(e){if(suncore.Mutex.enableMMIAction()===false){throw Error("非MMI模块禁用接口")}return this.$mediators[e]||null};e.prototype.hasMediator=function(e){if(suncore.Mutex.enableMMIAction()===false){throw Error("非MMI模块禁用接口")}return this.retrieveMediator(e)!=null};e.SINGLETON_MSG="View singleton already constructed!";e.inst=null;return e}();e.View=s;var c=function(t){__extends(e,t);function e(){var e=t.call(this)||this;e.$commands=[];e.initializeMacroCommand();return e}e.prototype.addSubCommand=function(e){this.$commands.push(e)};e.prototype.execute=function(){for(var e=0;e<this.$commands.length;e++){var t=this.$commands[e];var r=new t;r.execute.apply(r,arguments)}};return e}(o);e.MacroCommand=c;var u=function(o){__extends(e,o);function e(e,t){var r=o.call(this)||this;r.$notificationInterests=[];if(e===void 0){throw Error("Invalid Mediator Name")}if(t===void 0){throw Error("Invalid View Component")}r.$mediatorName=e;if(t!==void 0){r.viewComponent=t}return r}e.prototype.getMediatorName=function(){return this.$mediatorName||null};e.prototype.getViewComponent=function(){return this.viewComponent};e.prototype.listNotificationInterests=function(){};e.prototype.removeNotificationInterests=function(){for(var e=0;e<this.$notificationInterests.length;e++){var t=this.$notificationInterests[e];s.inst.removeObserver(t.name,t.method,t.caller)}};e.prototype.handleNotification=function(e,t){var r=s.inst.registerObserver(e,t,this);r&&this.$notificationInterests.push(r)};e.prototype.onRegister=function(){};e.prototype.onRemove=function(){};return e}(o);e.Mediator=u})(puremvc||(puremvc={}));