var __extends=this&&this.__extends||function(){var i=function(e,t){i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return i(e,t)};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();var puremvc;(function(e){var y=function(){function e(){this.$commands={};if(e.inst!==null){throw Error(e.SINGLETON_MSG)}e.inst=this}e.prototype.executeCommand=function(e,t){var r=this.$commands[e];var i=new r;if(t===void 0){i.execute.call(i)}else if(t instanceof Array){i.execute.apply(i,t)}else{i.execute.call(i,t)}};e.prototype.registerCommand=function(e,t){if(this.hasCommand(e)===true){throw Error("Register Duplicate Command "+e)}this.$commands[e]=t;$.inst.registerObserver(e,this.executeCommand,this)};e.prototype.removeCommand=function(e){if(this.hasCommand(e)===false){throw Error("Remove Non-Existent Command "+e)}delete this.$commands[e];$.inst.removeObserver(e,this.executeCommand,this)};e.prototype.retrieveCommand=function(e){return this.$commands[e]||null};e.prototype.hasCommand=function(e){return this.retrieveCommand(e)!=null};e.SINGLETON_MSG="Controller singleton already constructed!";e.inst=null;return e}();e.Controller=y;var t=function(){function e(){this.$view=new $;this.$model=new r;this.$controller=new y;if(e.inst!==null){throw Error(e.SINGLETON_MSG)}e.inst=this;this.$initializeFacade()}e.getInstance=function(){if(e.inst===null){e.inst=new e}return e.inst};e.prototype.$initializeFacade=function(){this.$initMsgQ();this.$initializeModel();this.$initializeView();this.$initializeController()};e.prototype.$initMsgQ=function(){this.$regMMICmd(1,"OSL")};e.prototype.$initializeModel=function(){};e.prototype.$initializeView=function(){};e.prototype.$initializeController=function(){};e.prototype.$regMMICmd=function(e,t){u.checkPrefix=true;u.mmiMsgQMap[t]=e};e.prototype.registerObserver=function(e,t,r,i,o){u.deactive();this.$view.registerObserver(e,t,r,i,o)};e.prototype.removeObserver=function(e,t,r){u.deactive();this.$view.removeObserver(e,t,r)};e.prototype.registerCommand=function(e,t){u.deactive();this.$controller.registerCommand(e,t)};e.prototype.removeCommand=function(e){u.deactive();this.$controller.removeCommand(e)};e.prototype.hasCommand=function(e){u.deactive();return this.$controller.hasCommand(e)};e.prototype.registerProxy=function(e){u.deactive();this.$model.registerProxy(e)};e.prototype.removeProxy=function(e){u.deactive();this.$model.removeProxy(e)};e.prototype.retrieveProxy=function(e){u.deactive();return this.$model.retrieveProxy(e)};e.prototype.hasProxy=function(e){u.deactive();return this.$model.hasProxy(e)};e.prototype.registerMediator=function(e){u.deactive();this.$view.registerMediator(e)};e.prototype.removeMediator=function(e){u.deactive();this.$view.removeMediator(e)};e.prototype.retrieveMediator=function(e){u.deactive();return this.$view.retrieveMediator(e)};e.prototype.hasMediator=function(e){u.deactive();return this.$view.hasMediator(e)};e.prototype.sendNotification=function(e,t,r){u.active(9527);this.$view.notifyObservers(e,t,r);u.deactive()};e.prototype.notifyCancel=function(){u.deactive();this.$view.notifyCancel()};e.SINGLETON_MSG="Facade singleton already constructed!";e.inst=null;return e}();e.Facade=t;var r=function(){function e(){this.$proxies={};if(e.inst!==null){throw Error(e.SINGLETON_MSG)}e.inst=this}e.prototype.registerProxy=function(e){var t=e.getProxyName();if(t===null){throw Error("Register Invalid Proxy")}if(this.hasProxy(t)===true){throw Error("Register Duplicate Proxy "+t)}if(u.enableMMIAction()===false){throw Error("非MMI模块禁用接口")}this.$proxies[t]=e;e.onRegister()};e.prototype.removeProxy=function(e){if(e===void 0){throw Error("Remove Invalid Proxy")}var t=this.retrieveProxy(e);if(t===null){throw Error("Remove Non-Existent Proxy "+e)}if(u.enableMMIAction()===false){throw Error("非MMI模块禁用接口")}delete this.$proxies[e];t.onRemove()};e.prototype.retrieveProxy=function(e){if(u.enableMMIAction()===false){throw Error("非MMI模块禁用接口")}return this.$proxies[e]||null};e.prototype.hasProxy=function(e){if(u.enableMMIAction()===false){throw Error("非MMI模块禁用接口")}return this.retrieveProxy(e)!=null};e.SINGLETON_MSG="Model singleton already constructed!";e.inst=null;return e}();e.Model=r;var i=function(){function e(e){if(e===void 0){e=0}this.$msgQMod=9527;this.$facade=t.getInstance();if(e>0){this.$msgQMod=e}}Object.defineProperty(e.prototype,"facade",{get:function(){u.active(this.$msgQMod);return this.$facade},enumerable:true,configurable:true});return e}();e.Notifier=i;var f=function(){function e(){}return e}();e.Observer=f;var o=function(i){__extends(e,i);function e(e,t){var r=i.call(this)||this;if(e===void 0){throw Error("Invalid Proxy Name")}r.$proxyName=e;if(t!==void 0){r.data=t}return r}e.prototype.getProxyName=function(){return this.$proxyName||null};e.prototype.onRegister=function(){};e.prototype.onRemove=function(){};e.prototype.setData=function(e){this.data=e};e.prototype.getData=function(){return this.data};return e}(i);e.Proxy=o;var n=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(i);e.SimpleCommand=n;var $=function(){function e(){this.$mediators={};this.$observers={};this.$isCanceled=false;this.$onceObservers=[];if(e.inst!==null){throw Error(e.SINGLETON_MSG)}e.inst=this}e.prototype.registerObserver=function(e,t,r,i,o){if(i===void 0){i=false}if(o===void 0){o=1}if(e===void 0){throw Error("Register Invalid Observer")}if(t===void 0){throw Error("Register Invalid Observer Method")}u.create(e,r);var n=this.$observers[e];if(n===void 0){n=this.$observers[e]=[false]}else if(n[0]===true){n=this.$observers[e]=n.concat();n[0]=false}var s=-1;for(var a=1;a<n.length;a++){var c=n[a];if(c.method===t&&c.caller===r){return null}if(s===-1&&c.priority<o){s=a}}var l=new f;l.name=e;l.caller=r;l.method=t;l.priority=o;l.receiveOnce=i;if(s<0){n.push(l)}else{n.splice(s,0,l)}return l};e.prototype.removeObserver=function(e,t,r){if(e===void 0){throw Error("Remove Invalid Observer")}if(t===void 0){throw Error("Remove Invalid Observer Method")}u.release(e,r);var i=this.$observers[e];if(i===void 0){return}if(i[0]===true){i=this.$observers[e]=i.concat();i[0]=false}for(var o=1;o<i.length;o++){var n=i[o];if(n.method===t&&n.caller===r){i.splice(o,1);break}}if(i.length===1){delete this.$observers[e]}};e.prototype.notifyCancel=function(){this.$isCanceled=true};e.prototype.notifyObservers=function(e,t,r){if(r===void 0){r=false}if(e===void 0){throw Error("Notify Invalid Command")}var i=this.$observers[e];if(i===void 0){return}i[0]=true;u.lock(e);var o=this.$isCanceled;this.$isCanceled=false;for(var n=1;n<i.length;n++){var s=i[n];if(s.receiveOnce===true){this.$onceObservers.push(s)}if(s.caller===y.inst){s.method.call(s.caller,e,t)}else if(t===void 0){s.method.call(s.caller)}else if(t instanceof Array){s.method.apply(s.caller,t)}else{s.method.call(s.caller,t)}if(r===true&&this.$isCanceled){break}}this.$isCanceled=o;i[0]=false;u.unlock(e);while(this.$onceObservers.length>0){var s=this.$onceObservers.pop();this.removeObserver(s.name,s.method,s.caller)}};e.prototype.registerMediator=function(e){var t=e.getMediatorName();if(t===null){throw Error("Register Invalid Mediator")}if(this.hasMediator(t)===true){throw Error("Register Duplicate Mediator "+t)}if(u.enableMMIAction()===false){throw Error("非MMI模块禁用接口")}this.$mediators[t]=e;e.listNotificationInterests();e.onRegister()};e.prototype.removeMediator=function(e){if(e===void 0){throw Error("Remove Invalid Mediator")}var t=this.retrieveMediator(e);if(t===null){throw Error("Remove Non-Existent Mediator "+e)}if(u.enableMMIAction()===false){throw Error("非MMI模块禁用接口")}delete this.$mediators[e];t.removeNotificationInterests();t.onRemove()};e.prototype.retrieveMediator=function(e){if(u.enableMMIAction()===false){throw Error("非MMI模块禁用接口")}return this.$mediators[e]||null};e.prototype.hasMediator=function(e){if(u.enableMMIAction()===false){throw Error("非MMI模块禁用接口")}return this.retrieveMediator(e)!=null};e.SINGLETON_MSG="View singleton already constructed!";e.inst=null;return e}();e.View=$;var s=function(t){__extends(e,t);function e(){var e=t.call(this)||this;e.$commands=[];e.initializeMacroCommand();return e}e.prototype.addSubCommand=function(e){this.$commands.push(e)};e.prototype.execute=function(){for(var e=0;e<this.$commands.length;e++){var t=this.$commands[e];var r=new t;r.execute.apply(r,arguments)}};return e}(i);e.MacroCommand=s;var a=function(i){__extends(e,i);function e(e,t){var r=i.call(this)||this;r.$notificationInterests=[];if(e===void 0){throw Error("Invalid Mediator Name")}if(t===void 0){throw Error("Invalid View Component")}r.$mediatorName=e;if(t!==void 0){r.viewComponent=t}return r}e.prototype.getMediatorName=function(){return this.$mediatorName||null};e.prototype.getViewComponent=function(){return this.viewComponent};e.prototype.listNotificationInterests=function(){};e.prototype.removeNotificationInterests=function(){for(var e=0;e<this.$notificationInterests.length;e++){var t=this.$notificationInterests[e];$.inst.removeObserver(t.name,t.method,t.caller)}};e.prototype.handleNotification=function(e,t){var r=$.inst.registerObserver(e,t,this);r&&this.$notificationInterests.push(r)};e.prototype.onRegister=function(){};e.prototype.onRemove=function(){};return e}(i);e.Mediator=a;var u;(function(o){var t="sun";var n="suncore$mutex$prefix";var s="suncore$mutex$mutexes";var e="suncore$mutex$references";var r=0;var i=0;var a=null;o.actMsgQMod=-1;o.checkPrefix=false;o.mmiMsgQMap={};o.mmiMsgQCmd={};function c(e){var t=e.indexOf("_");if(t<1){throw Error("必须为命令指定一个模块名，格式为 MOD_"+e)}return e.substr(0,t)}function l(e){return e.substr(0,3)===t}function f(e){if(l(e)===true){return false}var t=c(e);var r=o.mmiMsgQMap[t]||0;return r!==0}function u(e){if(o.checkPrefix===false){return}if(o.actMsgQMod===-1){o.actMsgQMod=e}}o.active=u;function v(){if(o.checkPrefix===false){return}if(i===0&&o.actMsgQMod!==-1){o.actMsgQMod=-1}}o.deactive=v;function d(e){if(o.checkPrefix===false){return}if(l(e)===true){i++}else{var t=c(e);if(a===null||a===t){r++;if(r===1){a=t}}else{throw Error("禁止跨模块传递消息，src:"+t+", dest:"+c(e))}}}o.lock=d;function h(e){if(o.checkPrefix===false){return}if(l(e)===true){i--}else{var t=c(e);if(a===null||t===a){r--;if(r===0){a=null}else if(r<0){throw Error("互斥体释放错误："+r)}}else{throw Error("禁止跨模块传递消息，src:"+t+", dest:"+c(e))}}}o.unlock=h;function p(){if(o.checkPrefix===false){return true}if(a===null){return true}var e=o.mmiMsgQMap[a]||0;return e!==0}o.enableMMIAction=p;function m(e,t){if(o.checkPrefix===false){return}if(t===null||t===y.inst||t===$.inst){return}if(l(e)===true){return}var r=t[s]||0;if(r>0){var i=t[n]||null;if(i===null){throw Error("意外的互斥量 mutex:"+r)}if(i!==c(e)){throw Error("禁止跨模块监听消息，src:"+i+", dest:"+c(e))}}else{t[n]=c(e)}t[s]=r+1}o.create=m;function M(e,t){if(o.checkPrefix===false){return}if(t===null||t===y.inst||t===$.inst){return}if(l(e)===true){return}var r=t[s]||0;if(r<=0){throw Error("互斥量不存在")}var i=t[n]||null;if(i===null){throw Error("互斥体不存在")}if(i!==c(e)){throw Error("禁止跨模块监听消息，src:"+i+", dest:"+c(e))}if(r-1===0){delete t[n];delete t[s]}else{t[s]=r-1}}o.release=M})(u=e.Mutex||(e.Mutex={}))})(puremvc||(puremvc={}));