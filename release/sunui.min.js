var __extends=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();var sunui;(function(r){var o;(function(e){e[e["NONE"]=0]="NONE";e[e["YES"]=1]="YES";e[e["NO"]=2]="NO";e[e["CANCEL"]=3]="CANCEL"})(o=r.ConfirmOptionValueEnum||(r.ConfirmOptionValueEnum={}));var e;(function(e){e[e["undefined"]=0]="undefined"})(e=r.LoaderStatusEnum||(r.LoaderStatusEnum={}));var u;(function(e){e[e["NONE"]=16]="NONE";e[e["CONFIRM"]=32]="CONFIRM"})(u=r.RetryMethodEnum||(r.RetryMethodEnum={}));var c;(function(e){e[e["NONE"]=0]="NONE";e[e["BACKGROUND"]=1]="BACKGROUND";e[e["SCENE"]=2]="SCENE";e[e["PANEL"]=3]="PANEL";e[e["FLOAT"]=4]="FLOAT";e[e["GOLD_TIPS"]=5]="GOLD_TIPS";e[e["HIGH_GOLD_TIPS"]=6]="HIGH_GOLD_TIPS";e[e["NOTICE"]=7]="NOTICE";e[e["BIGWINNER"]=8]="BIGWINNER";e[e["MINI_GAME"]=9]="MINI_GAME";e[e["POPUP"]=10]="POPUP";e[e["WAITINGBOX"]=11]="WAITINGBOX";e[e["LOADING"]=12]="LOADING";e[e["TIPS"]=13]="TIPS";e[e["TOP"]=14]="TOP";e[e["DEBUG"]=15]="DEBUG"})(c=r.UILevel||(r.UILevel={}));var t=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.$makeProps=function(e){if(e.x===void 0&&e.left===void 0&&e.right===void 0){e.centerX=0}if(e.y===void 0&&e.top===void 0&&e.bottom===void 0){e.centerY=0}if(suncore.System.isModuleStopped(suncore.ModuleEnum.CUSTOM)===true){e.mod=suncore.ModuleEnum.SYSTEM}};t.prototype.$applyShowProps=function(e,t,r){if(t.x!==void 0){e.x=t.x}if(t.y!==void 0){e.y=t.y}if(t.centerX!==void 0){e.centerX=t.centerX}if(t.centerY!==void 0){e.centerY=t.centerY}if(r===0){if(t.left!==void 0){e.left=t.left}if(t.right!==void 0){e.right=t.right}if(t.top!==void 0){e.top=t.top}if(t.bottom!==void 0){e.bottom=t.bottom}}else{if(t.left!==void 0){e.left=-e.width}if(t.right!==void 0){e.right=-e.width}if(t.top!==void 0){e.top=-e.height}if(t.bottom!==void 0){e.bottom=-e.height}if(t.left===void 0&&t.right===void 0&&t.top===void 0&&t.bottom===void 0){e.alpha=0;e.scaleX=0;e.scaleY=0;t.alpha=1;t.scaleX=1;t.scaleY=1}h.get(e,t.mod).to(t,r,t.ease)}};t.prototype.$applyCloseProps=function(e,t,r){if(r>0){if(t.left!==void 0){t.left=-e.width}if(t.right!==void 0){t.right=-e.width}if(t.top!==void 0){t.top=-e.height}if(t.bottom!==void 0){t.bottom=-e.height}if(t.left===void 0&&t.right===void 0&&t.top===void 0&&t.bottom===void 0){t.alpha=0;t.scaleX=0;t.scaleY=0}h.get(e,t.mod).to(t,r)}};return t}(puremvc.SimpleCommand);r.AbstractPopupCommand=t;var n=function(r){__extends(e,r);function e(e){var t=r.call(this)||this;t.facade.registerObserver(S.ENTER_SCENE,t.$onEnterScene,t,true);return t}e.prototype.run=function(){return true};e.prototype.$onEnterScene=function(){};return e}(suncore.AbstractTask);r.AbstractSceneIniClass=n;var i=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e,t,r){var n=g.viewLayer.getInfoByView(e);if(n===null){console.error(e+"["+e.name+"]'s infomation is not exist.");return}if(r!==void 0){n.keepNode=!r}if(n.closed===true){return}n.closed=true;g.viewLayer.onViewClose(e);this.facade.sendNotification(S.ON_POPUP_CLOSED,e);this.$applyCloseProps(e,n.props,t);if(n.props.trans===false){var o=h.get(n.mask,n.props.mod);if(t>200){o.wait(t-200).to({alpha:0},200)}else{o.to({alpha:0},t)}}var i=suncom.Handler.create(this,this.$onCloseFinish,[e]);suncore.System.addTrigger(n.props.mod,t,i)};t.prototype.$onCloseFinish=function(e){g.viewLayer.removeStackByView(e)};return t}(t);r.ClosePopupCommand=i;var s=function(t){__extends(e,t);function e(){var e=t.call(this)||this;e.$url=null;e.$templet=null;e.$handler=null;e.$loading=false;e.$destroyed=false;e.$retryer=null;e.$retryer=new l(u.CONFIRM|suncore.ModuleEnum.SYSTEM,suncom.Handler.create(e,e.$onRetryConfirmed),"资源加载失败，点击确定重新尝试！",o.YES,"确定",o.NO,"取消");return e}e.prototype.load=function(e,t){if(this.$loading===false){this.$loading=true;this.$url=e;this.$handler=t;this.$doLoad()}};e.prototype.$doLoad=function(){Laya.loader.load(P.getLoadList(this.$url),Laya.Handler.create(this,this.$onLoad))};e.prototype.$onLoad=function(e){if(this.$destroyed===false){if(e===false){this.$retryer.run(1e3,suncom.Handler.create(this,this.$doLoad),2)}else if(this.getResExtByUrl(this.$url)==="sk"&&this.$templet===null){this.$templet=new Laya.Templet;this.$templet.on(Laya.Event.COMPLETE,this,this.$onLoad,[true]);this.$templet.loadAni(this.$url)}else{this.$loading=false;this.$handler.run()}}};e.prototype.$onRetryConfirmed=function(e){if(this.$destroyed===false){if(e===o.YES){this.$doLoad();this.$retryer.reset()}else{this.facade.sendNotification(suncore.NotifyKey.SHUTDOWN)}}};e.prototype.destroy=function(){if(this.$destroyed===false){this.$destroyed=true;this.$handler=null;this.$loading=false;this.$retryer.cancel();if(this.$templet!==null){this.$templet.off(Laya.Event.ERROR,this,this.$onLoad);this.$templet.off(Laya.Event.COMPLETE,this,this.$onLoad);this.$templet.destroy();this.$templet=null}}};e.prototype.getResExtByUrl=function(e){return e.substr(e.lastIndexOf(".")+1)};e.prototype.create=function(){var e=null;if(this.$templet===null){e=Laya.loader.getRes(this.$url)||null}else{e=this.$templet.buildArmature(2)||null}if(e===null){throw Error("资源预加载出错 url:"+this.$url)}return e};Object.defineProperty(e.prototype,"loading",{get:function(){return this.$loading},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"url",{get:function(){return this.$url},enumerable:true,configurable:true});return e}(puremvc.Notifier);r.Loader=s;var a=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e){for(var t=0;t<e.length;t++){var r=e[t];_.regScene(r)}};return t}(puremvc.SimpleCommand);r.RegisterScenesCommand=a;var l=function(a){__extends(e,a);function e(e,t,r){if(t===void 0){t=null}if(r===void 0){r=null}var n=[];for(var o=3;o<arguments.length;o++){n[o-3]=arguments[o]}var i=a.call(this,suncore.MsgQModEnum.MMI)||this;i.$options=[];i.$currentRetries=0;i.$retryHandler=null;i.$retryTimerId=0;i.$prompting=false;if((e&u.CONFIRM)===u.CONFIRM){i.$method=u.CONFIRM}else{i.$method=u.NONE}var s=e&=15;if(e===suncore.ModuleEnum.CUSTOM||e===suncore.ModuleEnum.TIMELINE){i.$mod=e}else{i.$mod=suncore.ModuleEnum.SYSTEM}i.$prompt=r;i.$options=n;i.$confirmHandler=t;return i}e.prototype.run=function(e,t,r){if(r===void 0){r=2}if(this.$currentRetries<r){if(this.$retryTimerId===0){this.$retryHandler=t;this.$retryTimerId=suncore.System.addTimer(suncore.ModuleEnum.SYSTEM,e,this.$onRetryTimer,this,1)}else{console.warn("己忽略的重试请求 method:"+suncom.Common.getMethodName(t.method,t.caller)+", caller:"+suncom.Common.getQualifiedClassName(t.caller))}}else if(this.$method===u.NONE){this.$confirmHandler.runWith(o.YES)}else{if(this.$prompting===false){this.$prompting=true;var n=suncom.Handler.create(this,this.$onConfirmRely);this.facade.sendNotification(S.RETRY_CONFIRM,[this.$mod,this.$prompt,this.$options,n])}else{console.warn("己忽略的重试的询问请求 prompt:"+this.$prompt)}}};e.prototype.$onConfirmRely=function(e){if(this.$prompting===true){this.$prompting=false;this.$confirmHandler.runWith(e)}};e.prototype.$onRetryTimer=function(){this.$retryTimerId=0;this.$currentRetries++;this.$retryHandler.run()};e.prototype.cancel=function(){this.$prompting=false;this.$retryTimerId=suncore.System.removeTimer(this.$retryTimerId)};e.prototype.reset=function(){this.$currentRetries=0};Object.defineProperty(e.prototype,"currentRetries",{get:function(){return this.$currentRetries},enumerable:true,configurable:true});return e}(puremvc.Notifier);r.Retryer=l;var f=function(t){__extends(e,t);function e(){var e=t.call(this)||this;e.$ready=true;e.$sceneName=0;e.$uiScene=null;e.$d3Scene=null;e.facade.registerObserver(S.ENTER_SCENE,e.$onEnterScene,e,false,5);return e}e.prototype.$enterScene=function(e,t){var r=_.getConfigByName(e);suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_LAZY,suncom.Handler.create(this,this.$beforeLoadScene,[r,t]));suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_LAZY,suncom.Handler.create(this,this.$loadScene,[r,t]))};e.prototype.$beforeLoadScene=function(e,t){this.$sceneName=e.name;this.facade.sendNotification(S.BEFORE_LOAD_SCENE);var r=t===void 0?new e.iniCls:new e.iniCls(t);suncore.System.addTask(suncore.ModuleEnum.SYSTEM,0,r)};e.prototype.$loadScene=function(e,t){this.facade.sendNotification(S.LOAD_SCENE,[e,t])};e.prototype.$onEnterScene=function(e,t){this.$ready=true;this.$uiScene=e;this.$d3Scene=t;this.facade.sendNotification(suncore.NotifyKey.START_TIMELINE,[suncore.ModuleEnum.CUSTOM,false])};e.prototype.$exitScene=function(){this.facade.sendNotification(S.EXIT_SCENE,this.$sceneName);this.facade.sendNotification(suncore.NotifyKey.PAUSE_TIMELINE,[suncore.ModuleEnum.CUSTOM,true]);var e=_.getConfigByName(this.$sceneName);suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_LAZY,suncom.Handler.create(this,this.$beforeExitScene,[e]))};e.prototype.$beforeExitScene=function(e){e.uniCls&&suncore.System.addTask(suncore.ModuleEnum.SYSTEM,0,new e.uniCls);suncore.System.addTask(suncore.ModuleEnum.SYSTEM,0,new suncore.SimpleTask(suncom.Handler.create(this,this.$onExitScene,[e])))};e.prototype.$onExitScene=function(e){this.facade.sendNotification(S.UNLOAD_SCENE,e);this.$sceneName=0};e.prototype.enterScene=function(e,t){if(this.$ready===false){return false}this.$ready=false;this.$sceneName!=0&&this.$exitScene();this.$enterScene(e,t);C.addHistory(e,t);return true};e.prototype.exitScene=function(){if(this.$ready===false){return}this.$ready=false;this.$sceneName!=0&&this.$exitScene();C.removeHistory(this.$sceneName);var e=C.pop();e!==null&&this.$enterScene(e.name,e.data)};e.prototype.replaceScene=function(e,t){var r=C.pop();if(this.enterScene(e,t)===true){r!==null&&C.removeHistory(r.name)}};Object.defineProperty(e.prototype,"uiScene",{get:function(){return this.$uiScene},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"d3Scene",{get:function(){return this.$d3Scene},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"sceneName",{get:function(){return this.$sceneName},enumerable:true,configurable:true});return e}(puremvc.Notifier);r.SceneLayer=f;var d=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e,t,r){if(g.viewLayer.getInfoByView(e)!==null){console.error(e+"["+e.name+"] is already popup.");return}if(r.mod===void 0){r.mod=suncore.ModuleEnum.CUSTOM}if(r.ease===void 0){r.ease=Laya.Ease.backOut}if(r.trans===void 0){r.trans=false}if(r.keepNode===void 0){r.keepNode=false}var n=r.args;var o=r.trans;var i=r.level||e.zOrder||c.POPUP;var s=r.keepNode;delete r.args;delete r.trans;delete r.level;delete r.keepNode;this.$makeProps(r);var a=g.viewLayer.createMask(e,o);a.name="Mask$"+e.name;a.zOrder=e.zOrder=i;var u={view:e,mask:a,props:r,closed:false,keepNode:s,displayed:false,duration:t,cancelAllowed:false};g.viewLayer.addToStack(u);g.viewLayer.addChild(a);g.viewLayer.addChild(e);e["pivot"](e.width*.5,e.height*.5);g.viewLayer.onViewCreate(e,n);if(n===void 0){this.facade.sendNotification(S.ON_POPUP_CREATED,e)}else if(n instanceof Array){this.facade.sendNotification(S.ON_POPUP_CREATED,[e].concat(n))}else{this.facade.sendNotification(S.ON_POPUP_CREATED,[e,n])}this.$applyShowProps(e,r,t);if(o===false){h.get(a,u.props.mod).from({alpha:0},t>200?200:t)}var l=suncom.Handler.create(this,this.$onPopupFinish,[e]);suncore.System.addTrigger(u.props.mod,t,l)};t.prototype.$onPopupFinish=function(e){var t=g.viewLayer.getInfoByView(e);if(t!==null&&t.closed===false){t.displayed=true;g.viewLayer.onViewOpen(e);this.facade.sendNotification(S.ON_POPUP_OPENED,e)}};return t}(t);r.ShowPopupCommand=d;var y=function(){function e(){this.$loader=new s;this.$referenceCount=0;this.$handlers=[]}e.prototype.create=function(e,t,r){this.$referenceCount++;if(t!==null){this.$handlers.push(suncom.Handler.create(r,t))}this.$loader.loading===false&&this.$loader.load(e,suncom.Handler.create(this,this.$doCreate))};e.prototype.$doCreate=function(){var e=this.$handlers.slice(0);this.$handlers=[];while(e.length>0){var t=e.shift();t.runWith([this.$loader.create(),this.$loader.url])}};e.prototype.destroy=function(e,t,r){for(var n=0;n<this.$handlers.length;n++){var o=this.$handlers[n];if(o.method===t&&o.caller===r){this.$handlers.splice(n,1);break}}this.$referenceCount--;if(this.$referenceCount>0){return}else if(this.$referenceCount<0){throw Error("资源计数不应当小于0 url:"+e+", references:"+this.$referenceCount)}if(this.$referenceCount===0){this.$loader.destroy()}};Object.defineProperty(e.prototype,"referenceCount",{get:function(){return this.$referenceCount},enumerable:true,configurable:true});return e}();r.Templet=y;var m=function(){function e(e,t,r){this.$id=0;this.$urls=null;this.$handler=null;this.$doneList=[];this.$id=e;this.$urls=t;this.$handler=r;for(var n=0;n<this.$urls.length;n++){var o=this.$urls[n];P.create(o,this.$onResourceCreated,this)}}e.prototype.$onResourceCreated=function(e,t){if(e instanceof Laya.Skeleton){e.destroy()}this.$doneList.push(t);if(this.$doneList.length===this.$urls.length){this.$handler.runWith([this.$id])}};e.prototype.release=function(){for(var e=0;e<this.$urls.length;e++){var t=this.$urls[e];P.destroy(t,this.$onResourceCreated,this)}};return e}();r.TempletGroup=m;var h=function(n){__extends(r,n);function r(e,t){var r=n.call(this)||this;r.$infos=[];r.$props=null;r.$mod=t;r.$item=e;if(suncore.System.isModuleStopped(t)===false){r.facade.sendNotification(S.ADD_TWEEN_OBJECT,r)}else{console.error("尝试添加缓动，但时间轴己停止，mod:"+suncore.ModuleEnum[t])}return r}r.prototype.cancel=function(){this.$props=null;this.$infos.length=0;return this};r.prototype.to=function(e,t,r,n){if(r===void 0){r=null}if(n===void 0){n=null}var o=Object.keys(e);var i=this.$props===null?this.$item:this.$props;this.$createTweenInfo(o,i,e,t,r,n);return this};r.prototype.from=function(e,t,r,n){if(r===void 0){r=null}if(n===void 0){n=null}var o=Object.keys(e);var i=this.$props===null?this.$item:this.$props;this.$createTweenInfo(o,e,i,t,r,n);return this};r.prototype.by=function(e,t,r,n){if(r===void 0){r=null}if(n===void 0){n=null}var o=Object.keys(e);var i=this.$props===null?this.$item:this.$props;for(var s=0;s<o.length;s++){var a=o[s];if(this.$props===null||this.$props[a]===void 0){e[a]+=this.$item[a]}else{e[a]+=i[a]}}this.to(e,t,r,n);return this};r.prototype.$createTweenInfo=function(e,t,r,n,o,i){this.$props=this.$props||{};var s=[];for(var a=0;a<e.length;a++){var u=e[a];var l={prop:u,from:t[u],to:r[u]};if(l.from===void 0){l.from=this.$item[u]}s.push(l);this.$props[u]=r[u]}var c={ease:o,actions:s,handler:i,time:suncore.System.getModuleTimestamp(this.$mod),duration:n};this.$infos.push(c)};r.prototype.wait=function(e,t){if(t===void 0){t=null}var r={ease:null,actions:[],handler:t,time:suncore.System.getModuleTimestamp(this.$mod),duration:e};this.$infos.push(r);return this};r.prototype.doAction=function(){var e=suncore.System.getModuleTimestamp(this.$mod);var t=this.$infos[0];if(this.$item instanceof Laya.Node&&this.$item.destroyed===true){this.cancel();return}var r=false;var n=e-t.time;if(n>t.duration){r=true;n=t.duration}var o=t.ease||this.$easeNone;for(var i=0;i<t.actions.length;i++){var s=t.actions[i];if(r===true){this.$item[s.prop]=s.to}else{this.$item[s.prop]=o(n,s.from,s.to-s.from,t.duration)}}if(r===false){return}this.$infos.shift();if(this.$infos.length>0){this.$infos[0].time=suncore.System.getModuleTimestamp(this.$mod)}t.handler!==null&&t.handler.run()};r.prototype.$easeNone=function(e,t,r,n){var o=e/n;if(o>1){o=1}return o*r+t};Object.defineProperty(r.prototype,"mod",{get:function(){return this.$mod},enumerable:true,configurable:true});Object.defineProperty(r.prototype,"canceled",{get:function(){return this.$infos.length===0},enumerable:true,configurable:true});r.get=function(e,t){if(t===void 0){t=suncore.ModuleEnum.CUSTOM}return new r(e,t)};return r}(puremvc.Notifier);r.Tween=h;var p=function(t){__extends(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.$tweens=[false];return e}e.prototype.$onRun=function(){this.facade.registerObserver(S.ADD_TWEEN_OBJECT,this.$onAddTweenObject,this);this.facade.registerObserver(suncore.NotifyKey.PAUSE_TIMELINE,this.$onTimelinePause,this)};e.prototype.$onStop=function(){this.facade.removeObserver(S.ADD_TWEEN_OBJECT,this.$onAddTweenObject,this);this.facade.removeObserver(suncore.NotifyKey.PAUSE_TIMELINE,this.$onTimelinePause,this)};e.prototype.$frameLoop=function(){var e=this.$tweens;this.$tweens[0]=true;for(var t=suncore.ModuleEnum.MIN;t<suncore.ModuleEnum.MAX;t++){if(suncore.System.isModulePaused(t)===false){for(var r=e.length-1;r>0;r--){var n=e[r];if(n.mod===t&&n.canceled===false){n.doAction()}}}}this.$tweens[0]=false;for(var r=this.$tweens.length-1;r>0;r--){var n=this.$tweens[r];if(n.canceled===true){e.splice(r,1)}}};e.prototype.$onTimelinePause=function(e,t){if(t===true){for(var r=1;r<this.$tweens.length;r++){var n=this.$tweens[r];if(n.mod===e){n.cancel()}}}};e.prototype.$onAddTweenObject=function(e){if(this.$tweens[0]===true){this.$tweens=this.$tweens.slice(0);this.$tweens[0]=false}this.$tweens.push(e)};return e}(suncore.BaseService);r.TweenService=p;var v=function(t){__extends(e,t);function e(){var e=t.call(this)||this;g.viewLayer=new N;g.sceneLayer=new f;(new p).run();e.facade.registerCommand(S.SHOW_POPUP,d);e.facade.registerCommand(S.CLOSE_POPUP,i);return e}e.getInstance=function(){if(e.$inst===null){e.$inst=new e}return e.$inst};e.prototype.enterScene=function(e,t){suncore.Mutex.backup(this);g.sceneLayer.enterScene(e,t);suncore.Mutex.restore()};e.prototype.exitScene=function(){suncore.Mutex.backup(this);g.sceneLayer.exitScene();suncore.Mutex.restore()};e.prototype.replaceScene=function(e,t){suncore.Mutex.backup(this);g.sceneLayer.replaceScene(e,t);suncore.Mutex.restore()};e.prototype.removeView=function(e){g.viewLayer.removeStackByView(e)};Object.defineProperty(e.prototype,"uiScene",{get:function(){return g.sceneLayer.uiScene},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"d3Scene",{get:function(){return g.sceneLayer.d3Scene},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"sceneName",{get:function(){return g.sceneLayer.sceneName},enumerable:true,configurable:true});e.$inst=null;return e}(puremvc.Notifier);r.UIManager=v;var $=function(o){__extends(e,o);function e(e,t){var r=o.call(this)||this;r.$closedHandler=null;r.$removedHandler=null;r.$popup=t;r.$caller=e;if(g.viewLayer.getInfoByView(t)===null){throw Error("找不到"+t.name+"的弹出信息，请确认其为弹出对象")}r.facade.registerObserver(S.ON_POPUP_CLOSED,r.$onPopupClosed,r);r.facade.registerObserver(S.ON_POPUP_REMOVED,r.$onPopupRemoved,r);r.facade.registerObserver(S.EXIT_SCENE,r.$onCallerDestroy,r);var n=g.viewLayer.getInfoByView(e);if(n!==null){r.facade.registerObserver(S.ON_POPUP_REMOVED,r.$onCallerDestroy,r)}else{r.facade.registerObserver(S.ON_CALLER_DESTROYED,r.$onCallerDestroy,r)}return r}e.prototype.$onExitScene=function(){this.$onCallerDestroy(this.$caller)};e.prototype.$onCallerDestroy=function(e){if(e===this.$caller){this.facade.removeObserver(S.ON_POPUP_CLOSED,this.$onPopupClosed,this);this.facade.removeObserver(S.ON_POPUP_REMOVED,this.$onPopupRemoved,this);this.facade.removeObserver(S.EXIT_SCENE,this.$onCallerDestroy,this);this.facade.removeObserver(S.ON_POPUP_REMOVED,this.$onCallerDestroy,this);this.facade.removeObserver(S.ON_CALLER_DESTROYED,this.$onCallerDestroy,this)}};e.prototype.$onPopupClosed=function(e){if(e===this.$popup){if(this.$closedHandler!==null){this.$closedHandler.run();this.$closedHandler=null}if(this.$removedHandler===null){this.$onCallerDestroy(this.$caller)}}};e.prototype.$onPopupRemoved=function(e){if(e===this.$popup){if(this.$removedHandler!==null){this.$removedHandler.run();this.$removedHandler=null}this.$onCallerDestroy(this.$caller)}};e.prototype.onPopupClosed=function(e,t,r){if(this.$caller!==t){throw Error("caller与执行者不一致")}if(this.$closedHandler===null){this.$closedHandler=suncom.Handler.create(t,e,r)}else{throw Error("重复注册弹框关闭事件")}return this};e.prototype.onPopupRemoved=function(e,t,r){if(this.$caller!==t){throw Error("caller与执行者不一致")}if(this.$removedHandler===null){this.$removedHandler=suncom.Handler.create(t,e,r)}else{throw Error("重复注册弹框移除事件")}return this};return e}(puremvc.Notifier);r.ViewContact=$;var E=function(n){__extends(e,n);function e(e,t){var r=n.call(this)||this;r.$info=null;r.$view=e;if(r.info!==null){r.$duration=r.info.duration}else if(t===void 0){r.$duration=200}else{r.$duration=t}return r}e.prototype.popup=function(e){if(e===void 0){e={}}this.facade.sendNotification(S.SHOW_POPUP,[this.$view,this.$duration,e]);return this};e.prototype.close=function(e){this.facade.sendNotification(S.CLOSE_POPUP,[this.$view,this.$duration,e])};Object.defineProperty(e.prototype,"cancelAllowed",{get:function(){return this.info.cancelAllowed},set:function(e){this.info.cancelAllowed=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"info",{get:function(){if(this.$info===null){this.$info=g.viewLayer.getInfoByView(this.$view)}return this.$info},enumerable:true,configurable:true});return e}(puremvc.Notifier);r.ViewFacade=E;var O=function(t){__extends(e,t);function e(){var e=t.call(this)||this;e.$stack=[];e.facade.registerObserver(S.UNLOAD_SCENE,e.$onUnloadScene,e,false,0);return e}e.prototype.$onUnloadScene=function(){var e=this.$stack.concat();while(e.length>0){this.removeStackInfo(e.pop())}};e.prototype.removeStackInfo=function(e){var t=this.$stack.indexOf(e);if(t<0){return}this.$stack.splice(t,1);this.facade.sendNotification(S.BEFORE_POPUP_REMOVE,e.view);this.onViewRemove(e.view);this.removeChild(e.view);this.removeChild(e.mask);if(e.keepNode===false){this.destroyView(e.view);this.destroyMask(e.mask)}this.facade.sendNotification(S.ON_POPUP_REMOVED,e.view)};e.prototype.getInfoByView=function(e){for(var t=0;t<this.$stack.length;t++){var r=this.$stack[t];if(r.view===e){return r}}return null};e.prototype.addToStack=function(e){this.$stack.push(e)};e.prototype.removeStackByView=function(e){for(var t=0;t<this.$stack.length;t++){var r=this.$stack[t];if(r.view===e){this.removeStackInfo(r);break}}};return e}(puremvc.Notifier);r.ViewLayer=O;var N=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.addChild=function(e){var t=e;if(g.sceneLayer.uiScene===null||e.zOrder>=r.UILevel.LOADING){Laya.stage.addChild(t)}else{g.sceneLayer.uiScene.addChild(t)}};t.prototype.removeChild=function(e){var t=e;var r=t.parent||null;if(r===null){throw Error("无法移除显示对象，因为父节点不存在 "+t.name)}r.removeChild(t)};t.prototype.createMask=function(e,t){var r=new Laya.Image("common/mask.png");r.left=r.right=r.top=r.bottom=0;r.sizeGrid="1,1,1,1";r.alpha=t===true?0:1;r.mouseEnabled=true;r.mouseThrough=false;r.on(Laya.Event.CLICK,this,this.$onMaskClick,[e]);return r};t.prototype.$onMaskClick=function(e){var t=g.viewLayer.getInfoByView(e);if(t!==null&&t.closed===false&&t.cancelAllowed===true){new E(e).close()}};t.prototype.destroyMask=function(e){e.off(Laya.Event.CLICK,this,this.$onMaskClick);e.destroy()};t.prototype.onViewCreate=function(e,t){var r=e.getComponents(Laya.Component)||[];for(var n=0;n<r.length;n++){var o=r[n];if(o.$onCreate){if(t instanceof Array===false){o.$onCreate.call(o,t)}else{o.$onCreate.apply(o,t)}}}};t.prototype.onViewOpen=function(e){var t=e.getComponents(Laya.Component)||[];for(var r=0;r<t.length;r++){var n=t[r];if(n.$onOpen){n.$onOpen.call(n)}}};t.prototype.onViewClose=function(e){var t=e.getComponents(Laya.Component)||[];for(var r=0;r<t.length;r++){var n=t[r];if(n.$onClose){n.$onClose.call(n)}}};t.prototype.onViewRemove=function(e){var t=e.getComponents(Laya.Component)||[];for(var r=0;r<t.length;r++){var n=t[r];if(n.$onRemove){n.$onRemove.call(n)}}};t.prototype.destroyView=function(e){var t=e;t.destroy()};return t}(O);r.ViewLayerLaya3D=N;var g;(function(e){e.templets={}})(g=r.M||(r.M={}));var S;(function(e){e.LOAD_SCENE="sunui.NotifyKey.LOAD_SCENE";e.UNLOAD_SCENE="sunui.NotifyKey.UNLOAD_SCENE";e.BEFORE_LOAD_SCENE="sunui.NotifyKey.BEFORE_LOAD_SCENE";e.REGISTER_SCENES="sunui.NotifyKey.REGISTER_SCENES";e.ENTER_SCENE="sunui.NotifyKey.ENTER_SCENE";e.EXIT_SCENE="sunui.NotifyKey.EXIT_SCENE";e.ADD_TWEEN_OBJECT="sunui.NotifyKey.ADD_TWEEN_OBJECT";e.SHOW_POPUP="sunui.NotifyKey.SHOW_POPUP";e.CLOSE_POPUP="sunui.NotifyKey.CLOSE_POPUP";e.APPLY_POPUP_METHOD="sunui.NotifyKey.APPLY_POPUP_METHOD";e.ON_POPUP_CREATED="sunui.NotifyKey.ON_POPUP_CREATED";e.ON_POPUP_OPENED="sunui.NotifyKey.ON_POPUP_OPENED";e.ON_POPUP_CLOSED="sunui.NotifyKey.ON_POPUP_CLOSED";e.BEFORE_POPUP_REMOVE="sunui.NotifyKey.BEFORE_POPUP_REMOVE";e.ON_POPUP_REMOVED="sunui.NotifyKey.ON_POPUP_REMOVED";e.ON_CALLER_DESTROYED="sunui.NotifyKey.ON_CALLER_DESTROYED";e.RETRY_CONFIRM="sunui.NotifyKey.RETRY_CONFIRM"})(S=r.NotifyKey||(r.NotifyKey={}));var P;(function(l){var e=0;var i={};var c={};var s={};function a(){e++;return e}function t(e){var t=l.getLoadList(e);for(var r=0;r<t.length;r++){var n=t[r];var o=s[n]||0;s[n]=o+1}}l.lock=t;function r(e){var t=l.getLoadList(e);for(var r=0;r<t.length;r++){var n=t[r];var o=s[n]||0;if(o===0){throw Error("尝试解锁不存在的资源 url："+n)}if(o===1){delete s[n];Laya.loader.clearRes(n);Laya.loader.cancelLoadByUrl(n)}else{s[n]=o-1}}}l.unlock=r;function n(e){return s[e]||0}l.getReferenceByUrl=n;function o(e,t,r){if(t===void 0){t=null}if(r===void 0){r=null}var n=c[e]||null;if(n===null){n=c[e]=new y}l.lock(e);n.create(e,t,r);if((suncom.Global.debugMode&suncom.DebugMode.DEBUG)===suncom.DebugMode.DEBUG){console.log("================== resouce debug ==================");var o=Object.keys(c);for(var i=0,s=o;i<s.length;i++){var a=s[i];var u=c[a];console.log("url:"+a+", references:"+u.referenceCount)}console.log("================== resouce debug ==================")}}l.create=o;function u(e,t,r){if(t===void 0){t=null}if(r===void 0){r=null}var n=c[e]||null;if(n!==null){n.destroy(e,t,r);l.unlock(e);if(n.referenceCount===0){delete c[e]}}if((suncom.Global.debugMode&suncom.DebugMode.DEBUG)===suncom.DebugMode.DEBUG){console.log("================== resouce debug ==================");var o=Object.keys(c);for(var i=0,s=o;i<s.length;i++){var a=s[i];var u=c[a];console.log("url:"+a+", references:"+u.referenceCount)}console.log("================== resouce debug ==================")}}l.destroy=u;function f(e,t,r){var n=null;if(t===null){n=suncom.Handler.create(null,function(e){})}else{n=suncom.Handler.create(r,t)}var o=a();i[o]=new m(o,e,n);return o}l.prepare=f;function d(e){if(e>0){var t=suncom.Handler.create(null,h,[e]);suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_0,t)}return 0}l.release=d;function h(e){var t=i[e]||null;if(t!==null){delete i[e];t.release()}}function p(e){var t=e.lastIndexOf(".");var r=e.substr(0,t);var n=e.substr(t+1);if(n==="sk"){return[r+".png",r+".sk"]}else{return[e]}}l.getLoadList=p})(P=r.Resource||(r.Resource={}));var C;(function(e){var n=[];function r(e){for(var t=n.length-1;t>-1;t--){if(n[t].name===e){return t}}return-1}function t(e,t){var r={name:e,data:t};n.push(r)}e.addHistory=t;function o(e){var t=r(e);if(t>-1){n.splice(t,1)}return t>-1}e.removeHistory=o;function i(e){return r(e)>-1}e.hasHistory=i;function s(){if(n.length>0){return n[n.length-1]}return null}e.pop=s;function a(e){var t=r(e);if(t>-1){return n[t]}return null}e.popByName=a})(C=r.SceneHeap||(r.SceneHeap={}));var _;(function(e){var n=[];function t(e){for(var t=0;t<n.length;t++){if(n[t].name===e.name){throw Error("重复注册场景")}}n.push(e)}e.regScene=t;function r(e){for(var t=0;t<n.length;t++){var r=n[t];if(r.name===e){return r}}throw Error("场景配置不存在")}e.getConfigByName=r})(_=r.SceneManager||(r.SceneManager={}));function L(e,t){var r=e.split("/");while(t!=null&&r.length>0){var n=r.shift();t=t.getChildByName(n)}return t}r.find=L})(sunui||(sunui={}));