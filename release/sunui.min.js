var __extends=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(t.hasOwnProperty(r))e[r]=t[r]};return n(e,t)};return function(e,t){n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();var sunui;(function(i){var f;(function(e){e[e["NONE"]=0]="NONE";e[e["BACKGROUND"]=1]="BACKGROUND";e[e["SCENE"]=2]="SCENE";e[e["PANEL"]=3]="PANEL";e[e["FLOAT"]=4]="FLOAT";e[e["GOLD_TIPS"]=5]="GOLD_TIPS";e[e["HIGH_GOLD_TIPS"]=6]="HIGH_GOLD_TIPS";e[e["NOTICE"]=7]="NOTICE";e[e["BIGWINNER"]=8]="BIGWINNER";e[e["MINI_GAME"]=9]="MINI_GAME";e[e["POPUP"]=10]="POPUP";e[e["WAITINGBOX"]=11]="WAITINGBOX";e[e["LOADING"]=12]="LOADING";e[e["TIPS"]=13]="TIPS";e[e["TOP"]=14]="TOP";e[e["DEBUG"]=15]="DEBUG"})(f=i.UILevel||(i.UILevel={}));var e=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.$makeProps=function(e){if(e.x===void 0&&e.left===void 0&&e.right===void 0){e.centerX=0}if(e.y===void 0&&e.top===void 0&&e.bottom===void 0){e.centerY=0}return e};t.prototype.$applyShowProps=function(e,t,r){if(t.x!==void 0){e.x=t.x}if(t.y!==void 0){e.y=t.y}if(t.centerX!==void 0){e.centerX=t.centerX}if(t.centerY!==void 0){e.centerY=t.centerY}if(r==0){if(t.left!==void 0){e.left=t.left}if(t.right!==void 0){e.right=t.right}if(t.top!==void 0){e.top=t.top}if(t.bottom!==void 0){e.bottom=t.bottom}}else{if(t.left!==void 0){e.left=-e.width}if(t.right!==void 0){e.right=-e.width}if(t.top!==void 0){e.top=-e.height}if(t.bottom!==void 0){e.bottom=-e.height}if(t.left===void 0&&t.right===void 0&&t.top===void 0&&t.bottom===void 0){e.alpha=0;e.scaleX=0;e.scaleY=0;t.alpha=1;t.scaleX=1;t.scaleY=1}h.get(e,suncore.ModuleEnum.CUSTOM).to(t,r,t.ease)}};t.prototype.$applyCloseProps=function(e,t,r){if(r>0){if(t.left!==void 0){t.left=-e.width}if(t.right!==void 0){t.right=-e.width}if(t.top!==void 0){t.top=-e.height}if(t.bottom!==void 0){t.bottom=-e.height}if(t.left===void 0&&t.right===void 0&&t.top===void 0&&t.bottom===void 0){t.alpha=0;t.scaleX=0;t.scaleY=0}h.get(e,suncore.ModuleEnum.CUSTOM).to(t,r)}};return t}(puremvc.SimpleCommand);i.AbstractPopupCommand=e;var t=function(t){__extends(e,t);function e(){var e=t.call(this)||this;e.facade.registerObserver($.ENTER_SCENE,e.$onEnterScene,e,true);return e}e.prototype.run=function(){return true};e.prototype.$onEnterScene=function(){};return e}(suncore.AbstractTask);i.AbstractSceneIniClass=t;var r=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e,t,r){var n=m.viewLayer.getInfoByView(e);if(n===null){console.error(e+"["+e.name+"]'s infomation is not exist.");return}if(n.closed==true){return}if(r!==void 0){n.keepNode=!r}n.closed=true;if(suncore.System.isModulePaused(suncore.ModuleEnum.CUSTOM)===false){this.$applyCloseProps(e,n.props,t)}m.viewLayer.onViewClose(e);this.facade.sendNotification($.ON_POPUP_CLOSED,e);if(suncore.System.isModulePaused(suncore.ModuleEnum.CUSTOM)===false){var o=suncom.Handler.create(this,this.$onCloseFinish,[e]);h.get(n.mask,suncore.ModuleEnum.CUSTOM).to({alpha:200},t,null,o)}};t.prototype.$onCloseFinish=function(e){m.viewLayer.removeStackByView(e)};return t}(e);i.ClosePopupCommand=r;var n=function(){function e(){this.$templet=null;this.$url=null;this.$handler=null;this.$loading=false;this.$retryTimerId=0}e.prototype.load=function(e,t){if(this.$loading===false){this.$loading=true;this.$url=e;this.$handler=t;Laya.loader.load(this.$getLoadList(e),Laya.Handler.create(this,this.$onLoad))}};e.prototype.$onLoad=function(e){if(e===false){if(this.$templet===null){console.log("资源加载失败：url:"+this.$url+"，1秒后重新尝试...")}else{console.log("动画初始化失败：url:"+this.$url+"，1秒后重新尝试...")}this.$retryTimerId=suncore.System.addTimer(suncore.ModuleEnum.SYSTEM,1e3,this.$reload,this);return}if(this.getResExtByUrl(this.$url)==="sk"){if(this.$templet===null){this.$templet=new Laya.Templet;this.$templet.on(Laya.Event.ERROR,this,this.$onLoad,[false]);this.$templet.on(Laya.Event.COMPLETE,this,this.$onLoad,[true]);this.$templet.loadAni(this.$url);return}}this.$handler.run()};e.prototype.$reload=function(){if(this.$templet===null){Laya.loader.load(this.$getLoadList(this.$url),Laya.Handler.create(this,this.$onLoad))}else{this.$templet.loadAni(this.$url)}this.$retryTimerId=0};e.prototype.destroy=function(){this.$handler=null;this.$loading=false;if(this.$templet!==null){this.$templet.off(Laya.Event.ERROR,this,this.$onLoad);this.$templet.off(Laya.Event.COMPLETE,this,this.$onLoad);this.$templet.destroy();this.$templet=null}var e=this.$getLoadList(this.$url);for(var t=0;t<e.length;t++){var r=e[t];Laya.loader.clearRes(r)}Laya.loader.cancelLoadByUrls(this.$getLoadList(this.$url));this.$retryTimerId=suncore.System.removeTimer(this.$retryTimerId)};e.prototype.$getLoadList=function(e){var t=e.lastIndexOf(".");var r=e.substr(0,t);var n=e.substr(t+1);if(n==="sk"){return[r+".sk",r+".png"]}else{return[e]}};e.prototype.getResExtByUrl=function(e){return e.substr(e.lastIndexOf(".")+1)};e.prototype.create=function(){var e=null;if(this.$templet===null){e=Laya.loader.getRes(this.$url)||null}else{e=this.$templet.buildArmature(2)||null}if(e===null){throw Error("资源预加载出错 url:"+this.$url)}return e};Object.defineProperty(e.prototype,"loading",{get:function(){return this.$loading},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"url",{get:function(){return this.$url},enumerable:true,configurable:true});return e}();i.Loader=n;var o=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e){for(var t=0;t<e.length;t++){var r=e[t];g.regScene(r)}};return t}(puremvc.SimpleCommand);i.RegisterScenesCommand=o;var s=function(t){__extends(e,t);function e(){var e=t.call(this)||this;e.$ready=true;e.$sceneName=0;e.$uiScene=null;e.$d3Scene=null;e.facade.registerObserver($.ENTER_SCENE,e.$onEnterScene,e,false,5);return e}e.prototype.$enterScene=function(e,t){var r=null;if(typeof t==="object"){try{r=JSON.stringify(t)}catch(e){r=t;suncom.Logger.warn("参数无法转化为JSON")}}else{r=t}var n=g.getConfigByName(e);suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_LAZY,suncom.Handler.create(this,this.$beforeLoadScene,[n,t]));suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_LAZY,suncom.Handler.create(this,this.$loadScene,[n,t]))};e.prototype.$beforeLoadScene=function(e,t){this.$sceneName=e.name;var r=t===void 0?new e.iniCls:new e.iniCls(t);suncore.System.addTask(suncore.ModuleEnum.SYSTEM,r)};e.prototype.$loadScene=function(e,t){if(t===void 0){this.facade.sendNotification($.LOAD_SCENE,e)}else{this.facade.sendNotification($.LOAD_SCENE,[e,t])}};e.prototype.$onEnterScene=function(e,t){this.$ready=true;this.$uiScene=e;this.$d3Scene=t;this.facade.sendNotification(suncore.NotifyKey.START_TIMELINE,[suncore.ModuleEnum.CUSTOM,false])};e.prototype.$exitScene=function(){var e=g.getConfigByName(this.$sceneName);this.facade.sendNotification($.EXIT_SCENE,this.$sceneName);this.facade.sendNotification(suncore.NotifyKey.PAUSE_TIMELINE,[suncore.ModuleEnum.CUSTOM,true]);e.uniCls&&suncore.System.addTask(suncore.ModuleEnum.SYSTEM,new e.uniCls);suncore.System.addTask(suncore.ModuleEnum.SYSTEM,new suncore.SimpleTask(suncom.Handler.create(this,this.$onExitScene)))};e.prototype.$onExitScene=function(){var e=g.getConfigByName(this.$sceneName);this.facade.sendNotification($.UNLOAD_SCENE,e);this.$sceneName=0};e.prototype.enterScene=function(e,t){if(this.$ready==false){return false}this.$ready=false;this.$sceneName!=0&&this.$exitScene();this.$enterScene(e,t);O.addHistory(e,t);return true};e.prototype.exitScene=function(){if(this.$ready==false){return}this.$ready=false;this.$sceneName!=0&&this.$exitScene();O.removeHistory(this.$sceneName);var e=O.pop();e!==null&&this.$enterScene(e.name,e.data)};e.prototype.replaceScene=function(e,t){var r=O.pop();if(this.enterScene(e,t)==false){return}r!==null&&O.removeHistory(r.name)};Object.defineProperty(e.prototype,"uiScene",{get:function(){return this.$uiScene},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"d3Scene",{get:function(){return this.$d3Scene},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"sceneName",{get:function(){return this.$sceneName},enumerable:true,configurable:true});return e}(puremvc.Notifier);i.SceneLayer=s;var a=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e,t,r){if(m.viewLayer.getInfoByView(e)!==null){console.error(e+"["+e.name+"] is already popup.");return}if(r.ease===void 0){r.ease=Laya.Ease.backOut}if(r.trans===void 0){r.trans=.6}if(r.keepNode===void 0){r.keepNode=false}var n=r.args;var o=r.trans;var i=r.level||e.zOrder||f.POPUP;var s=r.keepNode;var a=r.viewClass;delete r.args;delete r.trans;delete r.level;delete r.keepNode;delete r.viewClass;r=this.$makeProps(r);var u=m.viewLayer.createMask(e);u.name="Mask$"+e.name;u.alpha=o;u.zOrder=e.zOrder=i;var l={view:e,viewClass:a,mask:u,level:i,props:r,closed:false,keepNode:s,displayed:false,duration:t,cancelAllowed:false};m.viewLayer.addStack(l);m.viewLayer.addChild(u);m.viewLayer.addChild(e);this.$applyShowProps(e,r,t);if(suncore.System.isModulePaused(suncore.ModuleEnum.CUSTOM)===false){m.viewLayer.onViewCreate(e,n);if(n===void 0){this.facade.sendNotification($.ON_POPUP_CREATED,e)}else if(n instanceof Array){this.facade.sendNotification($.ON_POPUP_CREATED,[e].concat(n))}else{this.facade.sendNotification($.ON_POPUP_CREATED,[e,n])}}if(suncore.System.isModulePaused(suncore.ModuleEnum.CUSTOM)===false){var c=suncom.Handler.create(this,this.$onPopupFinish,[e]);h.get(u,suncore.ModuleEnum.CUSTOM).from({alpha:0},200);suncore.System.addTrigger(suncore.ModuleEnum.CUSTOM,t,c)}};t.prototype.$onPopupFinish=function(e){var t=m.viewLayer.getInfoByView(e);if(t!==null){t.displayed=true;m.viewLayer.onViewOpen(e);this.facade.sendNotification($.ON_POPUP_OPENED,e)}};return t}(e);i.ShowPopupCommand=a;var d=function(){function e(){this.$loader=new n;this.$referenceCount=0;this.$handlers=[]}e.prototype.create=function(e,t,r){this.$referenceCount++;if(t!==null){this.$handlers.push(suncom.Handler.create(r,t))}this.$loader.loading===false&&this.$loader.load(e,suncom.Handler.create(this,this.$doCreate))};e.prototype.$doCreate=function(){var e=this.$handlers.slice(0);this.$handlers=[];while(e.length>0){var t=e.shift();t.runWith([this.$loader.create(),this.$loader.url])}};e.prototype.destroy=function(e,t,r){for(var n=0;n<this.$handlers.length;n++){var o=this.$handlers[n];if(o.method===t&&o.caller===r){this.$handlers.splice(n,1);break}}this.$referenceCount--;if(this.$referenceCount>0){return}else if(this.$referenceCount<0){throw Error("资源计数不应当小于0 url:"+e+", references:"+this.$referenceCount)}if(this.$referenceCount===0){this.$loader.destroy()}};Object.defineProperty(e.prototype,"referenceCount",{get:function(){return this.$referenceCount},enumerable:true,configurable:true});return e}();i.Templet=d;var l=function(){function e(e,t,r){this.$id=0;this.$urls=null;this.$handler=null;this.$doneList=[];this.$id=e;this.$urls=t;this.$handler=r;for(var n=0;n<this.$urls.length;n++){var o=this.$urls[n];E.create(o,this.$onResourceCreated,this)}}e.prototype.$onResourceCreated=function(e,t){if(e instanceof Laya.Skeleton){e.destroy()}this.$doneList.push(t);if(this.$doneList.length<this.$urls.length){return}this.$handler.runWith([this.$id])};e.prototype.release=function(){for(var e=0;e<this.$urls.length;e++){var t=this.$urls[e];E.destroy(t,this.$onResourceCreated,this)}};return e}();i.TempletGroup=l;var h=function(){function u(e,t){this.$infos=[];this.$configs=[];this.$mod=t;this.$item=e;if(suncore.System.isModuleStopped(t)===false){puremvc.Facade.getInstance().registerObserver(suncore.NotifyKey.ENTER_FRAME,this.$onEnterFrame,this);puremvc.Facade.getInstance().registerObserver(suncore.NotifyKey.PAUSE_TIMELINE,this.$onTimelinePause,this)}}u.get=function(e,t){if(t===void 0){t=suncore.ModuleEnum.CUSTOM}return new u(e,t)};u.prototype.$onTimelinePause=function(e,t){if(this.$mod===e&&t===true){this.clear()}};u.prototype.clear=function(){this.$item=null;puremvc.Facade.getInstance().removeObserver(suncore.NotifyKey.ENTER_FRAME,this.$onEnterFrame,this);puremvc.Facade.getInstance().removeObserver(suncore.NotifyKey.PAUSE_TIMELINE,this.$onTimelinePause,this)};u.easeNone=function(e,t,r,n){var o=e/n;if(o>1){o=1}return o*r+t};u.prototype.$onEnterFrame=function(){if(suncore.System.isModuleStopped(this.$mod)===true){this.clear();return}if(suncore.System.isModulePaused(this.$mod)===true){return}var e=suncore.System.getModuleTimestamp(this.$mod);var t=this.$infos[0];var r=this.$configs[0];var n=false;var o=e-r.time;if(o>r.duration){n=true;o=r.duration}var i=r.ease||u.easeNone;for(var s=0;s<t.length;s++){var a=t[s];if(n==true){this.$item[a.prop]=a.to}else{this.$item[a.prop]=i(o,a.from,a.to-a.from,r.duration)}}if(n==false){return}r.handler&&r.handler.run();this.$infos.shift();this.$configs.shift();if(this.$configs.length==0){this.clear()}else{this.$configs[0].time=suncore.System.getModuleTimestamp(this.$mod)}};u.prototype.to=function(e,t,r,n){if(r===void 0){r=null}if(n===void 0){n=null}if(suncore.System.isModuleStopped(this.$mod)===true){return this}var o=Object.keys(e);var i=this.$target?this.$target:this.$item;this.$beforeTween(o,i,e,t,r,n);return this};u.prototype.from=function(e,t,r,n){if(r===void 0){r=null}if(n===void 0){n=null}if(suncore.System.isModuleStopped(this.$mod)===true){return this}var o=Object.keys(e);var i=this.$target?this.$target:this.$item;this.$beforeTween(o,e,i,t,r,n);return this};u.prototype.$beforeTween=function(e,t,r,n,o,i){this.$target=this.$target||{};var s=[];for(var a=0;a<e.length;a++){var u=e[a];var l={prop:u,from:t[u],to:r[u]};if(l.from===void 0){l.from=this.$item[u]}s.push(l);this.$target[u]=r[u]}this.$infos.push(s);var c={time:suncore.System.getModuleTimestamp(this.$mod),ease:o,handler:i,duration:n};this.$configs.push(c)};return u}();i.Tween=h;var u=function(t){__extends(e,t);function e(){var e=t.call(this)||this;m.viewLayer=new v;m.sceneLayer=new s;e.facade.registerCommand($.SHOW_POPUP,a);e.facade.registerCommand($.CLOSE_POPUP,r);return e}e.getInstance=function(){if(e.$inst==null){e.$inst=new e}return e.$inst};e.prototype.enterScene=function(e,t){m.sceneLayer.enterScene(e,t)};e.prototype.exitScene=function(){m.sceneLayer.exitScene()};e.prototype.replaceScene=function(e,t){m.sceneLayer.replaceScene(e,t)};e.prototype.hasView=function(e){return m.viewLayer.hasView(e)};e.prototype.showView=function(e,t,r){if(r===void 0){r={}}r.level=f.POPUP;m.viewLayer.showView(e,t,r)};e.prototype.closeView=function(e){m.viewLayer.closeView(e)};e.prototype.removeView=function(e){m.viewLayer.removeStackByView(e)};e.prototype.removeViewByClass=function(e){m.viewLayer.removeStackByViewClass(e)};Object.defineProperty(e.prototype,"uiScene",{get:function(){return m.sceneLayer.uiScene},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"d3Scene",{get:function(){return m.sceneLayer.d3Scene},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"sceneName",{get:function(){return m.sceneLayer.sceneName},enumerable:true,configurable:true});e.$inst=null;return e}(puremvc.Notifier);i.UIManager=u;var p=function(o){__extends(e,o);function e(e,t){var r=o.call(this)||this;r.$popup=null;r.$caller=null;r.$closedHandler=null;r.$removedHandler=null;r.$popup=t;r.$caller=e;r.facade.registerObserver(i.NotifyKey.EXIT_SCENE,r.$onCallerDestroy,r);var n=m.viewLayer.getInfoByView(e);if(n!==null){r.facade.registerObserver(i.NotifyKey.ON_POPUP_REMOVED,r.$onCallerDestroy,r)}else{r.facade.registerObserver(i.NotifyKey.ON_CALLER_DESTROYED,r.$onCallerDestroy,r)}if(m.viewLayer.getInfoByView(t)===null){throw Error("找不到"+t.name+"的弹出信息，请确认其为弹出对象")}r.facade.registerObserver(i.NotifyKey.ON_POPUP_CLOSED,r.$onPopupClosed,r);r.facade.registerObserver(i.NotifyKey.ON_POPUP_REMOVED,r.$onPopupRemoved,r);return r}e.prototype.$onExitScene=function(){this.$onCallerDestroy(this.$caller)};e.prototype.$onCallerDestroy=function(e){if(e===this.$caller){this.facade.removeObserver(i.NotifyKey.EXIT_SCENE,this.$onCallerDestroy,this);this.facade.removeObserver(i.NotifyKey.ON_POPUP_REMOVED,this.$onCallerDestroy,this);this.facade.removeObserver(i.NotifyKey.ON_CALLER_DESTROYED,this.$onCallerDestroy,this);this.facade.removeObserver(i.NotifyKey.ON_POPUP_CLOSED,this.$onPopupClosed,this);this.facade.removeObserver(i.NotifyKey.ON_POPUP_REMOVED,this.$onPopupRemoved,this)}};e.prototype.$onPopupClosed=function(e,t,r){if(this.$closedHandler!==null){this.$closedHandler.run();this.$closedHandler=null}if(this.$removedHandler===null){this.$onCallerDestroy(this.$caller)}};e.prototype.$onPopupRemoved=function(e){if(this.$removedHandler!==null){this.$removedHandler.run();this.$removedHandler=null}this.$onCallerDestroy(this.$caller)};e.prototype.onPopupClosed=function(e,t,r){if(this.$caller!==t){throw Error("caller与执行者不一致")}if(this.$closedHandler===null){this.$closedHandler=suncom.Handler.create(t,e,r)}else{throw Error("重复监听弹出对象的关闭事件")}return this};e.prototype.onPopupRemoved=function(e,t,r){if(this.$caller!==t){throw Error("caller与执行者不一致")}if(this.$removedHandler===null){this.$removedHandler=suncom.Handler.create(t,e,r)}else{throw Error("重复监听弹出对象的移除事件")}return this};return e}(puremvc.Notifier);i.ViewContact=p;var c=function(n){__extends(e,n);function e(e,t){var r=n.call(this)||this;r.$info=null;r.$view=e;if(r.info){r.$duration=r.info.duration}else if(t===void 0){r.$duration=200}else{r.$duration=t}return r}e.prototype.popup=function(e){if(e===void 0){e={}}if(this.facade.hasCommand($.SHOW_POPUP)==true){this.facade.sendNotification($.SHOW_POPUP,[this.$view,this.$duration,e])}return this};e.prototype.close=function(e){if(this.facade.hasCommand($.CLOSE_POPUP)==true){this.facade.sendNotification($.CLOSE_POPUP,[this.$view,this.$duration,e])}};Object.defineProperty(e.prototype,"cancelAllowed",{get:function(){return this.info.cancelAllowed},set:function(e){this.info.cancelAllowed=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"info",{get:function(){if(this.$info==null){this.$info=m.viewLayer.getInfoByView(this.$view)}return this.$info},enumerable:true,configurable:true});return e}(puremvc.Notifier);i.ViewFacade=c;var y=function(t){__extends(e,t);function e(){var e=t.call(this)||this;e.$infos=[];e.facade.registerObserver($.UNLOAD_SCENE,e.$onUnloadScene,e,false,0);return e}e.prototype.$onUnloadScene=function(){var e=this.$infos.concat();while(e.length>0){this.removeStackByInfo(e.pop())}};e.prototype.removeStackByInfo=function(e){var t=this.$infos.indexOf(e);if(t<0){return}this.$infos.splice(t,1);this.onViewRemove(e.view);this.removeChild(e.view);this.removeChild(e.mask);if(e.keepNode==false){this.facade.sendNotification($.BEFORE_POPUP_REMOVED,e.view);this.destroyMask(e.mask);this.destroyView(e.view)}this.facade.sendNotification($.ON_POPUP_REMOVED,e.view)};e.prototype.isViewExistInLevel=function(e){for(var t=0;t<this.$infos.length;t++){var r=this.$infos[t];if(r.closed===false&&r.level===e){return true}}return false};e.prototype.getActiveViewInfo=function(){for(var e=this.$infos.length-1;e>-1;e--){var t=this.$infos[e];if(t.closed==false){return t}}return null};e.prototype.getInfoByView=function(e){for(var t=this.$infos.length-1;t>-1;t--){var r=this.$infos[t];if(r.view===e){return r}}return null};e.prototype.addStack=function(e){var t=-1;for(var r=0;r<this.$infos.length;r++){var n=this.$infos[r];if(t==-1&&n.level>e.level){t=r;break}}if(t==-1){this.$infos.push(e)}else{this.$infos.splice(t,0,e)}};e.prototype.removeStackByView=function(e){for(var t=this.$infos.length-1;t>-1;t--){var r=this.$infos[t];if(r.view==e){this.removeStackByInfo(r);break}}};e.prototype.removeStackByViewClass=function(e){var t=[];for(var r=0;r<this.$infos.length;r++){var n=this.$infos[r];if(n.viewClass==e){t.push(n)}}while(t.length>0){this.removeStackByInfo(t.pop())}};e.prototype.hasView=function(e){for(var t=0;t<this.$infos.length;t++){var r=this.$infos[t];if(r.closed==true){continue}if(r.viewClass===e){return true}}return false};e.prototype.showView=function(e,t,r){if(r===void 0){r={}}if(r.cancelAllowed===void 0){r.cancelAllowed=true}var n=r.cancelAllowed;delete r.cancelAllowed;var o=this.createViewByClass(e);r.args=t;r.keepNode=false;r.viewClass=e;new c(o).popup(r).cancelAllowed=n;return o};e.prototype.closeView=function(e){new c(e).close()};Object.defineProperty(e.prototype,"isCurrentViewCancelAllowed",{get:function(){var e=this.getActiveViewInfo();if(e!=null&&e.cancelAllowed===true){return true}return false},enumerable:true,configurable:true});return e}(puremvc.Notifier);i.ViewLayer=y;var v=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.addChild=function(e){m.sceneLayer.uiScene.addChild(e)};t.prototype.addChildAt=function(e,t){m.sceneLayer.uiScene.addChildAt(e,t)};t.prototype.removeChild=function(e){m.sceneLayer.uiScene.removeChild(e)};t.prototype.removeChildAt=function(e){m.sceneLayer.uiScene.removeChildAt(e)};t.prototype.createMask=function(e){var t=new Laya.Image("common/mask.png");t.left=t.right=t.top=t.bottom=0;t.sizeGrid="1,1,1,1";t.alpha=.5;t.mouseEnabled=true;t.mouseThrough=false;return t};t.prototype.onViewCreate=function(e,t){var r=e;var n=r.getComponents(Laya.Component)||[];for(var o=0,i=n;o<i.length;o++){var s=i[o];if(s.$onCreate){if(t instanceof Array){s.$onCreate.apply(s,t)}else{s.$onCreate.call(s,t)}}}};t.prototype.onViewOpen=function(e){var t=e;var r=t.getComponents(Laya.Component)||[];for(var n=0,o=r;n<o.length;n++){var i=o[n];if(i.$onOpen){i.$onOpen.call(i)}}};t.prototype.onViewClose=function(e){var t=e;var r=t.getComponents(Laya.Component)||[];for(var n=0,o=r;n<o.length;n++){var i=o[n];if(i.$onClose){i.$onClose.call(i)}}};t.prototype.onViewRemove=function(e){var t=e;var r=t.getComponents(Laya.Component)||[];for(var n=0,o=r;n<o.length;n++){var i=o[n];if(i.$onRemove){i.$onRemove.call(i)}}};t.prototype.destroyMask=function(e){var t=e;t.destroy()};t.prototype.createViewByClass=function(e){if(typeof e==="string"){var t=new Laya.Prefab;t.json=Laya.Loader.getRes(e);return t.create()}else{return new e}};t.prototype.destroyView=function(e){var t=e;t.destroy()};return t}(y);i.ViewLayerLaya3D=v;var m;(function(e){e.templets={}})(m=i.M||(i.M={}));var $;(function(e){e.LOAD_SCENE="sunui.NotifyKey.LOAD_SCENE";e.UNLOAD_SCENE="sunui.NotifyKey.UNLOAD_SCENE";e.REGISTER_SCENES="sunui.NotifyKey.REGISTER_SCENES";e.ENTER_SCENE="sunui.NotifyKey.ENTER_SCENE";e.EXIT_SCENE="sunui.NotifyKey.EXIT_SCENE";e.SHOW_POPUP="sunui.NotifyKey.SHOW_POPUP";e.CLOSE_POPUP="sunui.NotifyKey.CLOSE_POPUP";e.ON_POPUP_CREATED="sunui.NotifyKey.ON_POPUP_CREATED";e.ON_POPUP_OPENED="sunui.NotifyKey.ON_POPUP_OPENED";e.ON_POPUP_CLOSED="sunui.NotifyKey.ON_POPUP_CLOSED";e.BEFORE_POPUP_REMOVED="sunui.NotifyKey.BEFORE_POPUP_REMOVED";e.ON_POPUP_REMOVED="sunui.NotifyKey.ON_POPUP_REMOVED";e.ON_CALLER_DESTROYED="sunui.NotifyKey.ON_CALLER_DESTROYED"})($=i.NotifyKey||(i.NotifyKey={}));var E;(function(e){var t=0;var i={};var c={};function s(){t++;return t}function r(e,t,r,n){if(t===void 0){t=null}if(r===void 0){r=null}if(n===void 0){n=0}var o=c[e]||null;if(o===null){o=c[e]=new d}o.create(e,t,r);if((suncom.Global.debugMode&suncom.DebugMode.DEBUG)===suncom.DebugMode.DEBUG){console.log("================== resouce debug ==================");var i=Object.keys(c);for(var s=0,a=i;s<a.length;s++){var u=a[s];var l=c[u];console.log("url:"+u+", references:"+l.referenceCount)}console.log("================== resouce debug ==================")}}e.create=r;function n(e,t,r){if(t===void 0){t=null}if(r===void 0){r=null}var n=c[e]||null;if(n!==null){n.destroy(e,t,r);if(n.referenceCount===0){delete c[e]}}if((suncom.Global.debugMode&suncom.DebugMode.DEBUG)===suncom.DebugMode.DEBUG){console.log("================== resouce debug ==================");var o=Object.keys(c);for(var i=0,s=o;i<s.length;i++){var a=s[i];var u=c[a];console.log("url:"+a+", references:"+u.referenceCount)}console.log("================== resouce debug ==================")}}e.destroy=n;function o(e,t,r){var n=null;if(t===null){n=suncom.Handler.create(null,function(e){})}else{n=suncom.Handler.create(r,t)}var o=s();i[o]=new l(o,e,n);return o}e.prepare=o;function a(e,t){if(t===void 0){t=null}if(e>0){if(t!==null){new p(null,t).onPopupRemoved(a,null,[e])}else{suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_0,suncom.Handler.create(null,u,[e]))}}return 0}e.release=a;function u(e){var t=i[e]||null;if(t!==null){delete i[e];t.release()}}})(E=i.Resource||(i.Resource={}));var O;(function(e){var n=[];function r(e){for(var t=n.length-1;t>-1;t--){if(n[t].name===e){return t}}return-1}function t(e,t){var r={name:e,data:t};n.push(r)}e.addHistory=t;function o(e){var t=r(e);if(t>-1){n.splice(t,1)}return t>-1}e.removeHistory=o;function i(e){return r(e)>-1}e.hasHistory=i;function s(){if(n.length>0){return n[n.length-1]}return null}e.pop=s;function a(e){var t=r(e);if(t>-1){return n[t]}return null}e.popByName=a})(O=i.SceneHeap||(i.SceneHeap={}));var g;(function(e){var n=[];function t(e){for(var t=0;t<n.length;t++){if(n[t].name===e.name){throw Error("重复注册场景")}}n.push(e)}e.regScene=t;function r(e){for(var t=0;t<n.length;t++){var r=n[t];if(r.name===e){return r}}throw Error("场景配置不存在")}e.getConfigByName=r})(g=i.SceneManager||(i.SceneManager={}));function S(e,t){var r=e.split("/");while(t!=null&&r.length>0){var n=r.shift();t=t.getChildByName(n)}return t}i.find=S})(sunui||(sunui={}));