var __extends=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)if(t.hasOwnProperty(o))e[o]=t[o]};return n(e,t)};return function(e,t){n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}}();var sunui;(function(o){var i;(function(e){e[e["NONE"]=0]="NONE";e[e["YES"]=1]="YES";e[e["NO"]=2]="NO";e[e["CANCEL"]=3]="CANCEL"})(i=o.ConfirmOptionValueEnum||(o.ConfirmOptionValueEnum={}));var l;(function(e){e[e["NONE"]=0]="NONE";e[e["SIMPLY"]=1]="SIMPLY";e[e["TRANSPARENT"]=2]="TRANSPARENT";e[e["MOUSE_THROUGH"]=4]="MOUSE_THROUGH";e[e["SYNC_FADE_TIME"]=8]="SYNC_FADE_TIME"})(l=o.PopupFlagEnum||(o.PopupFlagEnum={}));var t;(function(e){e[e["NONE"]=0]="NONE";e[e["HIGH"]=131072]="HIGH";e[e["MID"]=32768]="MID";e[e["LOW"]=8192]="LOW"})(t=o.ResourceDownloadSpeedEnum||(o.ResourceDownloadSpeedEnum={}));var u;(function(e){e[e["AUTO"]=16]="AUTO";e[e["CONFIRM"]=32]="CONFIRM";e[e["TERMINATE"]=64]="TERMINATE"})(u=o.RetryMethodEnum||(o.RetryMethodEnum={}));var c;(function(e){e[e["NONE"]=0]="NONE";e[e["BACKGROUND"]=1]="BACKGROUND";e[e["SCENE"]=2]="SCENE";e[e["PANEL"]=3]="PANEL";e[e["FLOAT"]=4]="FLOAT";e[e["GOLD_TIPS"]=5]="GOLD_TIPS";e[e["HIGH_GOLD_TIPS"]=6]="HIGH_GOLD_TIPS";e[e["NOTICE"]=7]="NOTICE";e[e["BIGWINNER"]=8]="BIGWINNER";e[e["MINI_GAME"]=9]="MINI_GAME";e[e["POPUP"]=10]="POPUP";e[e["WAITINGBOX"]=11]="WAITINGBOX";e[e["LOADING"]=12]="LOADING";e[e["LAMP_TIPS"]=13]="LAMP_TIPS";e[e["TIPS"]=14]="TIPS";e[e["TOP"]=15]="TOP";e[e["DEBUG"]=16]="DEBUG"})(c=o.UILevel||(o.UILevel={}));var e=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.$makeProps=function(e){if(e.x===void 0&&e.left===void 0&&e.right===void 0){e.centerX=0}if(e.y===void 0&&e.top===void 0&&e.bottom===void 0){e.centerY=0}};t.prototype.$applyShowProps=function(e,t,o){if(t.x!==void 0){e.x=t.x}if(t.y!==void 0){e.y=t.y}if(t.centerX!==void 0){e.centerX=t.centerX}if(t.centerY!==void 0){e.centerY=t.centerY}if(o===0||t.flags&l.SIMPLY){if(t.left!==void 0){e.left=t.left}if(t.right!==void 0){e.right=t.right}if(t.top!==void 0){e.top=t.top}if(t.bottom!==void 0){e.bottom=t.bottom}if(t.scaleX!==void 0){e.scaleX=t.scaleX}if(t.scaleY!==void 0){e.scaleY=t.scaleY}}else{if(t.left!==void 0){e.left=-e.width}if(t.right!==void 0){e.right=-e.width}if(t.top!==void 0){e.top=-e.height}if(t.bottom!==void 0){e.bottom=-e.height}if(t.left===void 0&&t.right===void 0&&t.top===void 0&&t.bottom===void 0){e.alpha=0;e.scaleX=0;e.scaleY=0;t.alpha=1;if(t.scaleX===void 0){t.scaleX=1}if(t.scaleY===void 0){t.scaleY=1}}S.get(e,t.mod).to(t,o,t.ease)}};t.prototype.$applyCloseProps=function(e,t,o){if(o>0&&(t.flags&l.SIMPLY)===l.NONE){if(t.left!==void 0){t.left=-e.width}if(t.right!==void 0){t.right=-e.width}if(t.top!==void 0){t.top=-e.height}if(t.bottom!==void 0){t.bottom=-e.height}if(t.left===void 0&&t.right===void 0&&t.top===void 0&&t.bottom===void 0){t.alpha=0;t.scaleX=0;t.scaleY=0}S.get(e,t.mod).to(t,o)}};return t}(puremvc.SimpleCommand);o.AbstractPopupCommand=e;var n=function(n){__extends(e,n);function e(e,t){var o=n.call(this)||this;o.$info=null;o.$info=e;o.$data=t;return o}return e}(suncore.AbstractTask);o.AbstractSceneTask=n;var r=function(n){__extends(e,n);function e(e,t){var o=n.call(this)||this;o.$loading=false;o.$complete=null;o.$url=null;o.$loaders=[];o.$doneCount=0;o.$url=e;o.$complete=t;I.lock(o.$url);return o}e.prototype.destroy=function(){if(this.$destroyed===true){return}n.prototype.destroy.call(this);for(var e=0;e<this.$loaders.length;e++){this.$loaders[e].destroy()}I.unlock(this.$url)};e.prototype.load=function(){if(this.$loading===false&&this.$destroyed===false){this.$loading=true;this.$doLoad()}};e.prototype.$loadAssets=function(e){this.$doneCount=this.$loaders.length;for(var t=0;t<e.length;t++){this.$loaders.push(new R(e[t],suncom.Handler.create(this,this.$onLoadAsset)))}};e.prototype.$onLoadAsset=function(e){if(e===false){this.$onAssetsLoaded(false)}else{this.$doneCount++;if(this.$doneCount===this.$loaders.length){this.$onAssetsLoaded(true)}}};e.prototype.$onComplete=function(e){if(this.$destroyed===false){this.$complete.runWith(e)}this.destroy();this.$loading=false};return e}(puremvc.Notifier);o.AssetLoader=r;var d=function(n){__extends(e,n);function e(e,t){var o=n.call(this)||this;o.$url=null;o.$complete=null;o.$loader=null;o.$retryer=new p(u.TERMINATE,suncom.Handler.create(o,o.$onRetryConfirmed),"资源加载失败，点击确定重新尝试！");I.lock(e);o.$url=e;o.$complete=t;o.$doLoad();return o}e.prototype.destroy=function(){if(this.$destroyed===true){return}n.prototype.destroy.call(this);this.$retryer.cancel();this.$loader!==null&&this.$loader.destroy();I.unlock(this.$url)};e.prototype.$doLoad=function(){var e=suncom.Handler.create(this,this.$onLoad);if(I.isRes3dUrl(this.$url)===true){this.$loader=new f(this.$url,e)}else if(suncom.Common.getFileExtension(this.$url)==="sk"){this.$loader=new v(this.$url,e)}else{this.$loader=new _(this.$url,e)}this.$loader.load()};e.prototype.$onLoad=function(e){if(e===true){this.$complete.runWith(this.$url)}else{this.$retryer.run(1e3,suncom.Handler.create(this,this.$doLoad),2)}this.$loader=null};e.prototype.$onRetryConfirmed=function(e){if(e===i.NO){this.$retryer.reset();suncom.Logger.warn(suncom.DebugMode.ANY,"失败："+this.$url);this.facade.sendNotification(D.ON_ASSET_SAFETY_LOADER_FAILED);this.facade.registerObserver(D.ASSET_SAFETY_LOADER_RETRY,this.$onAssetSafetyLoaderRetry,this,true)}else{this.facade.sendNotification(suncore.NotifyKey.SHUTDOWN)}};e.prototype.$onAssetSafetyLoaderRetry=function(){if(this.$destroyed===false){suncom.Logger.warn(suncom.DebugMode.ANY,"重试："+this.$url);this.$doLoad()}};Object.defineProperty(e.prototype,"complete",{get:function(){return this.$complete},enumerable:true,configurable:true});return e}(puremvc.Notifier);o.AssetSafetyLoader=d;var s=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e,t,o){var n=w.viewLayer.getInfoByView(e);if(n===null){suncom.Logger.error(suncom.DebugMode.ANY,e+"["+(e&&e.name)+"]'s infomation is not exist.");return}if(o!==void 0){n.keepNode=!o}if(n.closed===true){return}n.closed=true;w.viewLayer.onViewClose(e);this.facade.sendNotification(D.ON_POPUP_CLOSED,e);if((n.props.flags&l.TRANSPARENT)===l.NONE){var r=S.get(n.mask,n.props.mod);if(t>200&&(n.props.flags&l.SYNC_FADE_TIME)===l.NONE){r.wait(t-200).to({alpha:0},200)}else{r.to({alpha:0},t)}}this.$applyCloseProps(e,n.props,t);var i=suncom.Handler.create(this,this.$onCloseFinish,[e]);suncore.System.addTrigger(n.props.mod,t,i)};t.prototype.$onCloseFinish=function(e){w.viewLayer.removeStackInfoByView(e)};return t}(e);o.ClosePopupCommand=s;var a=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e){for(var t=0;t<e.length;t++){var o=e[t];k.regScene(o)}};return t}(puremvc.SimpleCommand);o.RegisterScenesCommand=a;var f=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.$doLoad=function(){var e=I.getRes3dJsonUrl(this.$url);var t=Laya.loader.getRes(this.$url)===void 0?false:true;if(suncom.Common.getFileExtension(this.$url)==="ls"||t===true){this.$loadAssets([e])}else{this.$loaders.push(new R(e,suncom.Handler.create(this,this.$onUrlLoaded)))}};t.prototype.$onUrlLoaded=function(e,t){if(e===true){var o=w.cacheMap[this.$url]||null;if(o===null){this.$loadAssets([this.$url])}else{this.$onAssetsLoaded(true)}}else{this.$onComplete(false)}};t.prototype.$onAssetsLoaded=function(e){if(suncom.Common.getFileExtension(this.$url)==="ls"){this.$onComplete(e)}else{var t=w.cacheMap[this.$url]||null;if(t===null){t=w.cacheMap[this.$url]=Laya.loader.getRes(this.$url)}this.$onComplete(e)}};return t}(r);o.Res3dLoader=f;var h=function(t){__extends(n,t);function n(){var e=t!==null&&t.apply(this,arguments)||this;e.$undoList=[];e.$loadingList=[];e.$isRetryPrompting=false;return e}n.prototype.$onRun=function(){this.facade.registerObserver(D.ON_URL_SAFETY_LOADER_CREATED,this.$onUrlSafetyLoaderCreated,this);this.facade.registerObserver(D.ON_URL_SAFETY_LOADER_COMPLETE,this.$onUrlSafetyLoaderComplete,this);this.facade.registerObserver(D.ON_ASSET_SAFETY_LOADER_FAILED,this.$onAssetSafetyLoaderFailed,this)};n.prototype.$onStop=function(){this.facade.removeObserver(D.ON_URL_SAFETY_LOADER_CREATED,this.$onUrlSafetyLoaderCreated,this);this.facade.removeObserver(D.ON_URL_SAFETY_LOADER_COMPLETE,this.$onUrlSafetyLoaderComplete,this);this.facade.removeObserver(D.ON_ASSET_SAFETY_LOADER_FAILED,this.$onAssetSafetyLoaderFailed,this)};n.prototype.$onUrlSafetyLoaderCreated=function(e){this.$undoList.unshift(e);if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.trace(suncom.DebugMode.ANY,"create loader for url "+e.url+", loading list length:"+this.$loadingList.length+", undo list length:"+this.$undoList.length)}this.$next()};n.prototype.$onUrlSafetyLoaderComplete=function(e){var t=this.$loadingList.indexOf(e);suncom.Test.expect(t).toBeGreaterOrEqualThan(0);this.$loadingList.splice(t,1);if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.trace(suncom.DebugMode.ANY,"remove loader for url "+e.url+", loading list length:"+this.$loadingList.length+", undo list length:"+this.$undoList.length)}this.$next()};n.prototype.$next=function(){while(this.$undoList.length>0&&this.$loadingList.length<n.MAX_LOAD_COUNT){var e=false;for(var t=this.$undoList.length-1;t>-1;t--){var o=this.$undoList[t];if(o.destroyed===true){this.$undoList.splice(t,1);continue}if(this.$isUrlInLoading(o.url)===true){continue}if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.trace(suncom.DebugMode.ANY,"load next url "+o.url+", loading list length:"+this.$loadingList.length+" + 1")}e=true;o.load();this.$loadingList.push(o);break}if(e===false){break}}};n.prototype.$isUrlInLoading=function(e){for(var t=0;t<this.$loadingList.length;t++){var o=this.$loadingList[t];if(o.url===e){return true}}return false};n.prototype.$onAssetSafetyLoaderFailed=function(){if(this.$isRetryPrompting===false){this.$isRetryPrompting=true;this.facade.sendNotification(D.RETRY_CONFIRM,[suncore.ModuleEnum.SYSTEM,"资源加载失败，点击确定重新尝试！",[i.YES,"确定",i.NO,"取消"],suncom.Handler.create(this,this.$onRetryConfirmed)])}};n.prototype.$onRetryConfirmed=function(e){if(e===i.YES){this.facade.sendNotification(D.ASSET_SAFETY_LOADER_RETRY)}else{this.facade.sendNotification(suncore.NotifyKey.SHUTDOWN)}this.$isRetryPrompting=false};n.MAX_LOAD_COUNT=5;return n}(suncore.BaseService);o.ResourceService=h;var p=function(a){__extends(e,a);function e(e,t,o){if(t===void 0){t=null}if(o===void 0){o=null}var n=[];for(var r=3;r<arguments.length;r++){n[r-3]=arguments[r]}var i=a.call(this,suncore.MsgQModEnum.MMI)||this;i.$options=[];i.$currentRetries=0;i.$retryHandler=null;i.$retryTimerId=0;i.$prompting=false;if((e&u.CONFIRM)===u.CONFIRM){i.$method=u.CONFIRM}else if((e&u.TERMINATE)===u.TERMINATE){i.$method=u.TERMINATE}else{i.$method=u.AUTO}var s=e&=15;if(e===suncore.ModuleEnum.CUSTOM||e===suncore.ModuleEnum.TIMELINE){i.$mod=e}else{i.$mod=suncore.ModuleEnum.SYSTEM}i.$prompt=o;i.$options=n;i.$confirmHandler=t;return i}e.prototype.run=function(e,t,o){if(o===void 0){o=2}if(this.$method===u.AUTO||this.$currentRetries<o){if(this.$retryTimerId===0){this.$retryHandler=t;this.$retryTimerId=suncore.System.addTimer(suncore.ModuleEnum.SYSTEM,e,this.$onRetryTimer,this)}else{suncom.Logger.warn(suncom.DebugMode.ANY,"己忽略的重试请求 method:"+suncom.Common.getMethodName(t.method,t.caller)+", caller:"+suncom.Common.getQualifiedClassName(t.caller))}}else{if(this.$prompting===false){this.$prompting=true;if(this.$method===u.TERMINATE){var n=suncom.Handler.create(this,this.$onConfirmReplied,[i.NO]);suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_0,n)}else{var r=suncom.Handler.create(this,this.$onConfirmReplied);this.facade.sendNotification(D.RETRY_CONFIRM,[this.$mod,this.$prompt,this.$options,r])}}else{suncom.Logger.warn(suncom.DebugMode.ANY,"己忽略的重试的询问请求 prompt:"+this.$prompt)}}};e.prototype.$onConfirmReplied=function(e){if(this.$prompting===true){this.$prompting=false;if(this.$confirmHandler!==null){this.$confirmHandler.runWith(e)}}};e.prototype.$onRetryTimer=function(){this.$retryTimerId=0;this.$currentRetries++;this.$retryHandler.run()};e.prototype.cancel=function(){this.$prompting=false;this.$retryTimerId=suncore.System.removeTimer(this.$retryTimerId)};e.prototype.reset=function(){this.$currentRetries=0};Object.defineProperty(e.prototype,"currentRetries",{get:function(){return this.$currentRetries},enumerable:true,configurable:true});return e}(puremvc.Notifier);o.Retryer=p;var m=function(n){__extends(e,n);function e(e,t){var o=n.call(this,e,t)||this;o.facade.registerObserver(D.ENTER_SCENE,o.$onEnterScene,o,true,suncom.EventPriorityEnum.EGL);return o}e.prototype.$onEnterScene=function(){};return e}(n);o.SceneIniClass=m;var $=function(t){__extends(e,t);function e(){var e=t.call(this)||this;e.$ready=true;e.$sceneName=0;e.$scene2d=null;e.$scene3d=null;e.$data=null;e.facade.registerObserver(D.ENTER_SCENE,e.$onEnterScene,e,false,suncom.EventPriorityEnum.OSL);return e}e.prototype.$enterScene=function(e,t){var o=k.getConfigByName(e);suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_LAZY,suncom.Handler.create(this,this.$beforeLoadScene,[o,t]));suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_LAZY,suncom.Handler.create(this,this.$loadScene,[o]))};e.prototype.$beforeLoadScene=function(e,t){this.$data=t;this.$sceneName=e.name;this.facade.sendNotification(D.BEFORE_LOAD_SCENE);e.iniCls&&suncore.System.addTask(suncore.ModuleEnum.SYSTEM,0,new e.iniCls(e,t))};e.prototype.$loadScene=function(e){this.facade.sendNotification(suncore.NotifyKey.START_TIMELINE,[suncore.ModuleEnum.CUSTOM,true]);e.scene3d=e.scene3d||null;this.facade.sendNotification(D.LOAD_SCENE,e)};e.prototype.$onEnterScene=function(e,t){this.$ready=true;this.$scene2d=e||null;this.$scene3d=t||null;this.facade.sendNotification(suncore.NotifyKey.START_TIMELINE,[suncore.ModuleEnum.CUSTOM,false])};e.prototype.$exitScene=function(){this.facade.sendNotification(D.EXIT_SCENE,this.$sceneName);this.facade.sendNotification(suncore.NotifyKey.PAUSE_TIMELINE,[suncore.ModuleEnum.CUSTOM,true]);var e=k.getConfigByName(this.$sceneName);suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_LAZY,suncom.Handler.create(this,this.$onLeaveScene,[e]))};e.prototype.$onLeaveScene=function(e){e.uniCls&&suncore.System.addTask(suncore.ModuleEnum.SYSTEM,0,new e.uniCls(e,this.$data));this.facade.sendNotification(D.LEAVE_SCENE);this.facade.sendNotification(D.UNLOAD_SCENE,[this.$scene2d,this.$scene3d]);e.scene2d!==null&&I.clearResByUrl(e.scene2d);suncore.System.addTask(suncore.ModuleEnum.SYSTEM,0,new suncore.SimpleTask(suncom.Handler.create(this,this.$onExitScene)))};e.prototype.$onExitScene=function(){this.$sceneName=0};e.prototype.enterScene=function(e,t){if(this.$ready===false){return false}this.$ready=false;this.$sceneName!=0&&this.$exitScene();this.$enterScene(e,t);U.addHistory(e,t);return true};e.prototype.exitScene=function(){if(this.$ready===false){return}this.$ready=false;this.$sceneName!=0&&this.$exitScene();U.removeHistory(this.$sceneName);var e=U.getLastestSceneInfo();e!==null&&this.$enterScene(e.name,e.data)};e.prototype.replaceScene=function(e,t){var o=U.getLastestSceneInfo();if(this.enterScene(e,t)===true){o!==null&&U.removeHistory(o.name)}};e.prototype.deleteHistories=function(e){U.deleteHistories(e)};Object.defineProperty(e.prototype,"scene2d",{get:function(){return this.$scene2d},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"scene3d",{get:function(){return this.$scene3d},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"sceneName",{get:function(){return this.$ready===false?0:this.$sceneName},enumerable:true,configurable:true});return e}(puremvc.Notifier);o.SceneLayer=$;var y=function(n){__extends(e,n);function e(e,t){var o=n.call(this,e,t)||this;o.facade.registerObserver(D.LEAVE_SCENE,o.$onLeaveScene,o,true,suncom.EventPriorityEnum.EGL);return o}e.prototype.$onLeaveScene=function(){};return e}(n);o.SceneUniClass=y;var E=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e,t,o){if(w.viewLayer.getInfoByView(e)!==null){suncom.Logger.error(suncom.DebugMode.ANY,e+"["+e.name+"] is already popup.");return}if(o.mod===void 0){o.mod=suncore.ModuleEnum.CUSTOM}if(o.ease===void 0){o.ease=Laya.Ease.backOut}if(o.flags===void 0){o.flags=l.NONE}if(o.keepNode===void 0){o.keepNode=false}var n=o.args;var r=o.level||e.zOrder||c.POPUP;var i=o.keepNode;delete o.args;delete o.level;delete o.keepNode;this.$makeProps(o);if(o.trans===true&&(o.flags&l.TRANSPARENT)===l.NONE){suncom.Logger.warn(suncom.DebugMode.ANY,"ViewFacade：props的trans属性己弃用，请使用flags代替！！！");o.flags|=l.TRANSPARENT}var s=w.viewLayer.createMask(e,o);s.name="Mask$"+e.name;s.zOrder=e.zOrder=r;var a={view:e,mask:s,props:o,closed:false,keepNode:i,displayed:false,duration:t,cancelAllowed:false};w.viewLayer.addToStack(a);w.viewLayer.addChild(s);w.viewLayer.addChild(e);suncom.Test.expect(e["pivot"]).anything();e["pivot"](e.width*.5,e.height*.5);w.viewLayer.onViewCreate(e,n);if((o.flags&l.TRANSPARENT)===l.NONE){if(o.flags&l.SYNC_FADE_TIME){S.get(s,a.props.mod).from({alpha:0},t)}else{S.get(s,a.props.mod).from({alpha:0},t>200?200:t)}}this.$applyShowProps(e,o,t);var u=suncom.Handler.create(this,this.$onPopupFinish,[e]);suncore.System.addTrigger(a.props.mod,t,u)};t.prototype.$onPopupFinish=function(e){var t=w.viewLayer.getInfoByView(e);if(t!==null&&t.closed===false){t.displayed=true;w.viewLayer.onViewOpen(e)}};return t}(e);o.ShowPopupCommand=E;var v=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.$doLoad=function(){this.$loadAssets([this.$url,suncom.Common.replacePathExtension(this.$url,"png")])};t.prototype.$onAssetsLoaded=function(e){if(e===true){var t=w.cacheMap[this.$url]||null;if(t===null){t=w.cacheMap[this.$url]=new Laya.Templet;t.on(Laya.Event.COMPLETE,this,this.$onTempletCreated);t.loadAni(this.$url)}else if(t.isParserComplete===false){t.on(Laya.Event.COMPLETE,this,this.$onTempletCreated)}else{var o=suncom.Handler.create(this,this.$onTempletCreated);suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_0,o)}I.lock(this.$url)}else{this.$onComplete(false)}};t.prototype.$onTempletCreated=function(){if(this.destroyed===false){var e=w.cacheMap[this.$url];this.$onComplete(true)}I.unlock(this.$url)};return t}(r);o.SkeletonLoader=v;var g=function(a){__extends(e,a);function e(e,t,o){var n=a.call(this)||this;n.$id=0;n.$handler=null;n.$doneList=[];n.$loaders=[];n.$id=e;n.$handler=o;t=I.checkLoadList(t);suncom.Test.expect(t.length).toBeGreaterThan(0);while(t.length>0){var r=t.shift();var i=suncom.Handler.create(n,n.$onResourceCreated);var s=new d(r,i);n.$loaders.push(s)}return n}e.prototype.destroy=function(){if(this.$destroyed===true){return}a.prototype.destroy.call(this);var e=suncom.Handler.create(this,this.$releaseAllResources);suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_0,e)};e.prototype.$onResourceCreated=function(e){this.$doneList.push(e);if(this.$doneList.length<this.$loaders.length){return}if(this.$destroyed===true){return}this.$handler.runWith([this.$id])};e.prototype.$releaseAllResources=function(){for(var e=0;e<this.$loaders.length;e++){this.$loaders[e].destroy()}};return e}(puremvc.Notifier);o.Templet=g;var S=function(n){__extends(o,n);function o(e,t){var o=n.call(this)||this;o.$infos=[];o.$props=null;o.$mod=t;o.$item=e;if(suncore.System.isModuleStopped(t)===false){o.facade.sendNotification(D.REGISTER_TWEEN_OBJECT,o)}else{suncom.Logger.error(suncom.DebugMode.ANY,"尝试添加缓动，但时间轴己停止，mod:"+suncore.ModuleEnum[t])}return o}o.prototype.cancel=function(){this.$props=null;this.$infos.length=0;return this};o.prototype.to=function(e,t,o,n){if(o===void 0){o=null}if(n===void 0){n=null}var r=Object.keys(e);var i=this.$props===null?this.$item:this.$props;this.$createTweenInfo(r,i,e,t,o,e.update||null,n);return this};o.prototype.from=function(e,t,o,n){if(o===void 0){o=null}if(n===void 0){n=null}var r=Object.keys(e);var i=this.$props===null?this.$item:this.$props;this.$createTweenInfo(r,e,i,t,o,e.update||null,n);return this};o.prototype.by=function(e,t,o,n){if(o===void 0){o=null}if(n===void 0){n=null}var r=Object.keys(e);var i=this.$props===null?this.$item:this.$props;for(var s=0;s<r.length;s++){var a=r[s];if(this.$props===null||this.$props[a]===void 0){e[a]+=this.$item[a]}else{e[a]+=i[a]}}this.to(e,t,o,n);return this};o.prototype.$createTweenInfo=function(e,t,o,n,r,i,s){this.$props=this.$props||{};var a=[];for(var u=0;u<e.length;u++){var l=e[u];if(l==="update"){continue}var c={prop:l,from:t[l],to:o[l]};if(c.from===void 0){c.from=this.$item[l]}a.push(c);this.$props[l]=o[l];if(this.$infos.length===0){this.$item[c.prop]=c.from}}var d={ease:r,actions:a,update:i,handler:s,time:suncore.System.getModuleTimestamp(this.$mod),duration:n};this.$infos.push(d)};o.prototype.wait=function(e,t){if(t===void 0){t=null}var o={ease:null,actions:[],update:null,handler:t,time:suncore.System.getModuleTimestamp(this.$mod),duration:e};this.$infos.push(o);return this};o.prototype.doAction=function(){var e=suncore.System.getModuleTimestamp(this.$mod);var t=this.$infos[0];if(this.$item.destroyed===true){this.cancel();return 0}var o=false;var n=0;var r=e-t.time;if(r>t.duration){o=true;n=r-t.duration;r=t.duration}var i=t.ease||this.$easeNone;for(var s=0;s<t.actions.length;s++){var a=t.actions[s];if(o===true){this.$item[a.prop]=a.to}else{this.$item[a.prop]=i(r,a.from,a.to-a.from,t.duration)}}if(t.update!==null){t.update.run()}if(o===false){return 0}this.$infos.shift();if(this.$infos.length>0){this.$infos[0].time=suncore.System.getModuleTimestamp(this.$mod)}t.handler!==null&&t.handler.run();return n};o.prototype.$easeNone=function(e,t,o,n){var r=e/n;if(r>1){r=1}return r*o+t};Object.defineProperty(o.prototype,"mod",{get:function(){return this.$mod},enumerable:true,configurable:true});Object.defineProperty(o.prototype,"canceled",{get:function(){return this.$infos.length===0},enumerable:true,configurable:true});o.get=function(e,t){if(t===void 0){t=suncore.ModuleEnum.CUSTOM}return new o(e,t)};return o}(puremvc.Notifier);o.Tween=S;var L=function(t){__extends(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.$tweens=[false];return e}e.prototype.$onRun=function(){this.facade.registerObserver(D.REGISTER_TWEEN_OBJECT,this.$onAddTweenObject,this);this.facade.registerObserver(suncore.NotifyKey.PAUSE_TIMELINE,this.$onTimelinePause,this,false,suncom.EventPriorityEnum.EGL)};e.prototype.$onStop=function(){this.facade.removeObserver(D.REGISTER_TWEEN_OBJECT,this.$onAddTweenObject,this);this.facade.removeObserver(suncore.NotifyKey.PAUSE_TIMELINE,this.$onTimelinePause,this)};e.prototype.$frameLoop=function(){this.$tweens[0]=true;var e=this.$tweens;for(var t=suncore.ModuleEnum.MIN;t<suncore.ModuleEnum.MAX;t++){if(suncore.System.isModulePaused(t)===false){var o=e.length;for(var n=0;n<o;n++){var r=e[n];if(r.mod===t){var i=1;while(i>0&&r.canceled===false){i=r.doAction()}}}}}for(var n=this.$tweens.length-1;n>0;n--){var r=this.$tweens[n];if(r.canceled===true){e.splice(n,1)}}this.$tweens[0]=false};e.prototype.$onTimelinePause=function(e,t){if(t===true){for(var o=1;o<this.$tweens.length;o++){var n=this.$tweens[o];if(n.mod===e){n.cancel()}}}};e.prototype.$onAddTweenObject=function(e){if(this.$tweens[0]===true){this.$tweens=this.$tweens.slice(0);this.$tweens[0]=false}this.$tweens.push(e)};return e}(suncore.BaseService);o.TweenService=L;var N=function(t){__extends(e,t);function e(){var e=t.call(this)||this;w.sceneLayer=new $;if(Laya.Scene3D===void 0){w.viewLayer=new P}else{w.viewLayer=new b}suncom.DBService.put(-1,new L).run();suncom.DBService.put(-1,new h).run();e.facade.registerCommand(D.SHOW_POPUP,E,suncom.EventPriorityEnum.OSL);e.facade.registerCommand(D.CLOSE_POPUP,s,suncom.EventPriorityEnum.OSL);return e}e.getInstance=function(){if(e.$inst===null){e.$inst=new e}return e.$inst};e.prototype.enterScene=function(e,t){puremvc.MutexLocker.backup(this);w.sceneLayer.enterScene(e,t);puremvc.MutexLocker.restore()};e.prototype.exitScene=function(){puremvc.MutexLocker.backup(this);w.sceneLayer.exitScene();puremvc.MutexLocker.restore()};e.prototype.replaceScene=function(e,t){puremvc.MutexLocker.backup(this);w.sceneLayer.replaceScene(e,t);puremvc.MutexLocker.restore()};e.prototype.deleteHistories=function(e){w.sceneLayer.deleteHistories(e)};e.prototype.removeView=function(e){w.viewLayer.removeStackInfoByView(e)};Object.defineProperty(e.prototype,"scene2d",{get:function(){return w.sceneLayer.scene2d},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"scene3d",{get:function(){return w.sceneLayer.scene3d},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"sceneName",{get:function(){return w.sceneLayer.sceneName},enumerable:true,configurable:true});e.$inst=null;return e}(puremvc.Notifier);o.UIManager=N;var O=function(n){__extends(e,n);function e(e,t){var o=n.call(this)||this;o.$url=null;o.$data=null;o.$handler=null;o.$totalSize=0;o.$currentSize=0;o.$priority=0;o.$url=e;o.$handler=t;o.$priority=suncom.Mathf.random(0,6);if(Laya.loader.getRes(e)!==void 0){o.$totalSize=-1}w.downloadLimiters.push(o);return o}e.prototype.destroy=function(){if(this.$destroyed===true){return}n.prototype.destroy.call(this);var e=w.downloadLimiters.indexOf(this);if(e<0){throw Error("加载限制器不存在：index:"+e)}w.downloadLimiters.splice(e,1);this.facade.removeObserver(suncore.NotifyKey.ENTER_FRAME,this.$onEnterFrame,this)};e.prototype.updateDownloadSize=function(e){if(e===null||this.$totalSize===-1){this.$totalSize=1}else if(suncom.Common.getFileExtension(this.$url)==="atlas"){var t=Laya.loader.getRes(suncom.Common.replacePathExtension(this.$url,"png"))||null;var o=(t===null?0:t["gpuMemory"])||1;this.$totalSize=o+this.$getStringSize(Laya.loader.getRes(this.$url)||null)}else if(suncom.Common.getFileExtension(this.$url)==="png"||suncom.Common.getFileExtension(this.$url)==="jpg"){var t=Laya.loader.getRes(suncom.Common.replacePathExtension(this.$url,"png"))||null;this.$totalSize=(t===null?0:t.bitmap["gpuMemory"])||1}else if(suncom.Common.getFileExtension(this.$url)==="json"){this.$totalSize=this.$getStringSize(Laya.loader.getRes(this.$url)||null)}else if(suncom.Common.getFileExtension(this.$url)==="sk"){var n=e;this.$totalSize=n.byteLength}else if(suncom.Common.getFileExtension(this.$url)==="lh"){var r=Laya.loader.getRes(suncom.Common.replacePathExtension(this.$url,"json"));var i=I.getAssetUrlsByRes3dJson(r);for(var s=0;s<i.length;s++){var a=i[s];var u=Laya.loader.getRes(a)||null;if(u["gpuMemory"]>0){this.$totalSize+=u["gpuMemory"]}else{try{this.$totalSize+=this.$getStringSize(u)}catch(e){this.$totalSize+=1}}}}else{this.$totalSize=1}this.$data=e;this.facade.registerObserver(suncore.NotifyKey.ENTER_FRAME,this.$onEnterFrame,this)};e.prototype.$onEnterFrame=function(){this.$currentSize+=this.$getDowloadSpeed()*(10-this.$priority)/10;if(this.$totalSize>0&&this.$currentSize>this.$totalSize){suncom.Logger.log(suncom.DebugMode.DEBUG,"[100%] "+this.$url+":{"+this.$currentSize+":"+this.$totalSize+"}");this.$handler.runWith(this.$data);this.destroy()}else{if(this.$totalSize>0){suncom.Logger.log(suncom.DebugMode.DEBUG,"["+Math.floor(this.$currentSize/this.$totalSize*100)+"%] "+this.$url+":{"+this.$currentSize+":"+this.$totalSize+"}")}else{suncom.Logger.log(suncom.DebugMode.DEBUG,"[0%] "+this.$url+":{"+this.$currentSize+":"+this.$totalSize+"}")}}};e.prototype.$getDowloadSpeed=function(){if(w.downloadLimiters.length<=1){return w.downloadSpeed}else{return w.downloadSpeed/w.downloadLimiters.length}};e.prototype.$getStringSize=function(e){var t=null;var o=0;if(e===null){return 1}if(typeof e==="number"||typeof e==="string"){t=e.toString()}else{t=JSON.stringify(e)}for(var n=0;n<t.length;n++){if(t.charCodeAt(n)<=255){o++}else{o+=2}}return o};return e}(puremvc.Notifier);o.UrlDownloadLimiter=O;var _=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.$doLoad=function(){this.$loadAssets([this.$url])};t.prototype.$onAssetsLoaded=function(e){this.$onComplete(e)};return t}(r);o.UrlLoader=_;var R=function(n){__extends(e,n);function e(e,t){var o=n.call(this)||this;o.$url=null;o.$limiter=null;o.$complete=null;o.$loading=false;o.$url=e;o.$complete=t;o.facade.sendNotification(D.ON_URL_SAFETY_LOADER_CREATED,o);return o}e.prototype.load=function(){if(this.$loading===false&&this.$destroyed===false){this.$loading=true;Y.lock(this.$url);if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.trace(suncom.DebugMode.ANY,"load "+this.$url)}if(I.isRes3dUrl(this.$url)===false||I.getRes3dJsonUrl(this.$url)===this.$url){Laya.loader.load(this.$url,Laya.Handler.create(this,this.$onComplete))}else{Laya.loader.create(this.$url,Laya.Handler.create(this,this.$onComplete))}if(w.downloadSpeed!==t.NONE){this.$limiter=new O(this.$url,suncom.Handler.create(this,this.$onDownloaded))}}};e.prototype.$onComplete=function(e){if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.trace(suncom.DebugMode.ANY,"load "+this.$url+" complete")}if(this.$limiter===null){if(this.$destroyed===false){this.$destroyed=true;this.$complete.runWith([e===null?false:true,this.$url])}this.facade.sendNotification(D.ON_URL_SAFETY_LOADER_COMPLETE,this);Y.unlock(this.$url);this.$loading=false}else{this.$limiter.updateDownloadSize(e)}};e.prototype.$onDownloaded=function(e){this.$limiter=null;this.$onComplete(e)};Object.defineProperty(e.prototype,"url",{get:function(){return this.$url},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"destroyed",{get:function(){return this.$destroyed},enumerable:true,configurable:true});return e}(puremvc.Notifier);o.UrlSafetyLoader=R;var C=function(n){__extends(e,n);function e(e,t){var o=n.call(this)||this;o.$closedHandler=null;o.$removedHandler=null;o.$popup=e||null;o.$caller=t||null;if(w.viewLayer.getInfoByView(e)===null){throw Error("找不到"+e.name+"的弹出信息，请确认其为弹出对象")}o.facade.registerObserver(D.ON_POPUP_CLOSED,o.$onPopupClosed,o,false,suncom.EventPriorityEnum.FWL);o.facade.registerObserver(D.ON_POPUP_REMOVED,o.$onPopupRemoved,o,false,suncom.EventPriorityEnum.FWL);if(w.viewLayer.getInfoByView(t)!==null){o.facade.registerObserver(D.ON_POPUP_REMOVED,o.$onCallerDestroy,o,false,suncom.EventPriorityEnum.FWL)}else{o.facade.registerObserver(D.ON_CALLER_DESTROYED,o.$onCallerDestroy,o,false,suncom.EventPriorityEnum.FWL)}o.facade.registerObserver(D.LEAVE_SCENE,o.$onLeaveScene,o,false,suncom.EventPriorityEnum.OSL);return o}e.prototype.$onLeaveScene=function(){this.facade.removeObserver(D.ON_POPUP_CLOSED,this.$onPopupClosed,this);this.facade.removeObserver(D.ON_POPUP_REMOVED,this.$onPopupRemoved,this);this.facade.removeObserver(D.LEAVE_SCENE,this.$onCallerDestroy,this);this.facade.removeObserver(D.ON_POPUP_REMOVED,this.$onCallerDestroy,this);this.facade.removeObserver(D.ON_CALLER_DESTROYED,this.$onCallerDestroy,this)};e.prototype.$onCallerDestroy=function(e){if(e===this.$caller){this.$onLeaveScene()}};e.prototype.$onPopupClosed=function(e){if(e===this.$popup){if(this.$closedHandler!==null){this.$closedHandler.run();this.$closedHandler=null}}};e.prototype.$onPopupRemoved=function(e){if(e===this.$popup){if(this.$removedHandler!==null){this.$removedHandler.run();this.$removedHandler=null}this.$onCallerDestroy(this.$caller)}};e.prototype.onPopupClosed=function(e,t,o){if(this.$caller!==t){throw Error("caller与执行者不一致")}if(this.$closedHandler===null){this.$closedHandler=suncom.Handler.create(t,e,o)}else{throw Error("重复注册弹框关闭事件")}return this};e.prototype.onPopupRemoved=function(e,t,o){if(this.$caller!==t){throw Error("caller与执行者不一致")}if(this.$removedHandler===null){this.$removedHandler=suncom.Handler.create(t,e,o)}else{throw Error("重复注册弹框移除事件")}return this};return e}(puremvc.Notifier);o.ViewContact=C;var T=function(n){__extends(e,n);function e(e,t){var o=n.call(this)||this;o.$info=null;o.$view=e;if(o.info!==null){o.$duration=o.info.duration}else if(t===void 0){o.$duration=200}else{o.$duration=t}return o}e.prototype.popup=function(e){if(e===void 0){e={}}this.facade.sendNotification(D.SHOW_POPUP,[this.$view,this.$duration,e]);return this};e.prototype.close=function(e){this.facade.sendNotification(D.CLOSE_POPUP,[this.$view,this.$duration,e])};Object.defineProperty(e.prototype,"cancelAllowed",{get:function(){return this.info.cancelAllowed},set:function(e){this.info.cancelAllowed=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"info",{get:function(){if(this.$info===null){this.$info=w.viewLayer.getInfoByView(this.$view)}return this.$info},enumerable:true,configurable:true});return e}(puremvc.Notifier);o.ViewFacade=T;var M=function(t){__extends(e,t);function e(){var e=t.call(this)||this;e.$stack=[];e.facade.registerObserver(D.UNLOAD_SCENE,e.$onUnloadScene,e,false,suncom.EventPriorityEnum.EGL);return e}e.prototype.$onUnloadScene=function(){var e=this.$stack.concat();for(var t=e.length-1;t>-1;t--){var o=e[t];if(o.props.mod!==suncore.ModuleEnum.SYSTEM){this.removeStackInfo(o)}}};e.prototype.getInfoByView=function(e){for(var t=0;t<this.$stack.length;t++){var o=this.$stack[t];if(o.view===e){return o}}return null};e.prototype.addToStack=function(e){this.$stack.push(e)};e.prototype.removeStackInfo=function(e){var t=this.$stack.indexOf(e);if(t<0){return}this.$stack.splice(t,1);this.onViewRemove(e.view);this.removeChild(e.view);this.removeChild(e.mask);if(e.keepNode===false){this.destroyView(e.view);this.destroyMask(e.mask)}this.facade.sendNotification(D.ON_POPUP_REMOVED,e.view)};e.prototype.removeStackInfoByView=function(e){for(var t=0;t<this.$stack.length;t++){var o=this.$stack[t];if(o.view===e){this.removeStackInfo(o);break}}};return e}(puremvc.Notifier);o.ViewLayer=M;var A=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.addChild=function(e){var t=e;if(w.sceneLayer.scene2d===null||e.zOrder>=o.UILevel.LOADING){Laya.stage.addChild(t)}else{w.sceneLayer.scene2d.addChild(t)}};t.prototype.removeChild=function(e){var t=e;var o=t.parent||null;if(o===null){throw Error("无法移除显示对象，因为父节点不存在 "+t.name)}o.removeChild(t)};t.prototype.createMask=function(e,t){var o=new Laya.Image("common/mask_b.png");o.left=o.right=o.top=o.bottom=0;o.sizeGrid="1,1,1,1";if(t.flags&l.TRANSPARENT){o.alpha=0}else{o.alpha=1}if((t.flags&l.MOUSE_THROUGH)===l.NONE){o.mouseThrough=false;o.on(Laya.Event.CLICK,this,this.$onMaskClick,[e])}return o};t.prototype.$onMaskClick=function(e){var t=w.viewLayer.getInfoByView(e);if(t!==null&&t.closed===false&&t.cancelAllowed===true){new T(e).close()}};t.prototype.destroyMask=function(e){e.off(Laya.Event.CLICK,this,this.$onMaskClick);e.destroy()};t.prototype.destroyView=function(e){var t=e;t.destroy()};return t}(M);o.ViewLayerLaya=A;var P=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.onViewCreate=function(e,t){var o=e;if(o.$onCreate){if(t instanceof Array===false){o.$onCreate.call(o,t)}else{o.$onCreate.apply(o,t)}}};t.prototype.onViewOpen=function(e){var t=e;if(t.$onOpen){t.$onOpen.call(t)}};t.prototype.onViewClose=function(e){var t=e;if(t.$onClose){t.$onClose.call(t)}};t.prototype.onViewRemove=function(e){var t=e;if(t.$onRemove){t.$onRemove.call(t)}};return t}(A);o.ViewLayerLaya2D=P;var b=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.onViewCreate=function(e,t){var o=e.getComponents(Laya.Component)||[];for(var n=0;n<o.length;n++){var r=o[n];if(r.$onCreate){if(t instanceof Array===false){r.$onCreate.call(r,t)}else{r.$onCreate.apply(r,t)}}}};t.prototype.onViewOpen=function(e){var t=e.getComponents(Laya.Component)||[];for(var o=0;o<t.length;o++){var n=t[o];if(n.$onOpen){n.$onOpen.call(n)}}};t.prototype.onViewClose=function(e){var t=e.getComponents(Laya.Component)||[];for(var o=0;o<t.length;o++){var n=t[o];if(n.$onClose){n.$onClose.call(n)}}};t.prototype.onViewRemove=function(e){var t=e.getComponents(Laya.Component)||[];for(var o=0;o<t.length;o++){var n=t[o];if(n.$onRemove){n.$onRemove.call(n)}}};return t}(A);o.ViewLayerLaya3D=b;var w;(function(e){e.downloadSpeed=t.NONE;e.cacheMap={};e.templets={};e.references={};e.downloadLimiters=[]})(w=o.M||(o.M={}));var D;(function(e){e.RETRY_CONFIRM="sunui.NotifyKey.RETRY_CONFIRM";e.REGISTER_SCENES="sunui.NotifyKey.REGISTER_SCENES";e.BEFORE_LOAD_SCENE="sunui.NotifyKey.BEFORE_LOAD_SCENE";e.LOAD_SCENE="sunui.NotifyKey.LOAD_SCENE";e.UNLOAD_SCENE="sunui.NotifyKey.UNLOAD_SCENE";e.ENTER_SCENE="sunui.NotifyKey.ENTER_SCENE";e.EXIT_SCENE="sunui.NotifyKey.EXIT_SCENE";e.LEAVE_SCENE="sunui.NotifyKey.LEAVE_SCENE";e.SHOW_POPUP="sunui.NotifyKey.SHOW_POPUP";e.CLOSE_POPUP="sunui.NotifyKey.CLOSE_POPUP";e.ON_POPUP_CLOSED="sunui.NotifyKey.ON_POPUP_CLOSED";e.ON_POPUP_REMOVED="sunui.NotifyKey.ON_POPUP_REMOVED";e.ON_CALLER_DESTROYED="sunui.NotifyKey.ON_CALLER_DESTROYED";e.ON_ASSET_SAFETY_LOADER_FAILED="sunui.NotifyKey.ON_ASSET_SAFETY_LOADER_FAILED";e.ON_URL_SAFETY_LOADER_CREATED="sunui.NotifyKey.ON_URL_SAFETY_LOADER_CREATED";e.ON_URL_SAFETY_LOADER_COMPLETE="sunui.NotifyKey.ON_URL_SAFETY_LOADER_COMPLETE";e.ASSET_SAFETY_LOADER_RETRY="sunui.NotifyKey.ASSET_SAFETY_LOADER_RETRY";e.REGISTER_TWEEN_OBJECT="sunui.NotifyKey.REGISTER_TWEEN_OBJECT"})(D=o.NotifyKey||(o.NotifyKey={}));var I;(function(i){i.res3dRoot=null;function e(e){w.downloadSpeed=e}i.setDownloadSpeed=e;function t(e){if(suncom.Global.debugMode&suncom.DebugMode.ENGINE){if(i.isRes3dUrl(e)===true&&i.getRes3dJsonUrl(e)===e){return}}var t=suncom.Common.getFileExtension(e);var o=e.substr(0,e.length-t.length);var n=[e];if(t==="sk"||t==="atlas"){n.push(o+"png")}else if(i.isRes3dUrl(e)===true){n.push(o+"json")}for(var r=0;r<n.length;r++){Y.lock(n[r])}}i.lock=t;function o(e){if(suncom.Global.debugMode&suncom.DebugMode.ENGINE){if(i.isRes3dUrl(e)===true&&i.getRes3dJsonUrl(e)===e){return}}var t=suncom.Common.getFileExtension(e);var o=e.substr(0,e.length-t.length);var n=[e];if(t==="sk"||t==="atlas"){n.push(o+"png")}else if(i.isRes3dUrl(e)===true){n.push(o+"json")}for(var r=0;r<n.length;r++){Y.unlock(n[r])}}i.unlock=o;function n(e,t,o){var n=null;if(t===null){n=suncom.Handler.create(null,function(e){})}else{n=suncom.Handler.create(o,t)}var r=suncom.Common.createHashId();w.templets[r]=new g(r,e,n);return r}i.prepare=n;function r(e){var t=w.templets[e]||null;if(t!==null){delete w.templets[e];t.destroy()}return 0}i.release=r;function s(e,t){var o=w.cacheMap[e]||null;if(suncom.Common.getFileExtension(e)==="sk"){return o.buildArmature(t)}else if(i.isRes3dUrl(e)===true){if(o===null){o=w.cacheMap[e]=Laya.loader.getRes(e)}return Laya.Sprite3D.instantiate(o)}else{return Laya.loader.getRes(e)}}i.createSync=s;function a(e){return i.createSync(i.getRes3dUrlByName(e))}i.createRes3dSync=a;function u(e){Y.clearResByUrl(e)}i.clearResByUrl=u;function l(e){if(i.res3dRoot===null){throw Error("请先指定3D资源目录：sunui.Resource.res3dRoot=")}return i.res3dRoot+"/LayaScene_"+e+"/Conventional/"}i.getRes3dPackRoot=l;function c(e){return e.indexOf(i.res3dRoot)===0}i.isRes3dUrl=c;function d(e){return suncom.Common.replacePathExtension(e,"json")}i.getRes3dJsonUrl=d;function f(e){if(suncom.Common.getFileExtension(e)===null){e+=".lh"}return i.getRes3dPackRoot(suncom.Common.getFileName(e))+e}i.getRes3dUrlByName=f;function h(e){var t=[];var o=i.getRes3dPackRoot(e.pack);for(var n=0;n<e.files.length;n++){t.push(o+e.files[n])}for(var n=0;n<e.resources.length;n++){t.push(o+e.resources[n])}return t}i.getAssetUrlsByRes3dJson=h;function p(e){i.removeUnnecessaryResources(e,"sk","png","龙骨预加载无需指定PNG资源");i.removeUnnecessaryResources(e,"atlas","png","图集预加载无需指定PNG资源");return i.removeDuplicateResources(e)}i.checkLoadList=p;function m(e){if(suncom.Global.debugMode&suncom.DebugMode.ENGINE){var t=[];for(var o=0;o<e.length;o++){var n=e[o];if(t.indexOf(n)===-1){t.push(n)}else{suncom.Logger.error(suncom.DebugMode.ANY,"重复的预加载资源文件 "+n)}}return t}return e}i.removeDuplicateResources=m;function $(e,t,o,n){if(suncom.Global.debugMode&suncom.DebugMode.ENGINE){var r=[];for(var i=0;i<e.length;i++){var s=e[i];if(suncom.Common.getFileExtension(s)===t){r.push(s)}}for(var i=0;i<r.length;i++){var s=r[i];var a=s.substring(0,s.length-t.length)+o;do{var u=e.indexOf(a);if(u===-1){break}e.splice(u,1);suncom.Logger.error(suncom.DebugMode.ANY,n+" "+s)}while(true)}}}i.removeUnnecessaryResources=$})(I=o.Resource||(o.Resource={}));var U;(function(e){var n=[];function o(e){for(var t=n.length-1;t>-1;t--){if(n[t].name===e){return t}}return-1}function t(e,t){var o={name:e,data:t};n.push(o)}e.addHistory=t;function r(e){var t=o(e);if(t>-1){n.splice(t,1)}return t>-1}e.removeHistory=r;function i(e){return o(e)>-1}e.hasHistory=i;function s(){if(n.length>0){return n[n.length-1]}return null}e.getLastestSceneInfo=s;function a(e){var t=o(e);if(t>-1){return n[t]}return null}e.getLastestSceneInfoByName=a;function u(e){while(n.length>1&&e>0){n.pop();e--}}e.deleteHistories=u})(U=o.SceneHeap||(o.SceneHeap={}));var k;(function(e){var n=[];function t(e){for(var t=0;t<n.length;t++){if(n[t].name===e.name){throw Error("重复注册场景")}}n.push(e)}e.regScene=t;function o(e){for(var t=0;t<n.length;t++){var o=n[t];if(o.name===e){return o}}throw Error("场景配置不存在")}e.getConfigByName=o})(k=o.SceneManager||(o.SceneManager={}));var Y;(function(n){function e(e){var t=w.references[e]||0;if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.trace(suncom.DebugMode.ANY,"reference:"+t+", lock:"+e)}w.references[e]=t+1}n.lock=e;function t(e){var t=w.references[e]||0;if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.trace(suncom.DebugMode.ANY,"reference:"+t+", unlock:"+e)}suncom.Test.expect(t).interpret("尝试解锁不存在的资源 url："+e).toBeGreaterThan(0);if(t>1){w.references[e]=t-1}else{delete w.references[e];r(e)}}n.unlock=t;function o(e){if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.trace(suncom.DebugMode.ANY,"clearResUrl:"+e)}var t=w.cacheMap[e]||null;if(t!==null){t.dispose&&t.dispose();t.destroy&&t.destroy();delete w.cacheMap[e]}var o=Laya.loader.getRes(e)||null;if(o===null){Laya.loader.cancelLoadByUrl(e)}else{o.dispose&&o.dispose();o.destroy&&o.destroy();Laya.loader.clearRes(e)}}n.clearResByUrl=o;function r(e){if(I.isRes3dUrl(e)===true&&I.getRes3dJsonUrl(e)===e){var t=I.getAssetUrlsByRes3dJson(Laya.loader.getRes(e));for(var o=0;o<t.length;o++){n.clearResByUrl(t[o])}}n.clearResByUrl(e)}})(Y=o.UrlLocker||(o.UrlLocker={}));function x(e,t){var o=e.split("/");while(t!=null&&o.length>0){var n=o.shift();t=t.getChildByName(n)}return t}o.find=x})(sunui||(sunui={}));