var __extends=this&&this.__extends||function(){var n=function(e,t){n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o))e[o]=t[o]};return n(e,t)};return function(e,t){n(e,t);function o(){this.constructor=e}e.prototype=t===null?Object.create(t):(o.prototype=t.prototype,new o)}}();var sunui;(function(o){var i;(function(e){e[e["NONE"]=0]="NONE";e[e["YES"]=1]="YES";e[e["NO"]=2]="NO";e[e["CANCEL"]=3]="CANCEL"})(i=o.ConfirmOptionValueEnum||(o.ConfirmOptionValueEnum={}));var l;(function(e){e[e["NONE"]=0]="NONE";e[e["SIMPLY"]=1]="SIMPLY";e[e["TRANSPARENT"]=2]="TRANSPARENT";e[e["MOUSE_THROUGH"]=4]="MOUSE_THROUGH";e[e["SYNC_FADE_TIME"]=8]="SYNC_FADE_TIME"})(l=o.PopupFlagEnum||(o.PopupFlagEnum={}));var t;(function(e){e[e["NONE"]=0]="NONE";e[e["HIGH"]=131072]="HIGH";e[e["MID"]=32768]="MID";e[e["LOW"]=8192]="LOW"})(t=o.ResourceDownloadSpeedEnum||(o.ResourceDownloadSpeedEnum={}));var u;(function(e){e[e["AUTO"]=16]="AUTO";e[e["CONFIRM"]=32]="CONFIRM";e[e["TERMINATE"]=64]="TERMINATE"})(u=o.RetryMethodEnum||(o.RetryMethodEnum={}));var c;(function(e){e[e["NONE"]=0]="NONE";e[e["BACKGROUND"]=1]="BACKGROUND";e[e["SCENE"]=2]="SCENE";e[e["PANEL"]=3]="PANEL";e[e["FLOAT"]=4]="FLOAT";e[e["GOLD_TIPS"]=5]="GOLD_TIPS";e[e["HIGH_GOLD_TIPS"]=6]="HIGH_GOLD_TIPS";e[e["NOTICE"]=7]="NOTICE";e[e["BIGWINNER"]=8]="BIGWINNER";e[e["MINI_GAME"]=9]="MINI_GAME";e[e["POPUP"]=10]="POPUP";e[e["WAITINGBOX"]=11]="WAITINGBOX";e[e["LOADING"]=12]="LOADING";e[e["LAMP_TIPS"]=13]="LAMP_TIPS";e[e["TIPS"]=14]="TIPS";e[e["TOP"]=15]="TOP";e[e["DEBUG"]=16]="DEBUG"})(c=o.UILevel||(o.UILevel={}));var e=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.$makeProps=function(e){if(e.x===void 0&&e.left===void 0&&e.right===void 0){e.centerX=0}if(e.y===void 0&&e.top===void 0&&e.bottom===void 0){e.centerY=0}};t.prototype.$applyShowProps=function(e,t,o){if(t.x!==void 0){e.x=t.x}if(t.y!==void 0){e.y=t.y}if(t.centerX!==void 0){e.centerX=t.centerX}if(t.centerY!==void 0){e.centerY=t.centerY}if(o===0||t.flags&l.SIMPLY){if(t.left!==void 0){e.left=t.left}if(t.right!==void 0){e.right=t.right}if(t.top!==void 0){e.top=t.top}if(t.bottom!==void 0){e.bottom=t.bottom}if(t.scaleX!==void 0){e.scaleX=t.scaleX}if(t.scaleY!==void 0){e.scaleY=t.scaleY}}else{if(t.left!==void 0){e.left=-e.width}if(t.right!==void 0){e.right=-e.width}if(t.top!==void 0){e.top=-e.height}if(t.bottom!==void 0){e.bottom=-e.height}if(t.left===void 0&&t.right===void 0&&t.top===void 0&&t.bottom===void 0){e.alpha=0;e.scaleX=0;e.scaleY=0;t.alpha=1;if(t.scaleX===void 0){t.scaleX=1}if(t.scaleY===void 0){t.scaleY=1}}O.get(e,t.mod).to(t,o,t.ease)}};t.prototype.$applyCloseProps=function(e,t,o){if(o>0&&(t.flags&l.SIMPLY)===l.NONE){if(t.left!==void 0){t.left=-e.width}if(t.right!==void 0){t.right=-e.width}if(t.top!==void 0){t.top=-e.height}if(t.bottom!==void 0){t.bottom=-e.height}if(t.left===void 0&&t.right===void 0&&t.top===void 0&&t.bottom===void 0){t.alpha=0;t.scaleX=0;t.scaleY=0}O.get(e,t.mod).to(t,o)}};return t}(puremvc.SimpleCommand);o.AbstractPopupCommand=e;var n=function(n){__extends(e,n);function e(e,t){var o=n.call(this)||this;o.$info=null;o.$info=e;o.$data=t;return o}return e}(suncore.AbstractTask);o.AbstractSceneTask=n;var r=function(n){__extends(e,n);function e(e,t){var o=n.call(this)||this;o.$loading=false;o.$complete=null;o.$url=null;o.$loaders=[];o.$doneCount=0;o.$url=e;o.$complete=t;F.lock(o.$url);return o}e.prototype.destroy=function(){if(this.$destroyed===true){return}n.prototype.destroy.call(this);for(var e=0;e<this.$loaders.length;e++){this.$loaders[e].destroy()}F.unlock(this.$url)};e.prototype.load=function(){if(this.$loading===false&&this.$destroyed===false){this.$loading=true;this.$doLoad()}};e.prototype.$loadAssets=function(e){this.$doneCount=this.$loaders.length;for(var t=0;t<e.length;t++){this.$loaders.push(new M(e[t],suncom.Handler.create(this,this.$onLoadAsset)))}};e.prototype.$onLoadAsset=function(e){if(e===false){this.$onAssetsLoaded(false)}else{this.$doneCount++;if(this.$doneCount===this.$loaders.length){this.$onAssetsLoaded(true)}}};e.prototype.$onComplete=function(e){if(this.$destroyed===false){this.$complete.runWith(e)}this.destroy();this.$loading=false};return e}(puremvc.Notifier);o.AssetLoader=r;var d=function(n){__extends(e,n);function e(e,t){var o=n.call(this)||this;o.$url=null;o.$complete=null;o.$loader=null;o.$retryer=new $(u.TERMINATE,suncom.Handler.create(o,o.$onRetryConfirmed),"资源加载失败，点击确定重新尝试！");F.lock(e);o.$url=e;o.$complete=t;o.$doLoad();return o}e.prototype.destroy=function(){if(this.$destroyed===true){return}n.prototype.destroy.call(this);this.$retryer.cancel();this.$loader!==null&&this.$loader.destroy();F.unlock(this.$url)};e.prototype.$doLoad=function(){var e=suncom.Handler.create(this,this.$onLoad);if(F.isRes3dUrl(this.$url)===true){this.$loader=new p(this.$url,e)}else if(suncom.Common.getFileExtension(this.$url)==="sk"){this.$loader=new L(this.$url,e)}else{this.$loader=new A(this.$url,e)}this.$loader.load()};e.prototype.$onLoad=function(e){if(e===true){this.$complete.runWith(this.$url)}else{this.$retryer.run(1e3,suncom.Handler.create(this,this.$doLoad),2)}this.$loader=null};e.prototype.$onRetryConfirmed=function(e){if(e===i.NO){this.$retryer.reset();suncom.Logger.warn(suncom.DebugMode.ANY,"失败："+this.$url);this.facade.sendNotification(G.ON_ASSET_SAFETY_LOADER_FAILED);this.facade.registerObserver(G.ASSET_SAFETY_LOADER_RETRY,this.$onAssetSafetyLoaderRetry,this,true)}else{this.facade.sendNotification(suncore.NotifyKey.SHUTDOWN)}};e.prototype.$onAssetSafetyLoaderRetry=function(){if(this.$destroyed===false){suncom.Logger.warn(suncom.DebugMode.ANY,"重试："+this.$url);this.$doLoad()}};Object.defineProperty(e.prototype,"complete",{get:function(){return this.$complete},enumerable:false,configurable:true});return e}(puremvc.Notifier);o.AssetSafetyLoader=d;var s=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e,t,o){var n=x.viewLayer.getInfoByView(e);if(n===null){suncom.Logger.error(suncom.DebugMode.ANY,e+"["+(e&&e.name)+"]'s infomation is not exist.");return}if(o!==void 0){n.keepNode=!o}if(n.closed===true){return}n.closed=true;x.viewLayer.onViewClose(e);this.facade.sendNotification(G.ON_POPUP_CLOSED,e);if((n.props.flags&l.TRANSPARENT)===l.NONE){var r=O.get(n.mask,n.props.mod);if(t>200&&(n.props.flags&l.SYNC_FADE_TIME)===l.NONE){r.wait(t-200).to({alpha:0},200)}else{r.to({alpha:0},t)}}this.$applyCloseProps(e,n.props,t);var i=suncom.Handler.create(this,this.$onCloseFinish,[e]);suncore.System.addTrigger(n.props.mod,t,i)};t.prototype.$onCloseFinish=function(e){x.viewLayer.removeStackInfoByView(e)};return t}(e);o.ClosePopupCommand=s;var a=function(n){__extends(e,n);function e(e,t){var o=n.call(this)||this;o.$relieved=false;o.$command=e;o.$condition=t;o.facade.registerObserver(e,o.$onCommandCallback,o,false,suncom.EventPriorityEnum.HIGHEST);return o}e.prototype.destroy=function(){if(this.$destroyed===true){return}n.prototype.destroy.call(this);this.facade.removeObserver(this.$command,this.$onCommandCallback,this)};Object.defineProperty(e.prototype,"command",{get:function(){return this.$command},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"relieved",{get:function(){return this.$relieved},enumerable:false,configurable:true});return e}(puremvc.Notifier);o.GUILogicInterceptor=a;var f=function(o){__extends(e,o);function e(e){if(e===void 0){e=true}var t=o.call(this)||this;t.$hashId=suncom.Common.createHashId();t.$timerId=0;t.$commands=[];t.$autoDestroy=false;t.$autoDestroy=e;t.facade.registerObserver(G.NEXT_LOGIC_COMMAND,t.$onNextLogicCommand,t);t.facade.registerObserver(G.DESTROY_LOGIC_RUNNABLE,t.$onDestroyLogicRunnable,t);t.facade.registerObserver(G.DESTROY_ALL_LOGIC_RUNNABLE,t.$onDestroyAllLogicRunnable,t);return t}e.prototype.destroy=function(){if(this.$destroyed===true){return}o.prototype.destroy.call(this);this.facade.removeObserver(G.NEXT_LOGIC_COMMAND,this.$onNextLogicCommand,this);this.facade.removeObserver(G.DESTROY_LOGIC_RUNNABLE,this.$onDestroyLogicRunnable,this);this.facade.removeObserver(G.DESTROY_ALL_LOGIC_RUNNABLE,this.$onDestroyAllLogicRunnable,this);for(var e=0;e<this.$commands.length;e++){this.$commands[e].destroy()}};e.prototype.$onDestroyAllLogicRunnable=function(){this.destroy()};e.prototype.$onDestroyLogicRunnable=function(e){if(this.$autoDestroy===false&&this.$hashId===e){this.destroy()}};e.prototype.$onNextLogicCommand=function(e){var t=-1;for(var o=0;o<this.$commands.length;o++){if(this.$commands[o]===e){t=o;break}}if(t===-1){return}t++;this.facade.notifyCancel();if(t<this.$commands.length){var n=this.$commands[t];if(n.running===false){n.run()}}else if(this.$autoDestroy===true){this.destroy()}};e.prototype.$addCommand=function(e,t,o){this.$commands.push(new k(e,t,o));if(this.$commands[0].running===false){this.$commands[0].run()}};Object.defineProperty(e.prototype,"hashId",{get:function(){return this.$hashId},enumerable:false,configurable:true});return e}(puremvc.Notifier);o.GUILogicRunnable=f;var h=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e){for(var t=0;t<e.length;t++){var o=e[t];B.regScene(o)}};return t}(puremvc.SimpleCommand);o.RegisterScenesCommand=h;var p=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.$doLoad=function(){var e=F.getRes3dJsonUrl(this.$url);var t=Laya.loader.getRes(this.$url)===void 0?false:true;if(suncom.Common.getFileExtension(this.$url)==="ls"||t===true){this.$loadAssets([e])}else{this.$loaders.push(new M(e,suncom.Handler.create(this,this.$onUrlLoaded)))}};t.prototype.$onUrlLoaded=function(e,t){if(e===true){var o=x.cacheMap[this.$url]||null;if(o===null){this.$loadAssets([this.$url])}else{this.$onAssetsLoaded(true)}}else{this.$onComplete(false)}};t.prototype.$onAssetsLoaded=function(e){if(suncom.Common.getFileExtension(this.$url)==="ls"){this.$onComplete(e)}else{var t=x.cacheMap[this.$url]||null;if(t===null){t=x.cacheMap[this.$url]=Laya.loader.getRes(this.$url)}this.$onComplete(e)}};return t}(r);o.Res3dLoader=p;var m=function(t){__extends(n,t);function n(){var e=t!==null&&t.apply(this,arguments)||this;e.$undoList=[];e.$loadingList=[];e.$isRetryPrompting=false;return e}n.prototype.$onRun=function(){this.facade.registerObserver(G.ON_URL_SAFETY_LOADER_CREATED,this.$onUrlSafetyLoaderCreated,this);this.facade.registerObserver(G.ON_URL_SAFETY_LOADER_COMPLETE,this.$onUrlSafetyLoaderComplete,this);this.facade.registerObserver(G.ON_ASSET_SAFETY_LOADER_FAILED,this.$onAssetSafetyLoaderFailed,this)};n.prototype.$onStop=function(){this.facade.removeObserver(G.ON_URL_SAFETY_LOADER_CREATED,this.$onUrlSafetyLoaderCreated,this);this.facade.removeObserver(G.ON_URL_SAFETY_LOADER_COMPLETE,this.$onUrlSafetyLoaderComplete,this);this.facade.removeObserver(G.ON_ASSET_SAFETY_LOADER_FAILED,this.$onAssetSafetyLoaderFailed,this)};n.prototype.$onUrlSafetyLoaderCreated=function(e){this.$undoList.unshift(e);if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.trace(suncom.DebugMode.ANY,"create loader for url "+e.url+", loading list length:"+this.$loadingList.length+", undo list length:"+this.$undoList.length)}this.$next()};n.prototype.$onUrlSafetyLoaderComplete=function(e){var t=this.$loadingList.indexOf(e);suncom.Test.expect(t).toBeGreaterOrEqualThan(0);this.$loadingList.splice(t,1);if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.trace(suncom.DebugMode.ANY,"remove loader for url "+e.url+", loading list length:"+this.$loadingList.length+", undo list length:"+this.$undoList.length)}this.$next()};n.prototype.$next=function(){while(this.$undoList.length>0&&this.$loadingList.length<n.MAX_LOAD_COUNT){var e=false;for(var t=this.$undoList.length-1;t>-1;t--){var o=this.$undoList[t];if(o.destroyed===true){this.$undoList.splice(t,1);continue}if(this.$isUrlInLoading(o.url)===true){continue}if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.trace(suncom.DebugMode.ANY,"load next url "+o.url+", loading list length:"+this.$loadingList.length+" + 1")}e=true;o.load();this.$loadingList.push(o);break}if(e===false){break}}};n.prototype.$isUrlInLoading=function(e){for(var t=0;t<this.$loadingList.length;t++){var o=this.$loadingList[t];if(o.url===e){return true}}return false};n.prototype.$onAssetSafetyLoaderFailed=function(){if(this.$isRetryPrompting===false){this.$isRetryPrompting=true;this.facade.sendNotification(G.RETRY_CONFIRM,[suncore.ModuleEnum.SYSTEM,"资源加载失败，点击确定重新尝试！",[i.YES,"确定",i.NO,"取消"],suncom.Handler.create(this,this.$onRetryConfirmed)])}};n.prototype.$onRetryConfirmed=function(e){if(e===i.YES){this.facade.sendNotification(G.ASSET_SAFETY_LOADER_RETRY)}else{this.facade.sendNotification(suncore.NotifyKey.SHUTDOWN)}this.$isRetryPrompting=false};n.MAX_LOAD_COUNT=5;return n}(suncore.BaseService);o.ResourceService=m;var $=function(a){__extends(e,a);function e(e,t,o){if(t===void 0){t=null}if(o===void 0){o=null}var n=[];for(var r=3;r<arguments.length;r++){n[r-3]=arguments[r]}var i=a.call(this,suncore.MsgQModEnum.MMI)||this;i.$options=[];i.$currentRetries=0;i.$retryHandler=null;i.$retryTimerId=0;i.$prompting=false;if((e&u.CONFIRM)===u.CONFIRM){i.$method=u.CONFIRM}else if((e&u.TERMINATE)===u.TERMINATE){i.$method=u.TERMINATE}else{i.$method=u.AUTO}var s=e&=15;if(e===suncore.ModuleEnum.CUSTOM||e===suncore.ModuleEnum.TIMELINE){i.$mod=e}else{i.$mod=suncore.ModuleEnum.SYSTEM}i.$prompt=o;i.$options=n;i.$confirmHandler=t;return i}e.prototype.run=function(e,t,o){if(o===void 0){o=2}if(this.$method===u.AUTO||this.$currentRetries<o){if(this.$retryTimerId===0){this.$retryHandler=t;this.$retryTimerId=suncore.System.addTimer(suncore.ModuleEnum.SYSTEM,e,this.$onRetryTimer,this)}else{suncom.Logger.warn(suncom.DebugMode.ANY,"己忽略的重试请求 method:"+suncom.Common.getMethodName(t.method,t.caller)+", caller:"+suncom.Common.getQualifiedClassName(t.caller))}}else{if(this.$prompting===false){this.$prompting=true;if(this.$method===u.TERMINATE){var n=suncom.Handler.create(this,this.$onConfirmReplied,[i.NO]);suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_0,n)}else{var r=suncom.Handler.create(this,this.$onConfirmReplied);this.facade.sendNotification(G.RETRY_CONFIRM,[this.$mod,this.$prompt,this.$options,r])}}else{suncom.Logger.warn(suncom.DebugMode.ANY,"己忽略的重试的询问请求 prompt:"+this.$prompt)}}};e.prototype.$onConfirmReplied=function(e){if(this.$prompting===true){this.$prompting=false;if(this.$confirmHandler!==null){this.$confirmHandler.runWith(e)}}};e.prototype.$onRetryTimer=function(){this.$retryTimerId=0;this.$currentRetries++;this.$retryHandler.run()};e.prototype.cancel=function(){this.$prompting=false;this.$retryTimerId=suncore.System.removeTimer(this.$retryTimerId)};e.prototype.reset=function(){this.$currentRetries=0};Object.defineProperty(e.prototype,"currentRetries",{get:function(){return this.$currentRetries},enumerable:false,configurable:true});return e}(puremvc.Notifier);o.Retryer=$;var y=function(n){__extends(e,n);function e(e,t){var o=n.call(this,e,t)||this;o.facade.registerObserver(G.ENTER_SCENE,o.$onEnterScene,o,true,suncom.EventPriorityEnum.EGL);return o}e.prototype.$onEnterScene=function(){};return e}(n);o.SceneIniClass=y;var E=function(t){__extends(e,t);function e(){var e=t.call(this)||this;e.$ready=true;e.$sceneName=0;e.$scene2d=null;e.$scene3d=null;e.$data=null;e.facade.registerObserver(G.ENTER_SCENE,e.$onEnterScene,e,false,suncom.EventPriorityEnum.OSL);return e}e.prototype.$enterScene=function(e,t){var o=B.getConfigByName(e);suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_LAZY,suncom.Handler.create(this,this.$beforeLoadScene,[o,t]));suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_LAZY,suncom.Handler.create(this,this.$loadScene,[o]))};e.prototype.$beforeLoadScene=function(e,t){this.$data=t;this.$sceneName=e.name;this.facade.sendNotification(G.BEFORE_LOAD_SCENE);e.iniCls&&suncore.System.addTask(suncore.ModuleEnum.SYSTEM,0,new e.iniCls(e,t))};e.prototype.$loadScene=function(e){this.facade.sendNotification(suncore.NotifyKey.START_TIMELINE,[suncore.ModuleEnum.CUSTOM,true]);e.scene3d=e.scene3d||null;this.facade.sendNotification(G.LOAD_SCENE,e)};e.prototype.$onEnterScene=function(e,t){this.$ready=true;this.$scene2d=e||null;this.$scene3d=t||null;this.facade.sendNotification(suncore.NotifyKey.START_TIMELINE,[suncore.ModuleEnum.CUSTOM,false])};e.prototype.$exitScene=function(){this.facade.sendNotification(G.EXIT_SCENE,this.$sceneName);this.facade.sendNotification(suncore.NotifyKey.PAUSE_TIMELINE,[suncore.ModuleEnum.CUSTOM,true]);var e=B.getConfigByName(this.$sceneName);suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_LAZY,suncom.Handler.create(this,this.$onLeaveScene,[e]))};e.prototype.$onLeaveScene=function(e){e.uniCls&&suncore.System.addTask(suncore.ModuleEnum.SYSTEM,0,new e.uniCls(e,this.$data));this.facade.sendNotification(G.DESTROY_ALL_LOGIC_RUNNABLE);this.facade.sendNotification(G.LEAVE_SCENE);this.facade.sendNotification(G.UNLOAD_SCENE,[this.$scene2d,this.$scene3d]);e.scene2d!==null&&F.clearResByUrl(e.scene2d);suncore.System.addTask(suncore.ModuleEnum.SYSTEM,0,new suncore.SimpleTask(suncom.Handler.create(this,this.$onExitScene)))};e.prototype.$onExitScene=function(){this.$sceneName=0};e.prototype.enterScene=function(e,t){if(this.$ready===false){return false}this.$ready=false;this.$sceneName!=0&&this.$exitScene();this.$enterScene(e,t);H.addHistory(e,t);return true};e.prototype.exitScene=function(){if(this.$ready===false){return}this.$ready=false;this.$sceneName!=0&&this.$exitScene();H.removeHistory(this.$sceneName);var e=H.getLastestSceneInfo();e!==null&&this.$enterScene(e.name,e.data)};e.prototype.replaceScene=function(e,t){var o=H.getLastestSceneInfo();if(this.enterScene(e,t)===true){o!==null&&H.removeHistory(o.name)}};e.prototype.deleteHistories=function(e){H.deleteHistories(e)};Object.defineProperty(e.prototype,"scene2d",{get:function(){return this.$scene2d},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"scene3d",{get:function(){return this.$scene3d},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"sceneName",{get:function(){return this.$ready===false?0:this.$sceneName},enumerable:false,configurable:true});return e}(puremvc.Notifier);o.SceneLayer=E;var v=function(n){__extends(e,n);function e(e,t){var o=n.call(this,e,t)||this;o.facade.registerObserver(G.LEAVE_SCENE,o.$onLeaveScene,o,true,suncom.EventPriorityEnum.EGL);return o}e.prototype.$onLeaveScene=function(){};return e}(n);o.SceneUniClass=v;var g=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e,t,o){if(x.viewLayer.getInfoByView(e)!==null){suncom.Logger.error(suncom.DebugMode.ANY,e+"["+e.name+"] is already popup.");return}if(o.mod===void 0){o.mod=suncore.ModuleEnum.CUSTOM}if(o.ease===void 0){o.ease=Laya.Ease.backOut}if(o.flags===void 0){o.flags=l.NONE}if(o.keepNode===void 0){o.keepNode=false}var n=o.args;var r=o.level||e.zOrder||c.POPUP;var i=o.keepNode;delete o.args;delete o.level;delete o.keepNode;this.$makeProps(o);if(o.trans===true&&(o.flags&l.TRANSPARENT)===l.NONE){suncom.Logger.warn(suncom.DebugMode.ANY,"ViewFacade：props的trans属性己弃用，请使用flags代替！！！");o.flags|=l.TRANSPARENT}var s=x.viewLayer.createMask(e,o);s.name="Mask$"+e.name;s.zOrder=e.zOrder=r;var a={view:e,mask:s,props:o,closed:false,keepNode:i,displayed:false,duration:t,cancelAllowed:false};x.viewLayer.addToStack(a);x.viewLayer.addChild(s);x.viewLayer.addChild(e);suncom.Test.expect(e["pivot"]).anything();e["pivot"](e.width*.5,e.height*.5);x.viewLayer.onViewCreate(e,n);if((o.flags&l.TRANSPARENT)===l.NONE){if(o.flags&l.SYNC_FADE_TIME){O.get(s,a.props.mod).from({alpha:0},t)}else{O.get(s,a.props.mod).from({alpha:0},t>200?200:t)}}this.$applyShowProps(e,o,t);var u=suncom.Handler.create(this,this.$onPopupFinish,[e]);suncore.System.addTrigger(a.props.mod,t,u)};t.prototype.$onPopupFinish=function(e){var t=x.viewLayer.getInfoByView(e);if(t!==null&&t.closed===false){t.displayed=true;x.viewLayer.onViewOpen(e)}};return t}(e);o.ShowPopupCommand=g;var L=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.$doLoad=function(){this.$loadAssets([this.$url,suncom.Common.replacePathExtension(this.$url,"png")])};t.prototype.$onAssetsLoaded=function(e){if(e===true){var t=x.cacheMap[this.$url]||null;if(t===null){t=x.cacheMap[this.$url]=new Laya.Templet;t.loadAni(this.$url)}var o=suncom.Handler.create(this,this.$onTempletCreated);suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_0,o);F.lock(this.$url)}else{this.$onComplete(false)}};t.prototype.$onTempletCreated=function(){if(this.destroyed===false){var e=x.cacheMap[this.$url];this.$onComplete(true)}F.unlock(this.$url)};return t}(r);o.SkeletonLoader=L;var N=function(a){__extends(e,a);function e(e,t,o){var n=a.call(this)||this;n.$id=0;n.$handler=null;n.$doneList=[];n.$loaders=[];n.$id=e;n.$handler=o;t=F.checkLoadList(t);suncom.Test.expect(t.length).toBeGreaterThan(0);while(t.length>0){var r=t.shift();var i=suncom.Handler.create(n,n.$onResourceCreated);var s=new d(r,i);n.$loaders.push(s)}return n}e.prototype.destroy=function(){if(this.$destroyed===true){return}a.prototype.destroy.call(this);var e=suncom.Handler.create(this,this.$releaseAllResources);suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_0,e)};e.prototype.$onResourceCreated=function(e){this.$doneList.push(e);if(this.$doneList.length<this.$loaders.length){return}if(this.$destroyed===true){return}this.$handler.runWith([this.$id])};e.prototype.$releaseAllResources=function(){for(var e=0;e<this.$loaders.length;e++){this.$loaders[e].destroy()}};return e}(puremvc.Notifier);o.Templet=N;var O=function(t){__extends(n,t);function n(){var e=t!==null&&t.apply(this,arguments)||this;e.$hashId=0;e.$mod=suncore.ModuleEnum.SYSTEM;e.$target=null;e.$props=null;e.$actions=[];e.$usePool=false;return e}n.prototype.$setTo=function(e,t){if(this.$hashId===-1){throw Error("Tween己被回收！！！")}this.$mod=t;this.$target=e;this.$hashId=suncom.Common.createHashId();if(suncore.System.isModuleStopped(t)===false){this.facade.sendNotification(G.REGISTER_TWEEN_OBJECT,this)}else{suncom.Logger.error(suncom.DebugMode.ANY,"尝试添加缓动，但时间轴己停止，mod:"+suncore.ModuleEnum[t])}return this};n.prototype.cancel=function(){this.$props=null;while(this.$actions.length>0){this.$actions.pop().recover()}return this};n.prototype.recover=function(){if(suncom.Pool.recover("sunui.Tween",this.cancel())===true){this.$hashId=-1}};n.prototype.to=function(e,t,o,n){if(o===void 0){o=null}if(n===void 0){n=null}var r=Object.keys(e);var i=this.$props===null?this.$target:this.$props;this.$createTweenInfo(r,i,e,t,o,e.update||null,n);return this};n.prototype.from=function(e,t,o,n){if(o===void 0){o=null}if(n===void 0){n=null}var r=Object.keys(e);var i=this.$props===null?this.$target:this.$props;this.$createTweenInfo(r,e,i,t,o,e.update||null,n);return this};n.prototype.by=function(e,t,o,n){if(o===void 0){o=null}if(n===void 0){n=null}var r=Object.keys(e);var i=this.$props===null?this.$target:this.$props;for(var s=0;s<r.length;s++){var a=r[s];if(this.$props===null||this.$props[a]===void 0){e[a]+=this.$target[a]}else{e[a]+=i[a]}}this.to(e,t,o,n);return this};n.prototype.$createTweenInfo=function(e,t,o,n,r,i,s){this.$props=this.$props||{};var a=S.create();a.ease=r;a.update=i;a.complete=s;a.time=suncore.System.getModuleTimestamp(this.$mod);a.duration=n;this.$addAction(a);for(var u=0;u<e.length;u++){var l=e[u];if(l==="update"){continue}var c=_.create();c.to=o[l];c.from=t[l];c.prop=l;if(c.from===void 0){c.from=this.$target[l]}this.$props[l]=o[l];if(this.$actions.length===0){this.$target[c.prop]=c.from}a.clips.push(c)}};n.prototype.$addAction=function(e){if(this.$hashId===-1){throw Error("Tween己被回收！！！")}this.$actions.push(e)};n.prototype.wait=function(e,t){if(t===void 0){t=null}var o=S.create();o.complete=t;o.time=suncore.System.getModuleTimestamp(this.$mod);o.duration=e;this.$addAction(o);return this};n.prototype.doAction=function(){var e=suncore.System.getModuleTimestamp(this.$mod);var t=this.$actions[0];if(this.$target.destroyed===true){this.cancel();return 0}var o=false;var n=0;var r=e-t.time;if(r>t.duration){o=true;n=r-t.duration;r=t.duration}var i=t.ease||this.$easeNone;for(var s=0;s<t.clips.length;s++){var a=t.clips[s];if(o===true){this.$target[a.prop]=a.to}else{this.$target[a.prop]=i(r,a.from,a.to-a.from,t.duration)}}if(t.update!==null){t.update.run()}if(o===false){return 0}this.$actions.shift().recover();if(this.$actions.length>0){this.$actions[0].time=suncore.System.getModuleTimestamp(this.$mod)}t.complete!==null&&t.complete.run();return n};n.prototype.$easeNone=function(e,t,o,n){var r=e/n;if(r>1){r=1}return r*o+t};n.prototype.usePool=function(e){this.$usePool=e;return this};n.prototype.getUsePool=function(){return this.$usePool};Object.defineProperty(n.prototype,"mod",{get:function(){return this.$mod},enumerable:false,configurable:true});Object.defineProperty(n.prototype,"canceled",{get:function(){return this.$actions.length===0},enumerable:false,configurable:true});n.get=function(e,t){if(t===void 0){t=suncore.ModuleEnum.CUSTOM}var o=new n;o.$hashId=0;return o.usePool(true).$setTo(e,t)};return n}(puremvc.Notifier);o.Tween=O;var S=function(){function e(){this.ease=null;this.clips=[];this.update=null;this.complete=null;this.time=0;this.duration=0}e.prototype.recover=function(){this.ease=null;while(this.clips.length>0){this.clips.pop().recover()}this.update=null;this.complete=null;this.time=0;this.duration=0;suncom.Pool.recover("sunui.TweenAction",this)};e.create=function(){return suncom.Pool.getItemByClass("sunui.TweenAction",e)};return e}();o.TweenAction=S;var _=function(){function e(){this.prop=null;this.from=0;this.to=0}e.prototype.recover=function(){this.prop=null;this.from=0;this.to=0;suncom.Pool.recover("sunui.TweenActionClip",this)};e.create=function(){return suncom.Pool.getItemByClass("sunui.TweenActionClip",e)};return e}();o.TweenActionClip=_;var R=function(t){__extends(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.$locker=false;e.$tweens=[];return e}e.prototype.$onRun=function(){this.facade.registerObserver(suncore.NotifyKey.ENTER_FRAME,this.$onEnterFrame,this,false,suncom.EventPriorityEnum.EGL);this.facade.registerObserver(suncore.NotifyKey.PAUSE_TIMELINE,this.$onTimelinePause,this,false,suncom.EventPriorityEnum.EGL);this.facade.registerObserver(G.REGISTER_TWEEN_OBJECT,this.$onRegisterTweenObject,this)};e.prototype.$onStop=function(){this.facade.removeObserver(suncore.NotifyKey.ENTER_FRAME,this.$onEnterFrame,this);this.facade.removeObserver(suncore.NotifyKey.PAUSE_TIMELINE,this.$onTimelinePause,this);this.facade.removeObserver(G.REGISTER_TWEEN_OBJECT,this.$onRegisterTweenObject,this)};e.prototype.$onEnterFrame=function(){this.$locker=true;var e=this.$tweens;for(var t=suncore.ModuleEnum.MIN;t<suncore.ModuleEnum.MAX;t++){if(suncore.System.isModulePaused(t)===false){for(var o=0;o<e.length;o++){var n=e.length[o];if(n.mod===t){var r=1;while(r>0&&n.canceled===false){r=n.doAction()}}}}}for(var o=this.$tweens.length-1;o>-1;o--){var n=this.$tweens[o];if(n.canceled===true&&n.getUsePool()===true){suncom.Pool.recover("sunui.Tweeen",e.splice(o,1)[0])}}this.$locker=false};e.prototype.$onTimelinePause=function(e,t){if(t===true){for(var o=0;o<this.$tweens.length;o++){var n=this.$tweens[o];if(n.mod===e){n.cancel()}}}};e.prototype.$onRegisterTweenObject=function(e){if(this.$locker===true){this.$tweens=this.$tweens.slice(0);this.$locker=false}this.$tweens.push(e)};return e}(suncore.BaseService);o.TweenService=R;var T=function(t){__extends(e,t);function e(){var e=t.call(this)||this;x.sceneLayer=new E;if(Laya.Scene3D===void 0){x.viewLayer=new w}else{x.viewLayer=new U}suncom.DBService.put(-1,new R).run();suncom.DBService.put(-1,new m).run();e.facade.registerCommand(G.SHOW_POPUP,g,suncom.EventPriorityEnum.OSL);e.facade.registerCommand(G.CLOSE_POPUP,s,suncom.EventPriorityEnum.OSL);return e}e.getInstance=function(){if(e.$inst===null){e.$inst=new e}return e.$inst};e.prototype.enterScene=function(e,t){puremvc.MutexLocker.backup(this);x.sceneLayer.enterScene(e,t);puremvc.MutexLocker.restore()};e.prototype.exitScene=function(){puremvc.MutexLocker.backup(this);x.sceneLayer.exitScene();puremvc.MutexLocker.restore()};e.prototype.replaceScene=function(e,t){puremvc.MutexLocker.backup(this);x.sceneLayer.replaceScene(e,t);puremvc.MutexLocker.restore()};e.prototype.deleteHistories=function(e){x.sceneLayer.deleteHistories(e)};e.prototype.removeView=function(e){x.viewLayer.removeStackInfoByView(e)};Object.defineProperty(e.prototype,"scene2d",{get:function(){return x.sceneLayer.scene2d},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"scene3d",{get:function(){return x.sceneLayer.scene3d},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"sceneName",{get:function(){return x.sceneLayer.sceneName},enumerable:false,configurable:true});e.$inst=null;return e}(puremvc.Notifier);o.UIManager=T;var C=function(n){__extends(e,n);function e(e,t){var o=n.call(this)||this;o.$url=null;o.$data=null;o.$handler=null;o.$totalSize=0;o.$currentSize=0;o.$priority=0;o.$url=e;o.$handler=t;o.$priority=suncom.Mathf.random(0,6);if(Laya.loader.getRes(e)!==void 0){o.$totalSize=-1}x.downloadLimiters.push(o);return o}e.prototype.destroy=function(){if(this.$destroyed===true){return}n.prototype.destroy.call(this);var e=x.downloadLimiters.indexOf(this);if(e<0){throw Error("加载限制器不存在：index:"+e)}x.downloadLimiters.splice(e,1);this.facade.removeObserver(suncore.NotifyKey.ENTER_FRAME,this.$onEnterFrame,this)};e.prototype.updateDownloadSize=function(e){if(e===null||this.$totalSize===-1){this.$totalSize=1}else if(suncom.Common.getFileExtension(this.$url)==="atlas"){var t=Laya.loader.getRes(suncom.Common.replacePathExtension(this.$url,"png"))||null;var o=(t===null?0:t["gpuMemory"])||1;this.$totalSize=o+this.$getStringSize(Laya.loader.getRes(this.$url)||null)}else if(suncom.Common.getFileExtension(this.$url)==="png"||suncom.Common.getFileExtension(this.$url)==="jpg"){var t=Laya.loader.getRes(suncom.Common.replacePathExtension(this.$url,"png"))||null;this.$totalSize=(t===null?0:t.bitmap["gpuMemory"])||1}else if(suncom.Common.getFileExtension(this.$url)==="json"){this.$totalSize=this.$getStringSize(Laya.loader.getRes(this.$url)||null)}else if(suncom.Common.getFileExtension(this.$url)==="sk"){var n=e;this.$totalSize=n.byteLength}else if(suncom.Common.getFileExtension(this.$url)==="lh"){var r=Laya.loader.getRes(suncom.Common.replacePathExtension(this.$url,"json"));var i=F.getAssetUrlsByRes3dJson(r);for(var s=0;s<i.length;s++){var a=i[s];var u=Laya.loader.getRes(a)||null;if(u["gpuMemory"]>0){this.$totalSize+=u["gpuMemory"]}else{try{this.$totalSize+=this.$getStringSize(u)}catch(e){this.$totalSize+=1}}}}else{this.$totalSize=1}this.$data=e;this.facade.registerObserver(suncore.NotifyKey.ENTER_FRAME,this.$onEnterFrame,this)};e.prototype.$onEnterFrame=function(){this.$currentSize+=this.$getDowloadSpeed()*(10-this.$priority)/10;if(this.$totalSize>0&&this.$currentSize>this.$totalSize){suncom.Logger.log(suncom.DebugMode.DEBUG,"[100%] "+this.$url+":{"+this.$currentSize+":"+this.$totalSize+"}");this.$handler.runWith(this.$data);this.destroy()}else{if(this.$totalSize>0){suncom.Logger.log(suncom.DebugMode.DEBUG,"["+Math.floor(this.$currentSize/this.$totalSize*100)+"%] "+this.$url+":{"+this.$currentSize+":"+this.$totalSize+"}")}else{suncom.Logger.log(suncom.DebugMode.DEBUG,"[0%] "+this.$url+":{"+this.$currentSize+":"+this.$totalSize+"}")}}};e.prototype.$getDowloadSpeed=function(){if(x.downloadLimiters.length<=1){return x.downloadSpeed}else{return x.downloadSpeed/x.downloadLimiters.length}};e.prototype.$getStringSize=function(e){var t=null;var o=0;if(e===null){return 1}if(typeof e==="number"||typeof e==="string"){t=e.toString()}else{t=JSON.stringify(e)}for(var n=0;n<t.length;n++){if(t.charCodeAt(n)<=255){o++}else{o+=2}}return o};return e}(puremvc.Notifier);o.UrlDownloadLimiter=C;var A=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.$doLoad=function(){this.$loadAssets([this.$url])};t.prototype.$onAssetsLoaded=function(e){this.$onComplete(e)};return t}(r);o.UrlLoader=A;var M=function(n){__extends(e,n);function e(e,t){var o=n.call(this)||this;o.$url=null;o.$limiter=null;o.$complete=null;o.$loading=false;o.$url=e;o.$complete=t;o.facade.sendNotification(G.ON_URL_SAFETY_LOADER_CREATED,o);return o}e.prototype.load=function(){if(this.$loading===false&&this.$destroyed===false){this.$loading=true;V.lock(this.$url);if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.trace(suncom.DebugMode.ANY,"load "+this.$url)}if(F.isRes3dUrl(this.$url)===false||F.getRes3dJsonUrl(this.$url)===this.$url){Laya.loader.load(this.$url,Laya.Handler.create(this,this.$onComplete))}else{Laya.loader.create(this.$url,Laya.Handler.create(this,this.$onComplete))}if(x.downloadSpeed!==t.NONE){this.$limiter=new C(this.$url,suncom.Handler.create(this,this.$onDownloaded))}}};e.prototype.$onComplete=function(e){if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.trace(suncom.DebugMode.ANY,"load "+this.$url+" complete")}if(this.$limiter===null){if(this.$destroyed===false){this.$destroyed=true;this.$complete.runWith([e===null?false:true,this.$url])}this.facade.sendNotification(G.ON_URL_SAFETY_LOADER_COMPLETE,this);V.unlock(this.$url);this.$loading=false}else{this.$limiter.updateDownloadSize(e)}};e.prototype.$onDownloaded=function(e){this.$limiter=null;this.$onComplete(e)};Object.defineProperty(e.prototype,"url",{get:function(){return this.$url},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"destroyed",{get:function(){return this.$destroyed},enumerable:false,configurable:true});return e}(puremvc.Notifier);o.UrlSafetyLoader=M;var P=function(n){__extends(e,n);function e(e,t){var o=n.call(this)||this;o.$closedHandler=null;o.$removedHandler=null;o.$popup=e||null;o.$caller=t||null;if(x.viewLayer.getInfoByView(e)===null){throw Error("找不到"+e.name+"的弹出信息，请确认其为弹出对象")}o.facade.registerObserver(G.ON_POPUP_CLOSED,o.$onPopupClosed,o,false,suncom.EventPriorityEnum.FWL);o.facade.registerObserver(G.ON_POPUP_REMOVED,o.$onPopupRemoved,o,false,suncom.EventPriorityEnum.FWL);if(x.viewLayer.getInfoByView(t)!==null){o.facade.registerObserver(G.ON_POPUP_REMOVED,o.$onCallerDestroy,o,false,suncom.EventPriorityEnum.FWL)}else{o.facade.registerObserver(G.ON_CALLER_DESTROYED,o.$onCallerDestroy,o,false,suncom.EventPriorityEnum.FWL)}o.facade.registerObserver(G.LEAVE_SCENE,o.$onLeaveScene,o,false,suncom.EventPriorityEnum.OSL);return o}e.prototype.$onLeaveScene=function(){this.facade.removeObserver(G.ON_POPUP_CLOSED,this.$onPopupClosed,this);this.facade.removeObserver(G.ON_POPUP_REMOVED,this.$onPopupRemoved,this);this.facade.removeObserver(G.LEAVE_SCENE,this.$onCallerDestroy,this);this.facade.removeObserver(G.ON_POPUP_REMOVED,this.$onCallerDestroy,this);this.facade.removeObserver(G.ON_CALLER_DESTROYED,this.$onCallerDestroy,this)};e.prototype.$onCallerDestroy=function(e){if(e===this.$caller){this.$onLeaveScene()}};e.prototype.$onPopupClosed=function(e){if(e===this.$popup){if(this.$closedHandler!==null){this.$closedHandler.run();this.$closedHandler=null}}};e.prototype.$onPopupRemoved=function(e){if(e===this.$popup){if(this.$removedHandler!==null){this.$removedHandler.run();this.$removedHandler=null}this.$onCallerDestroy(this.$caller)}};e.prototype.onPopupClosed=function(e,t,o){if(this.$caller!==t){throw Error("caller与执行者不一致")}if(this.$closedHandler===null){this.$closedHandler=suncom.Handler.create(t,e,o)}else{throw Error("重复注册弹框关闭事件")}return this};e.prototype.onPopupRemoved=function(e,t,o){if(this.$caller!==t){throw Error("caller与执行者不一致")}if(this.$removedHandler===null){this.$removedHandler=suncom.Handler.create(t,e,o)}else{throw Error("重复注册弹框移除事件")}return this};return e}(puremvc.Notifier);o.ViewContact=P;var b=function(n){__extends(e,n);function e(e,t){var o=n.call(this)||this;o.$info=null;o.$view=e;if(o.info!==null){o.$duration=o.info.duration}else if(t===void 0){o.$duration=200}else{o.$duration=t}return o}e.prototype.popup=function(e){if(e===void 0){e={}}this.facade.sendNotification(G.SHOW_POPUP,[this.$view,this.$duration,e]);return this};e.prototype.close=function(e){this.facade.sendNotification(G.CLOSE_POPUP,[this.$view,this.$duration,e])};Object.defineProperty(e.prototype,"cancelAllowed",{get:function(){return this.info.cancelAllowed},set:function(e){this.info.cancelAllowed=e},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"info",{get:function(){if(this.$info===null){this.$info=x.viewLayer.getInfoByView(this.$view)}return this.$info},enumerable:false,configurable:true});return e}(puremvc.Notifier);o.ViewFacade=b;var I=function(t){__extends(e,t);function e(){var e=t.call(this)||this;e.$stack=[];e.facade.registerObserver(G.UNLOAD_SCENE,e.$onUnloadScene,e,false,suncom.EventPriorityEnum.EGL);return e}e.prototype.$onUnloadScene=function(){var e=this.$stack.concat();for(var t=e.length-1;t>-1;t--){var o=e[t];if(o.props.mod!==suncore.ModuleEnum.SYSTEM){this.removeStackInfo(o)}}};e.prototype.getInfoByView=function(e){for(var t=0;t<this.$stack.length;t++){var o=this.$stack[t];if(o.view===e){return o}}return null};e.prototype.addToStack=function(e){this.$stack.push(e)};e.prototype.removeStackInfo=function(e){var t=this.$stack.indexOf(e);if(t<0){return}this.$stack.splice(t,1);this.onViewRemove(e.view);this.removeChild(e.view);this.removeChild(e.mask);if(e.keepNode===false){this.destroyView(e.view);this.destroyMask(e.mask)}this.facade.sendNotification(G.ON_POPUP_REMOVED,e.view)};e.prototype.removeStackInfoByView=function(e){for(var t=0;t<this.$stack.length;t++){var o=this.$stack[t];if(o.view===e){this.removeStackInfo(o);break}}};return e}(puremvc.Notifier);o.ViewLayer=I;var D=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.addChild=function(e){var t=e;if(x.sceneLayer.scene2d===null||e.zOrder>=o.UILevel.LOADING){Laya.stage.addChild(t)}else{x.sceneLayer.scene2d.addChild(t)}};t.prototype.removeChild=function(e){var t=e;var o=t.parent||null;if(o===null){throw Error("无法移除显示对象，因为父节点不存在 "+t.name)}o.removeChild(t)};t.prototype.createMask=function(e,t){var o=new Laya.Image("common/mask_b.png");o.left=o.right=o.top=o.bottom=0;o.sizeGrid="1,1,1,1";if(t.flags&l.TRANSPARENT){o.alpha=0}else{o.alpha=1}if((t.flags&l.MOUSE_THROUGH)===l.NONE){o.mouseThrough=false;o.on(Laya.Event.CLICK,this,this.$onMaskClick,[e])}return o};t.prototype.$onMaskClick=function(e){var t=x.viewLayer.getInfoByView(e);if(t!==null&&t.closed===false&&t.cancelAllowed===true){new b(e).close()}};t.prototype.destroyMask=function(e){e.off(Laya.Event.CLICK,this,this.$onMaskClick);e.destroy()};t.prototype.destroyView=function(e){var t=e;t.destroy()};return t}(I);o.ViewLayerLaya=D;var w=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.onViewCreate=function(e,t){var o=e;if(o.$onCreate){if(t instanceof Array===false){o.$onCreate.call(o,t)}else{o.$onCreate.apply(o,t)}}};t.prototype.onViewOpen=function(e){var t=e;if(t.$onOpen){t.$onOpen.call(t)}};t.prototype.onViewClose=function(e){var t=e;if(t.$onClose){t.$onClose.call(t)}};t.prototype.onViewRemove=function(e){var t=e;if(t.$onRemove){t.$onRemove.call(t)}};return t}(D);o.ViewLayerLaya2D=w;var U=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.onViewCreate=function(e,t){var o=e.getComponents(Laya.Component)||[];for(var n=0;n<o.length;n++){var r=o[n];if(r.$onCreate){if(t instanceof Array===false){r.$onCreate.call(r,t)}else{r.$onCreate.apply(r,t)}}}};t.prototype.onViewOpen=function(e){var t=e.getComponents(Laya.Component)||[];for(var o=0;o<t.length;o++){var n=t[o];if(n.$onOpen){n.$onOpen.call(n)}}};t.prototype.onViewClose=function(e){var t=e.getComponents(Laya.Component)||[];for(var o=0;o<t.length;o++){var n=t[o];if(n.$onClose){n.$onClose.call(n)}}};t.prototype.onViewRemove=function(e){var t=e.getComponents(Laya.Component)||[];for(var o=0;o<t.length;o++){var n=t[o];if(n.$onRemove){n.$onRemove.call(n)}}};return t}(D);o.ViewLayerLaya3D=U;var k=function(r){__extends(e,r);function e(e,t,o){var n=r.call(this,e,t)||this;n.$dataList=[];n.$running=false;n.$dependencies=o;suncom.Test.expect(o.length).toBeGreaterThan(0);n.facade.registerObserver(G.ON_INTERCEPTOR_RELIEVED,n.$onInterceptorRelieved,n);return n}e.prototype.destroy=function(){if(this.$destroyed===true){return}r.prototype.destroy.call(this);this.facade.removeObserver(G.ON_INTERCEPTOR_RELIEVED,this.$onInterceptorRelieved,this)};e.prototype.run=function(){suncom.Test.expect(this.$running).toBe(false);for(var e=0;e<this.$dependencies.length;e++){this.$dependencies[e].active=true}this.$running=true};e.prototype.$onInterceptorRelieved=function(e){if(this.$relieved===true){return}if(this.$dependencies.indexOf(e)<0){return}this.facade.notifyCancel();var t=true;for(var o=0;o<this.$dependencies.length;o++){if(this.$dependencies[o].relieved===false){t=false;break}}if(t===true){var n=suncom.Handler.create(this,this.$onCommandRelieved);suncore.System.addMessage(suncore.ModuleEnum.TIMELINE,suncore.MessagePriorityEnum.PRIORITY_0,n)}};e.prototype.$onCommandRelieved=function(){if(this.$destroyed===false&&this.$relieved===false){this.$relieved=true;this.facade.sendNotification(G.NEXT_LOGIC_COMMAND,this,true);for(var e=0;e<this.$dataList.length;e++){this.facade.sendNotification(this.$command,this.$dataList[e])}}};e.prototype.$onCommandCallback=function(){if(this.$relieved===true){return}var e=[];for(var t=0;t<arguments.length;t++){e.push(arguments[t])}if(this.$condition.runWith(e)===false){return}this.$relieved=true;for(var t=0;t<this.$dependencies.length;t++){if(this.$dependencies[t].relieved===false){this.$relieved=false;break}}if(this.$relieved===false){this.$dataList.push(e);this.facade.notifyCancel()}};Object.defineProperty(e.prototype,"running",{get:function(){return this.$running},enumerable:false,configurable:true});return e}(a);o.GUILogicCommand=k;var Y=function(t){__extends(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.$active=false;return e}e.prototype.$onCommandCallback=function(){if(this.$active===true&&this.$relieved===false){var e=[];for(var t=0;t<arguments.length;t++){e.push(arguments[t])}if(this.$condition.runWith(e)===true){this.$relieved=true;this.facade.sendNotification(G.ON_INTERCEPTOR_RELIEVED,this,true)}}};Object.defineProperty(e.prototype,"active",{get:function(){return this.$active},set:function(e){this.$active=e},enumerable:false,configurable:true});return e}(a);o.GUILogicDependence=Y;var x;(function(e){e.downloadSpeed=t.NONE;e.cacheMap={};e.templets={};e.references={};e.downloadLimiters=[]})(x=o.M||(o.M={}));var G;(function(e){e.RETRY_CONFIRM="sunui.NotifyKey.RETRY_CONFIRM";e.REGISTER_SCENES="sunui.NotifyKey.REGISTER_SCENES";e.BEFORE_LOAD_SCENE="sunui.NotifyKey.BEFORE_LOAD_SCENE";e.LOAD_SCENE="sunui.NotifyKey.LOAD_SCENE";e.UNLOAD_SCENE="sunui.NotifyKey.UNLOAD_SCENE";e.ENTER_SCENE="sunui.NotifyKey.ENTER_SCENE";e.EXIT_SCENE="sunui.NotifyKey.EXIT_SCENE";e.LEAVE_SCENE="sunui.NotifyKey.LEAVE_SCENE";e.SHOW_POPUP="sunui.NotifyKey.SHOW_POPUP";e.CLOSE_POPUP="sunui.NotifyKey.CLOSE_POPUP";e.ON_POPUP_CLOSED="sunui.NotifyKey.ON_POPUP_CLOSED";e.ON_POPUP_REMOVED="sunui.NotifyKey.ON_POPUP_REMOVED";e.ON_CALLER_DESTROYED="sunui.NotifyKey.ON_CALLER_DESTROYED";e.ON_ASSET_SAFETY_LOADER_FAILED="sunui.NotifyKey.ON_ASSET_SAFETY_LOADER_FAILED";e.ON_URL_SAFETY_LOADER_CREATED="sunui.NotifyKey.ON_URL_SAFETY_LOADER_CREATED";e.ON_URL_SAFETY_LOADER_COMPLETE="sunui.NotifyKey.ON_URL_SAFETY_LOADER_COMPLETE";e.ASSET_SAFETY_LOADER_RETRY="sunui.NotifyKey.ASSET_SAFETY_LOADER_RETRY";e.REGISTER_TWEEN_OBJECT="sunui.NotifyKey.REGISTER_TWEEN_OBJECT";e.NEXT_LOGIC_COMMAND="sunui.NotifyKey.NEXT_LOGIC_COMMAND";e.ON_INTERCEPTOR_RELIEVED="sunui.NotifyKey.ON_INTERCEPTOR_RELIEVED";e.DESTROY_LOGIC_RUNNABLE="sunui.NotifyKey.DESTROY_LOGIC_RUNNABLE";e.DESTROY_ALL_LOGIC_RUNNABLE="sunui.NotifyKey.DESTROY_ALL_LOGIC_RUNNABLE"})(G=o.NotifyKey||(o.NotifyKey={}));var F;(function(i){i.res3dRoot=null;function e(e){x.downloadSpeed=e}i.setDownloadSpeed=e;function t(e){if(suncom.Global.debugMode&suncom.DebugMode.ENGINE){if(i.isRes3dUrl(e)===true&&i.getRes3dJsonUrl(e)===e){return}}var t=suncom.Common.getFileExtension(e);var o=e.substr(0,e.length-t.length);var n=[e];if(t==="sk"||t==="atlas"){n.push(o+"png")}else if(i.isRes3dUrl(e)===true){n.push(o+"json")}for(var r=0;r<n.length;r++){V.lock(n[r])}}i.lock=t;function o(e){if(suncom.Global.debugMode&suncom.DebugMode.ENGINE){if(i.isRes3dUrl(e)===true&&i.getRes3dJsonUrl(e)===e){return}}var t=suncom.Common.getFileExtension(e);var o=e.substr(0,e.length-t.length);var n=[e];if(t==="sk"||t==="atlas"){n.push(o+"png")}else if(i.isRes3dUrl(e)===true){n.push(o+"json")}for(var r=0;r<n.length;r++){V.unlock(n[r])}}i.unlock=o;function n(e,t,o){var n=null;if(t===null){n=suncom.Handler.create(null,function(e){})}else{n=suncom.Handler.create(o,t)}var r=suncom.Common.createHashId();x.templets[r]=new N(r,e,n);return r}i.prepare=n;function r(e){var t=x.templets[e]||null;if(t!==null){delete x.templets[e];t.destroy()}return 0}i.release=r;function s(e,t){var o=x.cacheMap[e]||null;if(suncom.Common.getFileExtension(e)==="sk"){return o.buildArmature(t)}else if(i.isRes3dUrl(e)===true){if(o===null){o=x.cacheMap[e]=Laya.loader.getRes(e)}return Laya.Sprite3D.instantiate(o)}else{return Laya.loader.getRes(e)}}i.createSync=s;function a(e){return i.createSync(i.getRes3dUrlByName(e))}i.createRes3dSync=a;function u(e){var t=new Laya.Prefab;t.json=Laya.loader.getRes(e);return t.create()}i.createPrefab=u;function l(e){V.clearResByUrl(e)}i.clearResByUrl=l;function c(e){if(i.res3dRoot===null){throw Error("请先指定3D资源目录：sunui.Resource.res3dRoot=")}return i.res3dRoot+"/LayaScene_"+e+"/Conventional/"}i.getRes3dPackRoot=c;function d(e){return e.indexOf(i.res3dRoot)===0}i.isRes3dUrl=d;function f(e){return suncom.Common.replacePathExtension(e,"json")}i.getRes3dJsonUrl=f;function h(e){if(suncom.Common.getFileExtension(e)===null){e+=".lh"}return i.getRes3dPackRoot(suncom.Common.getFileName(e))+e}i.getRes3dUrlByName=h;function p(e){var t=[];var o=i.getRes3dPackRoot(e.pack);for(var n=0;n<e.files.length;n++){t.push(o+e.files[n])}for(var n=0;n<e.resources.length;n++){t.push(o+e.resources[n])}return t}i.getAssetUrlsByRes3dJson=p;function m(e){i.removeUnnecessaryResources(e,"sk","png","龙骨预加载无需指定PNG资源");i.removeUnnecessaryResources(e,"atlas","png","图集预加载无需指定PNG资源");return i.removeDuplicateResources(e)}i.checkLoadList=m;function $(e){if(suncom.Global.debugMode&suncom.DebugMode.ENGINE){var t=[];for(var o=0;o<e.length;o++){var n=e[o];if(t.indexOf(n)===-1){t.push(n)}else{suncom.Logger.error(suncom.DebugMode.ANY,"重复的预加载资源文件 "+n)}}return t}return e}i.removeDuplicateResources=$;function y(e,t,o,n){if(suncom.Global.debugMode&suncom.DebugMode.ENGINE){var r=[];for(var i=0;i<e.length;i++){var s=e[i];if(suncom.Common.getFileExtension(s)===t){r.push(s)}}for(var i=0;i<r.length;i++){var s=r[i];var a=s.substring(0,s.length-t.length)+o;do{var u=e.indexOf(a);if(u===-1){break}e.splice(u,1);suncom.Logger.error(suncom.DebugMode.ANY,n+" "+s)}while(true)}}}i.removeUnnecessaryResources=y})(F=o.Resource||(o.Resource={}));var H;(function(e){var n=[];function o(e){for(var t=n.length-1;t>-1;t--){if(n[t].name===e){return t}}return-1}function t(e,t){var o={name:e,data:t};n.push(o)}e.addHistory=t;function r(e){var t=o(e);if(t>-1){n.splice(t,1)}return t>-1}e.removeHistory=r;function i(e){return o(e)>-1}e.hasHistory=i;function s(){if(n.length>0){return n[n.length-1]}return null}e.getLastestSceneInfo=s;function a(e){var t=o(e);if(t>-1){return n[t]}return null}e.getLastestSceneInfoByName=a;function u(e){while(n.length>1&&e>0){n.pop();e--}}e.deleteHistories=u})(H=o.SceneHeap||(o.SceneHeap={}));var B;(function(e){var n=[];function t(e){for(var t=0;t<n.length;t++){if(n[t].name===e.name){throw Error("重复注册场景")}}n.push(e)}e.regScene=t;function o(e){for(var t=0;t<n.length;t++){var o=n[t];if(o.name===e){return o}}throw Error("场景配置不存在")}e.getConfigByName=o})(B=o.SceneManager||(o.SceneManager={}));var V;(function(n){function e(e){var t=x.references[e]||0;if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.trace(suncom.DebugMode.ANY,"reference:"+t+", lock:"+e)}x.references[e]=t+1}n.lock=e;function t(e){var t=x.references[e]||0;if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.trace(suncom.DebugMode.ANY,"reference:"+t+", unlock:"+e)}suncom.Test.expect(t).interpret("尝试解锁不存在的资源 url："+e).toBeGreaterThan(0);if(t>1){x.references[e]=t-1}else{delete x.references[e];r(e)}}n.unlock=t;function o(e){if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.trace(suncom.DebugMode.ANY,"clearResUrl:"+e)}var t=x.cacheMap[e]||null;if(t!==null){t.dispose&&t.dispose();t.destroy&&t.destroy();delete x.cacheMap[e]}var o=Laya.loader.getRes(e)||null;if(o===null){Laya.loader.cancelLoadByUrl(e)}else{o.dispose&&o.dispose();o.destroy&&o.destroy();Laya.loader.clearRes(e)}var n=suncom.Common.getFileExtension(e);if(n==="ani"){Laya.Animation.clearCache(e)}else if(n==="sk"){Laya.Templet.TEMPLET_DICTIONARY[e]&&Laya.Templet.TEMPLET_DICTIONARY[e].destroy();delete Laya.Templet.TEMPLET_DICTIONARY[e]}}n.clearResByUrl=o;function r(e){if(F.isRes3dUrl(e)===true&&F.getRes3dJsonUrl(e)===e){var t=F.getAssetUrlsByRes3dJson(Laya.loader.getRes(e));for(var o=0;o<t.length;o++){n.clearResByUrl(t[o])}}n.clearResByUrl(e)}})(V=o.UrlLocker||(o.UrlLocker={}));function K(e,t){var o=e.split("/");while(t!=null&&o.length>0){var n=o.shift();t=t.getChildByName(n)}return t}o.find=K})(sunui||(sunui={}));