var __extends=this&&this.__extends||function(){var o=function(e,t){o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r))e[r]=t[r]};return o(e,t)};return function(e,t){o(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}();var sunui;(function(r){var n;(function(e){e[e["NONE"]=0]="NONE";e[e["YES"]=1]="YES";e[e["NO"]=2]="NO";e[e["CANCEL"]=3]="CANCEL"})(n=r.ConfirmOptionValueEnum||(r.ConfirmOptionValueEnum={}));var f;(function(e){e[e["NONE"]=0]="NONE";e[e["SIMPLY"]=1]="SIMPLY";e[e["TRANSPARENT"]=2]="TRANSPARENT";e[e["MOUSE_THROUGH"]=4]="MOUSE_THROUGH";e[e["SYNC_FADE_TIME"]=8]="SYNC_FADE_TIME"})(f=r.PopupFlagEnum||(r.PopupFlagEnum={}));var o;(function(e){e[e["NORMAL"]=0]="NORMAL";e[e["SMALL"]=1]="SMALL";e[e["MIDDLE"]=2]="MIDDLE";e[e["LARGE"]=3]="LARGE"})(o=r.PopupWinSizeEnum||(r.PopupWinSizeEnum={}));var i;(function(e){e[e["NONE"]=0]="NONE";e[e["HIGH"]=131072]="HIGH";e[e["MID"]=32768]="MID";e[e["LOW"]=8192]="LOW"})(i=r.ResourceDownloadSpeedEnum||(r.ResourceDownloadSpeedEnum={}));var a;(function(e){e[e["AUTO"]=16]="AUTO";e[e["CONFIRM"]=32]="CONFIRM";e[e["TERMINATE"]=64]="TERMINATE"})(a=r.RetryMethodEnum||(r.RetryMethodEnum={}));var d;(function(e){e[e["NONE"]=0]="NONE";e[e["BACKGROUND"]=1]="BACKGROUND";e[e["SCENE"]=2]="SCENE";e[e["PANEL"]=3]="PANEL";e[e["FLOAT"]=4]="FLOAT";e[e["GOLD_TIPS"]=5]="GOLD_TIPS";e[e["HIGH_GOLD_TIPS"]=6]="HIGH_GOLD_TIPS";e[e["NOTICE"]=7]="NOTICE";e[e["BIGWINNER"]=8]="BIGWINNER";e[e["MINI_GAME"]=9]="MINI_GAME";e[e["POPUP"]=10]="POPUP";e[e["WAITINGBOX"]=11]="WAITINGBOX";e[e["LOADING"]=12]="LOADING";e[e["LAMP_TIPS"]=13]="LAMP_TIPS";e[e["TIPS"]=14]="TIPS";e[e["TOP"]=15]="TOP";e[e["DEBUG"]=16]="DEBUG"})(d=r.UILevel||(r.UILevel={}));var e=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.$makeProps=function(e,t){if(t.x===void 0&&t.left===void 0&&t.right===void 0&&t.centerX===void 0){t.centerX=0}if(t.y===void 0&&t.top===void 0&&t.bottom===void 0&&t.centerY===void 0){switch(e.winSize){case o.LARGE:t.y=70;break;case o.MIDDLE:t.y=219;break;case o.SMALL:t.y=299;break;default:t.centerY=0;break}}};t.prototype.$applyShowProps=function(e,t,r){if(t.x!==void 0){e.x=t.x}if(t.y!==void 0){e.y=t.y}if(t.centerX!==void 0){e.centerX=t.centerX}if(t.centerY!==void 0){e.centerY=t.centerY}if(e instanceof fairygui.GComponent){t.centerX!==void 0&&this.$setProp(e,"centerX");t.centerY!==void 0&&this.$setProp(e,"centerY")}if(r===0||(t.flags&f.SIMPLY)===f.SIMPLY){if(t.left!==void 0){e.left=t.left}if(t.right!==void 0){e.right=t.right}if(t.top!==void 0){e.top=t.top}if(t.bottom!==void 0){e.bottom=t.bottom}if(t.scaleX!==void 0){e.scaleX=t.scaleX}if(t.scaleY!==void 0){e.scaleY=t.scaleY}if(e instanceof fairygui.GComponent){t.left!==void 0&&this.$setProp(e,"left");t.right!==void 0&&this.$setProp(e,"right");t.top!==void 0&&this.$setProp(e,"top");t.bottom!==void 0&&this.$setProp(e,"bottom")}}else{if(t.left!==void 0){e.left=-e.width}if(t.right!==void 0){e.right=-e.width}if(t.top!==void 0){e.top=-e.height}if(t.bottom!==void 0){e.bottom=-e.height}if(t.left===void 0&&t.right===void 0&&t.top===void 0&&t.bottom===void 0){e.alpha=0;e.scaleX=0;e.scaleY=0;t.alpha=1;if(t.scaleX===void 0){t.scaleX=1}if(t.scaleY===void 0){t.scaleY=1}}var o=suncom.Common.copy(t);if(e instanceof fairygui.GComponent){o.update=suncom.Handler.create(this,this.$applyProps,[e,o],false)}var n=t.autoDestroy===true?suncore.ModuleEnum.CUSTOM:suncore.ModuleEnum.SYSTEM;R.get(e,n).to(o,r,t.ease)}};t.prototype.$applyCloseProps=function(e,t,r){if(r>0&&(t.flags&f.SIMPLY)===f.NONE){if(t.left!==void 0){t.left=-e.width}if(t.right!==void 0){t.right=-e.width}if(t.top!==void 0){t.top=-e.height}if(t.bottom!==void 0){t.bottom=-e.height}if(t.left===void 0&&t.right===void 0&&t.top===void 0&&t.bottom===void 0){t.alpha=0;t.scaleX=0;t.scaleY=0}var o=suncom.Common.copy(t);if(e instanceof fairygui.GComponent){o.update=suncom.Handler.create(this,this.$applyProps,[e,o],false)}var n=t.autoDestroy===true?suncore.ModuleEnum.CUSTOM:suncore.ModuleEnum.SYSTEM;R.get(e,n).to(o,r)}};t.prototype.$applyProps=function(e,t){var r=["x","y","left","right","top","bottom","scaleX","scaleY","alpha","centerX","centerY"];for(var o=r.length-1;o>-1;o--){var n=r[o];if(t[n]===void 0){r.splice(o,1)}}for(var i=0,s=r;i<s.length;i++){var n=s[i];this.$setProp(e,n)}};t.prototype.$setProp=function(e,t){switch(t){case"left":e.x=e.left;break;case"right":e.x=suncom.Global.width-e.right;break;case"top":e.y=e.top;break;case"bottom":e.y=suncom.Global.height-e.bottom;break;case"centerX":e.x=(suncom.Global.width-e.width*e.scaleX)*.5+e.centerX;break;case"centerY":e.y=(suncom.Global.height-e.height*e.scaleY)*.5+e.centerY;break}};return t}(puremvc.SimpleCommand);r.AbstractPopupCommand=e;var t=function(o){__extends(e,o);function e(e,t){var r=o.call(this)||this;r.$info=null;r.$info=e;r.$data=t;return r}return e}(suncore.AbstractTask);r.AbstractSceneTask=t;var s=function(o){__extends(e,o);function e(e,t){var r=o.call(this)||this;r.$complete=null;r.$url=null;r.$loaders=[];r.$doneCount=0;r.$url=e;r.$complete=t;return r}e.prototype.destroy=function(){if(this.$destroyed===true){return}o.prototype.destroy.call(this);for(var e=0;e<this.$loaders.length;e++){this.$loaders[e].destroy()}};e.prototype.load=function(){if(this.$destroyed===false){this.$doLoad()}};e.prototype.$loadAssets=function(e){this.$doneCount=this.$loaders.length;for(var t=0;t<e.length;t++){this.$loaders.push(new P(e[t],suncom.Handler.create(this,this.$onLoadAsset)))}};e.prototype.$onLoadAsset=function(e){if(e===false){this.$onAssetsLoaded(false)}else{this.$doneCount++;if(this.$doneCount===this.$loaders.length){this.$onAssetsLoaded(true)}}};e.prototype.$onComplete=function(e){if(this.$destroyed===false){this.$complete.runWith(e)}this.destroy()};Object.defineProperty(e.prototype,"progress",{get:function(){var e=0;for(var t=0;t<this.$loaders.length;t++){e+=this.$loaders[t].progress}return e/this.$loaders.length},enumerable:false,configurable:true});return e}(puremvc.Notifier);r.AssetLoader=s;var u=function(o){__extends(e,o);function e(e,t){var r=o.call(this)||this;r.$url=null;r.$complete=null;r.$loader=null;r.$retryer=new v(a.TERMINATE,suncom.Handler.create(r,r.$onRetryConfirmed),"资源加载失败！");V.lock(e);r.$url=e;r.$complete=t;r.$doLoad();return r}e.prototype.$doLoad=function(){var e=suncom.Handler.create(this,this.$onLoad);if(V.isFGuiUrl(this.$url)===true){this.$loader=new c(this.$url,e)}else if(V.isRes3dUrl(this.$url)===true){this.$loader=new m(this.$url,e)}else if(suncom.Common.getFileExtension(this.$url)==="sk"){this.$loader=new N(this.$url,e)}else{this.$loader=new A(this.$url,e)}this.$loader.load()};e.prototype.$onLoad=function(e){if(e===true){this.$complete.runWith(this.$url)}else{this.$retryer.run(1e3,suncom.Handler.create(this,this.$doLoad),2)}};e.prototype.destroy=function(){if(this.$destroyed===true){return}o.prototype.destroy.call(this);this.facade.removeObserver(H.ASSET_SAFETY_LOADER_RETRY,this.$onAssetSafetyLoaderRetry,this);this.$loader.destroy();this.$retryer.cancel();V.unlock(this.$url)};e.prototype.$onRetryConfirmed=function(e){if(e===n.NO){this.$retryer.reset();suncom.Logger.warn(suncom.DebugMode.ANY,"失败："+this.$url);this.facade.sendNotification(H.ON_ASSET_SAFETY_LOADER_FAILED);this.facade.registerObserver(H.ASSET_SAFETY_LOADER_RETRY,this.$onAssetSafetyLoaderRetry,this,true)}else{this.facade.sendNotification(suncore.NotifyKey.SHUTDOWN)}};e.prototype.$onAssetSafetyLoaderRetry=function(){if(this.$destroyed===false){suncom.Logger.warn(suncom.DebugMode.ANY,"重试："+this.$url);this.$doLoad()}};Object.defineProperty(e.prototype,"progress",{get:function(){return this.$loader.progress},enumerable:false,configurable:true});return e}(puremvc.Notifier);r.AssetSafetyLoader=u;var l=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e,t,r){var o=x.viewLayer.getInfoByView(e);if(o===null){suncom.Logger.error(suncom.DebugMode.ANY,e+"["+(e&&e.name)+"]'s infomation is not exist.");return}if(r!==void 0){o.keepNode=!r}if(o.closed===true){return}o.closed=true;x.viewLayer.onViewClose(e);var n=o.autoDestroy===true?suncore.ModuleEnum.CUSTOM:suncore.ModuleEnum.SYSTEM;if((o.props.flags&f.TRANSPARENT)===f.NONE){var i=R.get(o.mask,n);if(t>200&&(o.props.flags&f.SYNC_FADE_TIME)===f.NONE){i.wait(t-200).to({alpha:0},200)}else{i.to({alpha:0},t)}}this.$applyCloseProps(e,o.props,t);suncore.System.addTimer(n,t,this.$onCloseFinish,this,[o,e])};t.prototype.$onCloseFinish=function(e){x.viewLayer.removeInfoByView(e)};return t}(e);r.ClosePopupCommand=l;var c=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.$doLoad=function(){this.$loadAssets([this.$url])};t.prototype.$onAssetsLoaded=function(e){this.$onComplete(e)};return t}(s);r.FGuiLoader=c;var h=function(t){__extends(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.$undoList=[];e.$isRetryPrompting=false;e.$loadingMap={};return e}e.prototype.$onRun=function(){this.facade.registerObserver(H.ON_URL_SAFETY_LOADER_CREATED,this.$onUrlSafetyLoaderCreated,this);this.facade.registerObserver(H.ON_URL_SAFETY_LOADER_COMPLETE,this.$onUrlSafetyLoaderComplete,this);this.facade.registerObserver(H.ON_ASSET_SAFETY_LOADER_FAILED,this.$onAssetSafetyLoaderFailed,this)};e.prototype.$onStop=function(){this.facade.removeObserver(H.ON_URL_SAFETY_LOADER_CREATED,this.$onUrlSafetyLoaderCreated,this);this.facade.removeObserver(H.ON_URL_SAFETY_LOADER_COMPLETE,this.$onUrlSafetyLoaderComplete,this);this.facade.removeObserver(H.ON_ASSET_SAFETY_LOADER_FAILED,this.$onAssetSafetyLoaderFailed,this)};e.prototype.$onUrlSafetyLoaderCreated=function(e){this.$undoList.unshift(e);if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.log(suncom.DebugMode.ANY,"create loader for url "+e.url+", loading list length:"+x.loaders.length+", undo list length:"+this.$undoList.length)}this.$next()};e.prototype.$onUrlSafetyLoaderComplete=function(e){var t=x.loaders.indexOf(e);suncom.Test.expect(t).toBeGreaterOrEqualThan(0);x.loaders.splice(t,1);delete this.$loadingMap[e.url];if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.log(suncom.DebugMode.ANY,"remove loader for url "+e.url+", loading list length:"+x.loaders.length+", undo list length:"+this.$undoList.length)}this.$next()};e.prototype.$next=function(){while(this.$undoList.length>0&&x.loaders.length<Laya.loader.maxLoader){var e=false;for(var t=this.$undoList.length-1;t>-1;t--){var r=this.$undoList[t];var o=r.url;if(this.$loadingMap[o]===true){continue}this.$undoList.splice(t,1);if(r.destroyed===true){continue}this.$loadingMap[o]=true;e=true;x.loaders.push(r);if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.log(suncom.DebugMode.ANY,"load next url "+r.url+", loading list length:"+x.loaders.length)}r.load();break}if(e===false){break}}};e.prototype.$onAssetSafetyLoaderFailed=function(){if(this.$isRetryPrompting===false){this.$isRetryPrompting=true;this.facade.sendNotification(H.RETRY_CONFIRM,[suncore.ModuleEnum.SYSTEM,"资源加载失败，点击确定重新尝试！",[n.YES,"确定",n.NO,"取消"],suncom.Handler.create(this,this.$onRetryConfirmed)])}};e.prototype.$onRetryConfirmed=function(e){if(e===n.YES){this.facade.sendNotification(H.ASSET_SAFETY_LOADER_RETRY)}else{this.facade.sendNotification(suncore.NotifyKey.SHUTDOWN)}this.$isRetryPrompting=false};return e}(suncore.BaseService);r.LoadingService=h;var p=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e){for(var t=0;t<e.length;t++){var r=e[t];j.regScene(r)}};return t}(puremvc.SimpleCommand);r.RegisterScenesCommand=p;var m=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.$doLoad=function(){var e=V.getRes3dJsonUrl(this.$url);var t=Laya.loader.getRes(this.$url)?true:false;if(suncom.Common.getFileExtension(this.$url)==="ls"||t===true){this.$loadAssets([e])}else{this.$loaders.push(new P(e,suncom.Handler.create(this,this.$onUrlLoaded)))}};t.prototype.$onUrlLoaded=function(e,t){if(e===true){var r=x.cacheMap[this.$url]||null;if(r===null){this.$loadAssets([this.$url])}else{this.$onAssetsLoaded(true)}}else{this.$onComplete(false)}};t.prototype.$onAssetsLoaded=function(e){if(suncom.Common.getFileExtension(this.$url)==="ls"){this.$onComplete(e)}else{var t=x.cacheMap[this.$url]||null;if(t===null){t=x.cacheMap[this.$url]=Laya.loader.getRes(this.$url)}this.$onComplete(e)}};return t}(s);r.Res3dLoader=m;var v=function(s){__extends(e,s);function e(e,t,r){if(t===void 0){t=null}if(r===void 0){r=null}var o=[];for(var n=3;n<arguments.length;n++){o[n-3]=arguments[n]}var i=s.call(this,suncore.MsgQModEnum.MMI)||this;i.$var_method=a.AUTO;i.$var_confirmHandler=null;i.$var_prompt=null;i.$var_options=[];i.$var_currentRetries=0;i.$var_retryHandler=null;i.$var_retryTimerId=0;i.$var_prompting=false;i.$var_method=e;i.$var_confirmHandler=t;i.$var_prompt=r;i.$var_options=o;return i}e.prototype.run=function(e,t,r){if(r===void 0){r=2}if(this.$var_method===a.AUTO||this.$var_currentRetries<r){if(this.$var_retryTimerId===0){this.$var_retryHandler=t;this.$var_retryTimerId=suncore.System.addTimer(suncore.ModuleEnum.SYSTEM,e,this.$func_onRetryTimer,this)}else{suncom.Logger.warn(suncom.DebugMode.ANY,"己忽略的重试请求 method:"+suncom.Common.getMethodName(t.method,t.caller)+", caller:"+suncom.Common.getQualifiedClassName(t.caller))}}else{if(this.$var_prompting===false){this.$var_prompting=true;if(this.$var_method===a.TERMINATE){suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_0,this,this.$func_onConfirmReplied,[n.NO])}else{var o=suncom.Handler.create(this,this.$func_onConfirmReplied);this.facade.sendNotification(H.RETRY_CONFIRM,[this.$var_prompt,this.$var_options,o])}}else{suncom.Logger.warn(suncom.DebugMode.ANY,"己忽略的重试的询问请求 prompt:"+this.$var_prompt)}}};e.prototype.$func_onConfirmReplied=function(e){if(this.$var_prompting===true){this.$var_prompting=false;if(this.$var_confirmHandler!==null){this.$var_confirmHandler.runWith(e)}}};e.prototype.$func_onRetryTimer=function(){this.$var_retryTimerId=0;this.$var_currentRetries++;this.$var_retryHandler.run()};e.prototype.cancel=function(){this.$var_prompting=false;this.$var_retryTimerId=suncore.System.removeTimer(this.$var_retryTimerId)};e.prototype.reset=function(){this.$var_currentRetries=0};Object.defineProperty(e.prototype,"currentRetries",{get:function(){return this.$var_currentRetries},enumerable:false,configurable:true});return e}(puremvc.Notifier);r.Retryer=v;var y=function(o){__extends(e,o);function e(e,t){var r=o.call(this)||this;r.$var_command=null;r.$var_released=false;r.$var_condition=null;r.$var_command=e;r.$var_condition=t;r.facade.registerObserver(e,r.$func_onCommandCallback,r,false,suncom.EventPriorityEnum.HIGHEST);return r}e.prototype.destroy=function(){if(this.$destroyed===true){return}o.prototype.destroy.call(this);this.facade.removeObserver(this.$var_command,this.$func_onCommandCallback,this)};Object.defineProperty(e.prototype,"var_command",{get:function(){return this.$var_command},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"var_released",{get:function(){return this.$var_released},enumerable:false,configurable:true});return e}(puremvc.Notifier);r.Runnable=y;var $=function(r){__extends(e,r);function e(e){if(e===void 0){e=0}var t=r.call(this)||this;t.$var_timerId=0;t.$var_commands=[];if(e>0){t.$var_timerId=suncore.System.addTimer(suncore.ModuleEnum.TIMELINE,e,t.destroy,t)}t.facade.registerObserver(H.NEXT_COMMAND,t.$func_onNextCommand,t);return t}e.prototype.destroy=function(){if(this.$destroyed===true){return}r.prototype.destroy.call(this);this.$var_timerId>0&&suncore.System.removeTimer(this.$var_timerId);this.facade.removeObserver(H.NEXT_COMMAND,this.$func_onNextCommand,this);for(var e=0;e<this.$var_commands.length;e++){this.$var_commands[e].destroy()}};e.prototype.$func_onNextCommand=function(e){var t=-1;for(var r=0;r<this.$var_commands.length;r++){if(this.$var_commands[r]===e){t=r;break}}if(t===-1){return}t++;this.facade.notifyCancel();if(t<this.$var_commands.length){var o=this.$var_commands[t];if(o.running===false){o.run()}}};e.prototype.$addCommand=function(e,t,r,o){this.$var_commands.push(new F(e,suncom.Handler.create(r,t,void 0,false),o));if(this.$var_commands[0].running===false){this.$var_commands[0].run()}};return e}(puremvc.Notifier);r.Runtime=$;var E=function(o){__extends(e,o);function e(e,t){var r=o.call(this,e,t)||this;r.facade.registerObserver(H.ENTER_SCENE,r.$onEnterScene,r,true,suncom.EventPriorityEnum.EGL);return r}e.prototype.$onEnterScene=function(){};return e}(t);r.SceneIniClass=E;var g=function(t){__extends(e,t);function e(){var e=t.call(this)||this;e.$ready=true;e.$sceneName=0;e.$scene2d=null;e.$scene3d=null;e.$data=null;e.facade.registerObserver(H.ENTER_SCENE,e.$onEnterScene,e,false,suncom.EventPriorityEnum.OSL);return e}e.prototype.$enterScene=function(e,t){var r=j.getConfigByName(e);suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_LAZY,this,this.$beforeLoadScene,[r,t]);suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_LAZY,this,this.$loadScene,[r,t])};e.prototype.$beforeLoadScene=function(e,t){this.$data=t;this.$sceneName=e.name;this.facade.sendNotification(H.BEFORE_LOAD_SCENE);e.iniCls&&suncore.System.addTask(suncore.ModuleEnum.SYSTEM,new e.iniCls(e,t))};e.prototype.$loadScene=function(e,t){this.facade.sendNotification(suncore.NotifyKey.START_TIMELINE,[suncore.ModuleEnum.CUSTOM,true]);e.scene3d=e.scene3d||null;this.facade.sendNotification(H.LOAD_SCENE,[e,t])};e.prototype.$onEnterScene=function(e,t){this.$ready=true;this.$scene2d=e||null;this.$scene3d=t||null;this.facade.sendNotification(H.SCENE_IS_READY,true);this.facade.sendNotification(suncore.NotifyKey.START_TIMELINE,[suncore.ModuleEnum.CUSTOM,false])};e.prototype.$exitScene=function(){this.facade.sendNotification(H.EXIT_SCENE,this.$sceneName);this.facade.sendNotification(suncore.NotifyKey.PAUSE_TIMELINE,[suncore.ModuleEnum.CUSTOM,true]);var e=j.getConfigByName(this.$sceneName);suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_LAZY,this,this.$onLeaveScene,[e])};e.prototype.$onLeaveScene=function(e){e.uniCls&&suncore.System.addTask(suncore.ModuleEnum.SYSTEM,new e.uniCls(e,this.$data));this.facade.sendNotification(H.BEFORE_LEAVE_SCENE);this.facade.sendNotification(H.LEAVE_SCENE);this.facade.sendNotification(H.UNLOAD_SCENE,[this.$scene2d,this.$scene3d]);suncore.System.addTask(suncore.ModuleEnum.SYSTEM,new suncore.SimpleTask(this,this.$onExitScene))};e.prototype.$onExitScene=function(){this.$sceneName=0};e.prototype.enterScene=function(e,t){if(this.$ready===false){return false}this.$ready=false;this.facade.sendNotification(H.SCENE_IS_READY,false);this.$sceneName!=0&&this.$exitScene();this.$enterScene(e,t);K.addHistory(e,t);return true};e.prototype.exitScene=function(){if(this.$ready===false){return}this.$ready=false;this.facade.sendNotification(H.SCENE_IS_READY,false);this.$sceneName!=0&&this.$exitScene();K.removeHistory(this.$sceneName);var e=K.getLastestSceneInfo();e!==null&&this.$enterScene(e.name,e.data)};e.prototype.replaceScene=function(e,t){var r=K.getLastestSceneInfo();if(this.enterScene(e,t)===true){r!==null&&K.removeHistory(r.name)}};e.prototype.deleteHistories=function(e){K.deleteHistories(e)};Object.defineProperty(e.prototype,"ready",{get:function(){return this.$ready},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"scene2d",{get:function(){return this.$scene2d},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"scene3d",{get:function(){return this.$scene3d},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"sceneName",{get:function(){return this.$sceneName},enumerable:false,configurable:true});return e}(puremvc.Notifier);r.SceneLayer=g;var _=function(o){__extends(e,o);function e(e,t){var r=o.call(this,e,t)||this;r.facade.registerObserver(H.LEAVE_SCENE,r.$onLeaveScene,r,true,suncom.EventPriorityEnum.EGL);return r}e.prototype.$onLeaveScene=function(){};return e}(t);r.SceneUniClass=_;var S=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.execute=function(e,t,r){if(x.viewLayer.getInfoByView(e)!==null){suncom.Logger.error(suncom.DebugMode.ANY,e+"["+e.name+"] is already popup.");return}if(r.ease===void 0){r.ease=Laya.Ease.backOut}if(r.flags===void 0){r.flags=f.NONE}if(r.keepNode===void 0){r.keepNode=false}var o=true;if(r.autoDestroy!==void 0){o=r.autoDestroy}else if(e.autoDestroy!==void 0){o=e.autoDestroy}r.autoDestroy=o;var n=r.args;var i=r.level||e.zOrder||d.POPUP;var s=r.keepNode;delete r.args;delete r.level;delete r.keepNode;if(e instanceof fairygui.GComponent&&e.is1920x1080===false){var a=suncom.Global.height/720;e["setScale"](a,a)}if(e instanceof Laya.View){e.pivot(e.width*.5,e.height*.5)}this.$makeProps(e,r);var u=x.viewLayer.createMask(e,r);u.name="Mask$"+e.name;u.zOrder=e.zOrder=i;var l={view:e,mask:u,props:r,closed:false,keepNode:s,displayed:false,duration:t,cancelAllowed:true,autoDestroy:o};x.viewLayer.addToStack(l);x.viewLayer.addChild(u);x.viewLayer.addChild(e);x.viewLayer.onViewCreate(e,n);var c=o===true?suncore.ModuleEnum.CUSTOM:suncore.ModuleEnum.SYSTEM;if((r.flags&f.TRANSPARENT)===f.NONE){if(r.flags&f.SYNC_FADE_TIME){R.get(u,c).from({alpha:0},t)}else{R.get(u,c).from({alpha:0},Math.min(200,t))}}this.$applyShowProps(e,r,t);suncore.System.addTimer(c,t,this.$onPopupFinish,this,[l,e])};t.prototype.$onPopupFinish=function(e,t){if(e.closed===false){e.displayed=true;x.viewLayer.onViewOpen(t)}};return t}(e);r.ShowPopupCommand=S;var N=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.$doLoad=function(){this.$loadAssets([this.$url,suncom.Common.replacePathExtension(this.$url,"png")])};t.prototype.$onAssetsLoaded=function(e){if(e===true){V.lock(this.$url);(new Laya.Skeleton).load(this.$url,Laya.Handler.create(this,this.$onSkeletonCreated))}else{this.$onComplete(false)}};t.prototype.$onSkeletonCreated=function(e){e.destroy();if(this.destroyed===false){this.$onComplete(true)}V.unlock(this.$url)};return t}(s);r.SkeletonLoader=N;var L=function(a){__extends(e,a);function e(e,t,r){var o=a.call(this)||this;o.$id=0;o.$handler=null;o.$loaders=[];o.$doneList=[];o.$progress=-1;o.$id=e;o.$handler=r;t=V.checkLoadList(t);suncom.Test.expect(t.length).toBeGreaterThan(0);while(t.length>0){var n=t.shift();var i=suncom.Handler.create(o,o.$onResourceCreated);var s=new u(n,i);o.$loaders.push(s)}o.facade.registerObserver(suncore.NotifyKey.ENTER_FRAME,o.$onEnterFrame,o);return o}e.prototype.$onResourceCreated=function(e){if(this.$destroyed===true){return}this.$doneList.push(e);if(this.$doneList.length<this.$loaders.length){return}this.facade.removeObserver(suncore.NotifyKey.ENTER_FRAME,this.$onEnterFrame,this);this.$handler.runWith([this.$id,1])};e.prototype.$onEnterFrame=function(){var e=0;for(var t=0;t<this.$loaders.length;t++){e+=this.$loaders[t].progress}e/=this.$loaders.length;if(this.$progress===e){return}this.$progress=e;if(this.$handler.method.length===2){this.$handler.runWith([this.$id,this.$progress])}};e.prototype.destroy=function(){if(this.$destroyed===true){return}a.prototype.destroy.call(this);this.facade.removeObserver(suncore.NotifyKey.ENTER_FRAME,this.$onEnterFrame,this);suncore.System.addMessage(suncore.ModuleEnum.SYSTEM,suncore.MessagePriorityEnum.PRIORITY_0,this,this.$releaseAllResources)};e.prototype.$releaseAllResources=function(){while(this.$loaders.length>0){this.$loaders.pop().destroy()}};return e}(puremvc.Notifier);r.Templet=L;var R=function(t){__extends(o,t);function o(){var e=t!==null&&t.apply(this,arguments)||this;e.$var_hashId=0;e.$var_mod=suncore.ModuleEnum.SYSTEM;e.$var_target=null;e.$var_props=null;e.$var_actions=[];e.$var_usePool=false;return e}o.prototype.$func_setTo=function(e,t){if(this.$var_hashId===-1){throw Error("Tween己被回收！！！")}this.$var_mod=t;this.$var_target=e;this.$var_hashId=suncom.Common.createHashId();if(suncore.System.isModuleStopped(t)===false){this.facade.sendNotification(H.REGISTER_TWEEN_OBJECT,this)}else{suncom.Logger.error(suncom.DebugMode.ANY,"尝试添加缓动，但时间轴己停止，mod:"+suncore.ModuleEnum[t])}return this};o.prototype.cancel=function(){this.$var_props=null;while(this.$var_actions.length>0){this.$var_actions.pop().recover()}return this};o.prototype.recover=function(){if(suncom.Pool.recover("sunui.Tween",this.cancel())===true){this.$var_hashId=-1}};o.prototype.to=function(e,t,r,o){if(r===void 0){r=null}if(o===void 0){o=null}var n=Object.keys(e);var i=this.$var_props===null?this.$var_target:this.$var_props;this.$func_createTweenInfo(n,i,e,t,r,e.update||null,o);return this};o.prototype.from=function(e,t,r,o){if(r===void 0){r=null}if(o===void 0){o=null}var n=Object.keys(e);var i=this.$var_props===null?this.$var_target:this.$var_props;this.$func_createTweenInfo(n,e,i,t,r,e.update||null,o);return this};o.prototype.by=function(e,t,r,o){if(r===void 0){r=null}if(o===void 0){o=null}var n=Object.keys(e);var i=this.$var_props===null?this.$var_target:this.$var_props;for(var s=0;s<n.length;s++){var a=n[s];if(this.$var_props===null||this.$var_props[a]===void 0){e[a]+=this.$var_target[a]}else{e[a]+=i[a]}}this.to(e,t,r,o);return this};o.prototype.$func_createTweenInfo=function(e,t,r,o,n,i,s){this.$var_props=this.$var_props||{};var a=O.create();a.ease=n;a.update=i;a.complete=s;a.time=suncore.System.getModuleTimestamp(this.$var_mod);a.duration=o;for(var u=0;u<e.length;u++){var l=e[u];if(l==="update"){continue}var c=C.create();c.to=r[l];c.from=t[l];c.prop=l;if(c.from===void 0){c.from=this.$var_target[l]}this.$var_props[l]=r[l];if(this.$var_actions.length===0){this.$var_target[c.prop]=c.from}a.clips.push(c)}if(a.update!==null){a.update.run()}this.$func_addAction(a)};o.prototype.$func_addAction=function(e){if(this.$var_hashId===-1){throw Error("Tween己被回收！！！")}this.$var_actions.push(e)};o.prototype.wait=function(e,t){if(t===void 0){t=null}var r=O.create();r.complete=t;r.time=suncore.System.getModuleTimestamp(this.$var_mod);r.duration=e;this.$func_addAction(r);return this};o.prototype.func_doAction=function(){var e=suncore.System.getModuleTimestamp(this.$var_mod);var t=this.$var_actions[0];if(this.$var_target instanceof fairygui.GObject){if(this.$var_target.isDisposed===true){this.cancel();return 0}}else if(this.$var_target.destroyed===true){this.cancel();return 0}var r=false;var o=0;var n=e-t.time;if(n>t.duration){r=true;o=n-t.duration;n=t.duration}var i=t.ease||this.$func_easeNone;for(var s=0;s<t.clips.length;s++){var a=t.clips[s];if(r===true){this.$var_target[a.prop]=a.to}else{this.$var_target[a.prop]=i(n,a.from,a.to-a.from,t.duration)}}if(t.update!==null){t.update.run()}if(r===false){return 0}this.$var_actions.shift();if(this.$var_actions.length>0){this.$var_actions[0].time=suncore.System.getModuleTimestamp(this.$var_mod)}t.complete!==null&&t.complete.run();t.recover();return o};o.prototype.$func_easeNone=function(e,t,r,o){var n=e/o;if(n>1){n=1}return n*r+t};o.prototype.usePool=function(e){this.$var_usePool=e;return this};o.prototype.func_getUsePool=function(){return this.$var_usePool};Object.defineProperty(o.prototype,"var_mod",{get:function(){return this.$var_mod},enumerable:false,configurable:true});Object.defineProperty(o.prototype,"var_canceled",{get:function(){return this.$var_actions.length===0},enumerable:false,configurable:true});o.get=function(e,t){if(t===void 0){t=suncore.ModuleEnum.CUSTOM}var r=new o;r.$var_hashId=0;return r.usePool(true).$func_setTo(e,t)};return o}(puremvc.Notifier);r.Tween=R;var O=function(){function e(){this.ease=null;this.clips=[];this.update=null;this.complete=null;this.time=0;this.duration=0}e.prototype.recover=function(){this.ease=null;while(this.clips.length>0){this.clips.pop().recover()}this.update=null;this.complete=null;this.time=0;this.duration=0;suncom.Pool.recover("sunui.TweenAction",this)};e.create=function(){return suncom.Pool.getItemByClass("sunui.TweenAction",e)};return e}();r.TweenAction=O;var C=function(){function e(){this.prop=null;this.from=0;this.to=0}e.prototype.recover=function(){this.prop=null;this.from=0;this.to=0;suncom.Pool.recover("sunui.TweenActionClip",this)};e.create=function(){return suncom.Pool.getItemByClass("sunui.TweenActionClip",e)};return e}();r.TweenActionClip=C;var T=function(t){__extends(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.$locker=false;e.$tweens=[];return e}e.prototype.$onRun=function(){this.facade.registerObserver(suncore.NotifyKey.ENTER_FRAME,this.$onEnterFrame,this,false,suncom.EventPriorityEnum.EGL);this.facade.registerObserver(suncore.NotifyKey.PAUSE_TIMELINE,this.$onTimelinePause,this,false,suncom.EventPriorityEnum.EGL);this.facade.registerObserver(H.REGISTER_TWEEN_OBJECT,this.$onRegisterTweenObject,this)};e.prototype.$onStop=function(){this.facade.removeObserver(suncore.NotifyKey.ENTER_FRAME,this.$onEnterFrame,this);this.facade.removeObserver(suncore.NotifyKey.PAUSE_TIMELINE,this.$onTimelinePause,this);this.facade.removeObserver(H.REGISTER_TWEEN_OBJECT,this.$onRegisterTweenObject,this)};e.prototype.$onEnterFrame=function(){this.$locker=true;var e=this.$tweens;for(var t=0;t<suncore.ModuleEnum.MAX;t++){if(suncore.System.isModulePaused(t)===false){for(var r=0;r<e.length;r++){var o=e[r];if(o.var_mod===t){var n=1;while(n>0&&o.var_canceled===false){n=o.func_doAction()}}}}}for(var r=this.$tweens.length-1;r>-1;r--){var o=this.$tweens[r];if(o.var_canceled===true&&o.func_getUsePool()===true){suncom.Pool.recover("sunui.Tweeen",e.splice(r,1)[0])}}this.$locker=false};e.prototype.$onTimelinePause=function(e,t){if(t===true){for(var r=0;r<this.$tweens.length;r++){var o=this.$tweens[r];if(o.var_mod===e){o.cancel()}}}};e.prototype.$onRegisterTweenObject=function(e){if(this.$locker===true){this.$tweens=this.$tweens.slice(0);this.$locker=false}this.$tweens.push(e)};return e}(suncore.BaseService);r.TweenService=T;var M=function(t){__extends(e,t);function e(){var e=t.call(this)||this;x.sceneLayer=new g;x.viewLayer=new Y;suncom.DBService.put(-1,new T).run();suncom.DBService.put(-1,new h).run();e.facade.registerCommand(H.SHOW_POPUP,S,suncom.EventPriorityEnum.OSL);e.facade.registerCommand(H.CLOSE_POPUP,l,suncom.EventPriorityEnum.OSL);return e}e.getInstance=function(){if(e.$inst===null){e.$inst=new e}return e.$inst};e.prototype.enterScene=function(e,t){puremvc.MutexLocker.backup(this);x.sceneLayer.enterScene(e,t);puremvc.MutexLocker.restore()};e.prototype.exitScene=function(){puremvc.MutexLocker.backup(this);x.sceneLayer.exitScene();puremvc.MutexLocker.restore()};e.prototype.replaceScene=function(e,t){puremvc.MutexLocker.backup(this);x.sceneLayer.replaceScene(e,t);puremvc.MutexLocker.restore()};e.prototype.deleteHistories=function(e){x.sceneLayer.deleteHistories(e)};e.prototype.removeView=function(e){x.viewLayer.removeInfoByView(e)};Object.defineProperty(e.prototype,"ready",{get:function(){return x.sceneLayer.ready},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"scene2d",{get:function(){return x.sceneLayer.scene2d},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"scene3d",{get:function(){return x.sceneLayer.scene3d},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"sceneName",{get:function(){return x.sceneLayer.sceneName},enumerable:false,configurable:true});e.$inst=null;return e}(puremvc.Notifier);r.UIManager=M;var A=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.$doLoad=function(){this.$loadAssets([this.$url])};t.prototype.$onAssetsLoaded=function(e){this.$onComplete(e)};return t}(s);r.UrlLoader=A;var b=function(o){__extends(e,o);function e(e,t){var r=o.call(this)||this;r.$url=null;r.$complete=null;r.$progress=0;r.$url=e;r.$complete=t;r.facade.sendNotification(H.ON_URL_SAFETY_LOADER_CREATED,r);return r}e.prototype.load=function(){B.addReference(this.$url);if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.log(suncom.DebugMode.ANY,"load "+this.$url)}var e=Laya.Handler.create(this,this.$onComplete);var t=Laya.Handler.create(this,this.$onProgress,void 0,false);if(V.isFGuiUrl(this.$url)===true){fairygui.UIPackage.loadPackage(this.$url,e,t)}else if(V.isRes3dUrl(this.$url)===false||V.getRes3dJsonUrl(this.$url)===this.$url){Laya.loader.load(this.$url,e,t)}else{Laya.loader.create(this.$url,e,t)}};e.prototype.$onComplete=function(e){if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.log(suncom.DebugMode.ANY,"load "+this.$url+" complete")}this.$complete.runWith([e?true:false,this.$url]);this.facade.sendNotification(H.ON_URL_SAFETY_LOADER_COMPLETE,this);B.removeReference(this.$url)};e.prototype.$onProgress=function(e){this.$progress=e};Object.defineProperty(e.prototype,"url",{get:function(){return this.$url},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"progress",{get:function(){return this.$progress},enumerable:false,configurable:true});return e}(puremvc.Notifier);r.UrlSafetyLoader=b;var P=function(t){__extends(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.$data=null;e.$totalSize=0;e.$currentSize=0;e.$priority=suncom.Mathf.random(0,6);return e}e.prototype.load=function(){if(Laya.loader.getRes(this.url)!==void 0){this.$totalSize=-1}t.prototype.load.call(this)};e.prototype.$onComplete=function(e){if(x.downloadSpeed===i.NONE){t.prototype.$onComplete.call(this,e)}else{this.$data=e;this.$setDownloadSize();this.facade.registerObserver(suncore.NotifyKey.ENTER_FRAME,this.$onEnterFrame,this)}};e.prototype.$onProgress=function(e){if(x.downloadSpeed===i.NONE){t.prototype.$onProgress.call(this,e)}};e.prototype.$onEnterFrame=function(){this.$currentSize+=this.$getDowloadSpeed()*(10-this.$priority)/10;if(this.$totalSize>0&&this.$currentSize>=this.$totalSize){if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.log(suncom.DebugMode.ANY,"[100%] "+this.url+":{"+this.$totalSize+":"+this.$totalSize+"}")}this.facade.removeObserver(suncore.NotifyKey.ENTER_FRAME,this.$onEnterFrame,this);this.$progress=1;t.prototype.$onComplete.call(this,this.$data)}else if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){this.$progress=this.$currentSize/this.$totalSize;suncom.Logger.log(suncom.DebugMode.ANY,"["+Math.floor(this.$progress*100)+"%] "+this.url+":{"+this.$currentSize+":"+this.$totalSize+"}")}};e.prototype.$getDowloadSpeed=function(){if(x.loaders.length<=1){return x.downloadSpeed}else{return x.downloadSpeed/x.loaders.length}};e.prototype.$setDownloadSize=function(){if(this.$data===null||this.$totalSize===-1){this.$totalSize=1}else if(suncom.Common.getFileExtension(this.url)==="atlas"){this.$totalSize=2*1024*1024}else if(suncom.Common.getFileExtension(this.url)==="png"||suncom.Common.getFileExtension(this.url)==="jpg"){this.$totalSize=64*1024}else if(suncom.Common.getFileExtension(this.url)==="json"){this.$totalSize=1024}else if(suncom.Common.getFileExtension(this.url)==="sk"){this.$totalSize=1024*1024}else if(suncom.Common.getFileExtension(this.url)==="lh"){this.$totalSize=256*1024}else{this.$totalSize=128*1024}};return e}(b);r.UrlSafetyPuppetLoader=P;var w=function(o){__extends(e,o);function e(e,t){var r=o.call(this)||this;r.$var_info=null;r.$var_view=e;if(r.var_info!==null){r.$var_duration=r.var_info.duration}else if(t===void 0){r.$var_duration=200}else{r.$var_duration=t}return r}e.prototype.popup=function(e){if(e===void 0){e={}}this.facade.sendNotification(H.SHOW_POPUP,[this.$var_view,this.$var_duration,e]);return this};e.prototype.close=function(e){this.facade.sendNotification(H.CLOSE_POPUP,[this.$var_view,this.$var_duration,e])};Object.defineProperty(e.prototype,"cancelAllowed",{get:function(){return this.var_info.cancelAllowed},set:function(e){this.var_info.cancelAllowed=e},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"var_info",{get:function(){if(this.$var_info===null){this.$var_info=x.viewLayer.getInfoByView(this.$var_view)}return this.$var_info},enumerable:false,configurable:true});return e}(puremvc.Notifier);r.ViewFacade=w;var I=function(t){__extends(e,t);function e(){var e=t.call(this)||this;e.$stack=[];e.facade.registerObserver(H.UNLOAD_SCENE,e.$onUnloadScene,e,false,suncom.EventPriorityEnum.EGL);return e}e.prototype.$onUnloadScene=function(){var e=this.$stack.concat();for(var t=e.length-1;t>-1;t--){var r=e[t];if(r.autoDestroy===true){this.removeFromStack(r)}}};e.prototype.addToStack=function(e){this.$stack.push(e)};e.prototype.removeFromStack=function(e){var t=this.$stack.indexOf(e);if(t<0){return}this.$stack.splice(t,1);e.closed=true;this.onViewRemove(e.view);this.removeChild(e.view);this.removeChild(e.mask);this.destroyMask(e.mask);if(e.keepNode===false){this.destroyView(e.view)}};e.prototype.getInfoByView=function(e){for(var t=0;t<this.$stack.length;t++){var r=this.$stack[t];if(r.view===e){return r}}return null};e.prototype.removeInfoByView=function(e){for(var t=0;t<this.$stack.length;t++){var r=this.$stack[t];if(r.view===e){this.removeFromStack(r);break}}};return e}(puremvc.Notifier);r.ViewLayer=I;var D=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.addChild=function(e){var t=e;if(x.sceneLayer.scene2d===null||e.zOrder>=r.UILevel.LOADING){Laya.stage.addChild(t)}else{x.sceneLayer.scene2d.addChild(t)}};t.prototype.removeChild=function(e){var t=e;var r=t.parent||null;if(r===null){throw Error("无法移除显示对象，因为父节点不存在 "+t.name)}r.removeChild(t)};t.prototype.createMask=function(e,t){var r=new Laya.Image("common/mask_b.png");r.left=r.right=r.top=r.bottom=0;r.sizeGrid="1,1,1,1";if(t.flags&f.TRANSPARENT){r.alpha=0}else{r.alpha=1}if((t.flags&f.MOUSE_THROUGH)===f.NONE){r.mouseThrough=false;r.on(Laya.Event.CLICK,this,this.$onMaskClick,[e])}return r};t.prototype.$onMaskClick=function(e){var t=x.viewLayer.getInfoByView(e);if(t!==null&&t.closed===false&&t.cancelAllowed===true){new w(e).close()}};t.prototype.destroyMask=function(e){e.off(Laya.Event.CLICK,this,this.$onMaskClick);e.destroy()};t.prototype.destroyView=function(e){var t=e;t.destroy()};return t}(I);r.ViewLayerLaya=D;var k=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.onViewCreate=function(e,t){var r=e;if(r.$onCreate){if(t instanceof Array===false){r.$onCreate.call(r,t)}else{r.$onCreate.apply(r,t)}}};t.prototype.onViewOpen=function(e){var t=e;if(t.$onOpen){t.$onOpen.call(t)}};t.prototype.onViewClose=function(e){var t=e;if(t.$onClose){t.$onClose.call(t)}};t.prototype.onViewRemove=function(e){var t=e;if(t.$onRemove){t.$onRemove.call(t)}};return t}(D);r.ViewLayerLaya2D=k;var U=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.onViewCreate=function(e,t){var r=e.getComponents(Laya.Component)||[];for(var o=0;o<r.length;o++){var n=r[o];if(n.$onCreate){if(t instanceof Array===false){n.$onCreate.call(n,t)}else{n.$onCreate.apply(n,t)}}}};t.prototype.onViewOpen=function(e){var t=e.getComponents(Laya.Component)||[];for(var r=0;r<t.length;r++){var o=t[r];if(o.$onOpen){o.$onOpen.call(o)}}};t.prototype.onViewClose=function(e){var t=e.getComponents(Laya.Component)||[];for(var r=0;r<t.length;r++){var o=t[r];if(o.$onClose){o.$onClose.call(o)}}};t.prototype.onViewRemove=function(e){var t=e.getComponents(Laya.Component)||[];for(var r=0;r<t.length;r++){var o=t[r];if(o.$onRemove){o.$onRemove.call(o)}}};return t}(D);r.ViewLayerLaya3D=U;var Y=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.addChild=function(e){var t=e;fairygui.GRoot.inst.addChild(t)};t.prototype.removeChild=function(e){var t=e;var r=t.parent||null;if(r===null){throw Error("无法移除显示对象，因为父节点不存在 "+t.name)}fairygui.GRoot.inst.removeChild(t)};t.prototype.createMask=function(e,t){var r=new fairygui.GLoader;r.url="ui://Public_Resource/B_bantoumingbeijing";r.fill=fairygui.LoaderFillType.ScaleFree;r.setSize(suncom.Global.width,suncom.Global.height);if(t.flags&f.TRANSPARENT){r.alpha=0}else{r.alpha=1}if((t.flags&f.MOUSE_THROUGH)===f.NONE){r.on(Laya.Event.CLICK,this,this.$onMaskClick,[e])}else{r.touchable=false}return r};t.prototype.$onMaskClick=function(e){var t=x.viewLayer.getInfoByView(e);if(t!==null&&t.closed===false&&t.cancelAllowed===true){new w(e).close()}};t.prototype.destroyMask=function(e){e.off(Laya.Event.CLICK,this,this.$onMaskClick);e.dispose()};t.prototype.destroyView=function(e){var t=e;t.dispose()};t.prototype.onViewCreate=function(e,t){var r=e["init"];r&&r.call(e,t)};t.prototype.onViewOpen=function(e){var t=e["onOpen"];t&&t.call(e)};t.prototype.onViewClose=function(e){var t=e["onClose"];t&&t.call(e)};t.prototype.onViewRemove=function(e){};return t}(I);r.ViewLayerLayaFui=Y;var F=function(n){__extends(e,n);function e(e,t,r){var o=n.call(this,e,t)||this;o.$dataList=[];o.$running=false;o.$monitors=null;o.$monitors=r;if(o.$monitors.length===0){throw Error("没有为需要拦截的命令指定监视器！")}o.facade.registerObserver(H.RELEASE_MONITOR,o.$onMonitorReleased,o);return o}e.prototype.destroy=function(){if(this.$destroyed===true){return}n.prototype.destroy.call(this);this.facade.removeObserver(H.RELEASE_MONITOR,this.$onMonitorReleased,this)};e.prototype.run=function(){if(this.$running===false){this.$running=true;for(var e=0;e<this.$monitors.length;e++){this.$monitors[e].var_active=true}}};e.prototype.$onMonitorReleased=function(e){if(this.$var_released===true){return}if(this.$monitors.indexOf(e)===-1){return}this.facade.notifyCancel();var t=true;for(var r=0;r<this.$monitors.length;r++){if(this.$monitors[r].var_released===false){t=false;break}}if(t===true){suncore.System.addMessage(suncore.ModuleEnum.TIMELINE,suncore.MessagePriorityEnum.PRIORITY_0,this,this.$releaseSelf)}};e.prototype.$releaseSelf=function(){if(this.$destroyed===false&&this.$var_released===false){this.$var_released=true;this.facade.sendNotification(H.NEXT_COMMAND,this,true);for(var e=0;e<this.$dataList.length;e++){this.facade.sendNotification(this.$var_command,this.$dataList[e])}}};e.prototype.$func_onCommandCallback=function(){if(this.$var_released===true){return}var e=[];for(var t=0;t<arguments.length;t++){e.push(arguments[t])}if(this.$var_condition.runWith(e)===false){return}this.$var_released=true;for(var t=0;t<this.$monitors.length;t++){if(this.$monitors[t].var_released===false){this.$var_released=false;break}}if(this.$var_released===false){this.$dataList.push(e);this.facade.notifyCancel()}};Object.defineProperty(e.prototype,"running",{get:function(){return this.$running},enumerable:false,configurable:true});return e}(y);r.Command=F;var G=function(t){__extends(e,t);function e(){var e=t!==null&&t.apply(this,arguments)||this;e.$var_active=false;return e}e.prototype.$func_onCommandCallback=function(){if(this.$var_active===true&&this.$var_released===false){var e=[];for(var t=0;t<arguments.length;t++){e.push(arguments[t])}if(this.$var_condition.runWith(e)===true){this.$var_released=true;this.facade.sendNotification(H.RELEASE_MONITOR,this,true)}}};Object.defineProperty(e.prototype,"var_active",{get:function(){return this.$var_active},set:function(e){this.$var_active=e},enumerable:false,configurable:true});return e}(y);r.Monitor=G;var x;(function(e){e.downloadSpeed=i.NONE;e.loaders=[];e.cacheMap={};e.templets={};e.references={}})(x=r.M||(r.M={}));var H;(function(e){e.RETRY_CONFIRM="sunui.NotifyKey.RETRY_CONFIRM";e.REGISTER_SCENES="sunui.NotifyKey.REGISTER_SCENES";e.BEFORE_LOAD_SCENE="sunui.NotifyKey.BEFORE_LOAD_SCENE";e.LOAD_SCENE="sunui.NotifyKey.LOAD_SCENE";e.UNLOAD_SCENE="sunui.NotifyKey.UNLOAD_SCENE";e.ENTER_SCENE="sunui.NotifyKey.ENTER_SCENE";e.EXIT_SCENE="sunui.NotifyKey.EXIT_SCENE";e.BEFORE_LEAVE_SCENE="sunui.NotifyKey.BEFORE_LEAVE_SCENE";e.LEAVE_SCENE="sunui.NotifyKey.LEAVE_SCENE";e.SHOW_POPUP="sunui.NotifyKey.SHOW_POPUP";e.CLOSE_POPUP="sunui.NotifyKey.CLOSE_POPUP";e.ON_ASSET_SAFETY_LOADER_FAILED="sunui.NotifyKey.ON_ASSET_SAFETY_LOADER_FAILED";e.ON_URL_SAFETY_LOADER_CREATED="sunui.NotifyKey.ON_URL_SAFETY_LOADER_CREATED";e.ON_URL_SAFETY_LOADER_COMPLETE="sunui.NotifyKey.ON_URL_SAFETY_LOADER_COMPLETE";e.ASSET_SAFETY_LOADER_RETRY="sunui.NotifyKey.ASSET_SAFETY_LOADER_RETRY";e.REGISTER_TWEEN_OBJECT="sunui.NotifyKey.REGISTER_TWEEN_OBJECT";e.NEXT_COMMAND="sunui.NotifyKey.NEXT_COMMAND";e.RELEASE_MONITOR="sunui.NotifyKey.RELEASE_MONITOR";e.SCENE_IS_READY="sunui.NotifyKey.SCENE_IS_READY"})(H=r.NotifyKey||(r.NotifyKey={}));var B;(function(o){function e(e){var t=x.references[e]||0;x.references[e]=t+1;if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.log(suncom.DebugMode.ANY,"reference:"+(t+1)+", lock:"+e)}}o.addReference=e;function t(e){var t=x.references[e]||0;suncom.Test.expect(t).interpret("尝试解锁不存在的资源 url："+e).toBeGreaterThan(0);x.references[e]=t-1;if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.log(suncom.DebugMode.ANY,"reference:"+(t-1)+", unlock:"+e)}if(t===1){delete x.references[e];r(e)}}o.removeReference=t;function r(e){if(V.isRes3dUrl(e)===true&&V.getRes3dJsonUrl(e)===e){var t=n(Laya.loader.getRes(e));for(var r=0;r<t.length;r++){o.clearResByUrl(t[r])}}o.clearResByUrl(e)}function n(e){var t=[];var r=V.getRes3dPackRoot(e.pack);for(var o=0;o<e.files.length;o++){t.push(r+e.files[o])}for(var o=0;o<e.resources.length;o++){t.push(r+e.resources[o])}return t}function i(e){if(suncom.Global.debugMode&suncom.DebugMode.DEBUG){suncom.Logger.log(suncom.DebugMode.ANY,"clearResUrl:"+e)}if(V.isFGuiUrl(e)===true){return fairygui.UIPackage.removePackage(e)}var t=x.cacheMap[e]||null;if(t!==null){t.dispose&&t.dispose();t.destroy&&t.destroy();delete x.cacheMap[e]}var r=Laya.loader.getRes(e)||null;if(r===null){Laya.loader.cancelLoadByUrl(e)}else{r.dispose&&r.dispose();r.destroy&&r.destroy();Laya.loader.clearRes(e)}var o=suncom.Common.getFileExtension(e);if(o==="ani"){Laya.Animation.clearCache(e)}else if(o==="sk"){Laya.Templet.TEMPLET_DICTIONARY[e]&&Laya.Templet.TEMPLET_DICTIONARY[e].destroy();delete Laya.Templet.TEMPLET_DICTIONARY[e]}}o.clearResByUrl=i})(B=r.RES||(r.RES={}));var V;(function(i){i.res3dRoot=null;function e(e){x.downloadSpeed=e}i.setDownloadSpeed=e;function t(e){if(suncom.Global.debugMode>0){if(i.isRes3dUrl(e)===true&&i.getRes3dJsonUrl(e)===e){console.error("禁止直接调用此方法来单独锁定3d资源配置文件");return}}var t=[e];if(i.isRes3dUrl(e)===true){var r=suncom.Common.getFileExtension(e);var o=e.substr(0,e.length-r.length);t.push(o+"json")}for(var n=0;n<t.length;n++){B.addReference(t[n])}}i.lock=t;function r(e){if(suncom.Global.debugMode>0){if(i.isRes3dUrl(e)===true&&i.getRes3dJsonUrl(e)===e){console.error("禁止直接调用此方法来单独解锁3d资源配置文件");return}}var t=[e];if(i.isRes3dUrl(e)===true){var r=suncom.Common.getFileExtension(e);var o=e.substr(0,e.length-r.length);t.push(o+"json")}for(var n=0;n<t.length;n++){B.removeReference(t[n])}}i.unlock=r;function o(e,t,r){var o=null;if(t===null){o=suncom.Handler.create(null,function(e){},void 0,false)}else{o=suncom.Handler.create(r,t,void 0,false)}var n=suncom.Common.createHashId();x.templets[n]=new L(n,e,o);return n}i.prepare=o;function n(e){var t=x.templets[e]||null;if(t!==null){delete x.templets[e];t.destroy()}return 0}i.release=n;function s(e,t){var r=x.cacheMap[e]||null;if(suncom.Common.getFileExtension(e)==="sk"){return r.buildArmature(t)}else if(i.isRes3dUrl(e)===true){if(r===null){r=x.cacheMap[e]=Laya.loader.getRes(e)}return Laya.Sprite3D.instantiate(r)}else{return Laya.loader.getRes(e)}}i.createSync=s;function a(e){return i.createSync(i.getRes3dUrlByName(e))}i.createRes3dSync=a;function u(e){var t=new Laya.Prefab;t.json=Laya.loader.getRes(e);return t.create()}i.createPrefab=u;function l(e){if(i.res3dRoot===null){throw Error("请先指定3D资源目录：sunui.Resource.res3dRoot=")}return i.res3dRoot+"/LayaScene_"+e+"/Conventional/"}i.getRes3dPackRoot=l;function c(e){return e.indexOf(i.res3dRoot)===0}i.isRes3dUrl=c;function f(e){return suncom.Common.replacePathExtension(e,"json")}i.getRes3dJsonUrl=f;function d(e){return e.substr(0,4)==="fgui"}i.isFGuiUrl=d;function h(e){if(suncom.Common.getFileExtension(e)===null){e+=".lh"}return i.getRes3dPackRoot(suncom.Common.getFileName(e))+e}i.getRes3dUrlByName=h;function p(e){i.removeUnnecessaryResources(e,"sk","png","龙骨预加载无需指定PNG资源");i.removeUnnecessaryResources(e,"fui","png","FGUI预加载无需指定PNG资源");i.removeUnnecessaryResources(e,"atlas","png","图集预加载无需指定PNG资源");return i.removeDuplicateResources(e)}i.checkLoadList=p;function m(e){if(suncom.Global.debugMode&suncom.DebugMode.ENGINE){var t=[];for(var r=0;r<e.length;r++){var o=e[r];if(t.indexOf(o)===-1){t.push(o)}else{suncom.Logger.error(suncom.DebugMode.ANY,"重复的预加载资源文件 "+o)}}return t}return e}i.removeDuplicateResources=m;function v(e,t,r,o){if(suncom.Global.debugMode&suncom.DebugMode.ENGINE){var n=[];for(var i=0;i<e.length;i++){var s=e[i];if(suncom.Common.getFileExtension(s)===t){n.push(s)}}for(var i=0;i<n.length;i++){var s=n[i];var a=s.substring(0,s.length-t.length)+r;do{var u=e.indexOf(a);if(u===-1){break}e.splice(u,1);suncom.Logger.error(suncom.DebugMode.ANY,o+" "+s)}while(true)}}}i.removeUnnecessaryResources=v})(V=r.Resource||(r.Resource={}));var K;(function(e){var o=[];function r(e){for(var t=o.length-1;t>-1;t--){if(o[t].name===e){return t}}return-1}function t(e,t){var r={name:e,data:t};o.push(r)}e.addHistory=t;function n(e){var t=r(e);if(t>-1){o.splice(t,1)}return t>-1}e.removeHistory=n;function i(e){return r(e)>-1}e.hasHistory=i;function s(){if(o.length>0){return o[o.length-1]}return null}e.getLastestSceneInfo=s;function a(e){var t=r(e);if(t>-1){return o[t]}return null}e.getLastestSceneInfoByName=a;function u(e){while(o.length>1&&e>0){o.pop();e--}}e.deleteHistories=u})(K=r.SceneHeap||(r.SceneHeap={}));var j;(function(e){var o=[];function t(e){for(var t=0;t<o.length;t++){if(o[t].name===e.name){throw Error("重复注册场景")}}o.push(e)}e.regScene=t;function r(e){for(var t=0;t<o.length;t++){var r=o[t];if(r.name===e){return r}}throw Error("场景配置不存在")}e.getConfigByName=r})(j=r.SceneManager||(r.SceneManager={}));function z(e,t){var r=e.split("/");while(t!=null&&r.length>0){var o=r.shift();t=t.getChildByName(o)}return t}r.find=z})(sunui||(sunui={}));